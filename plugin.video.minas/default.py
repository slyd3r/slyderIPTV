import base64;exec base64.b64decode('IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KaW1wb3J0IHVybGxpYgppbXBvcnQgdXJsbGliMgppbXBvcnQgcmUKaW1wb3J0IG9zCmltcG9ydCB4Ym1jcGx1Z2luCmltcG9ydCB4Ym1jZ3VpCmltcG9ydCB4Ym1jYWRkb24KaW1wb3J0IHhibWN2ZnMKaW1wb3J0IHRyYWNlYmFjawppbXBvcnQgY29va2llbGliCmZyb20gQmVhdXRpZnVsU291cCBpbXBvcnQgQmVhdXRpZnVsU3RvbmVTb3VwLCBCZWF1dGlmdWxTb3VwLCBCZWF1dGlmdWxTT0FQCnRyeToKICAgIGZyb20geG1sLnNheC5zYXh1dGlscyBpbXBvcnQgZXNjYXBlCmV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YygpCnRyeToKICAgIGltcG9ydCBqc29uCmV4Y2VwdDoKICAgIGltcG9ydCBzaW1wbGVqc29uIGFzIGpzb24KaW1wb3J0IFNpbXBsZURvd25sb2FkZXIgYXMgZG93bmxvYWRlcgppbXBvcnQgdGltZQoKcmVzb2x2ZV91cmw9WycxODB1cGxvYWQuY29tJywgJ2FsbG15dmlkZW9zLm5ldCcsICdiZXN0cmVhbXMubmV0JywgJ2NsaWNrbnVwbG9hZC5jb20nLCAnY2xvdWR6aWxsYS50bycsICdtb3ZzaGFyZS5uZXQnLCAnbm92YW1vdi5jb20nLCAnbm93dmlkZW8uc3gnLCAndmlkZW93ZWVkLmVzJywgJ2RhY2xpcHMuaW4nLCAnZGF0ZW11bGUuY29tJywgJ2Zhc3R2aWRlby5pbicsICdmYXN0c3RyZWFtLmluJywgJ2ZpbGVob290LmNvbScsICdmaWxlbnVrZS5jb20nLCAnc2hhcmVzaXguY29tJywgJ2RvY3MuZ29vZ2xlLmNvbScsICdwbHVzLmdvb2dsZS5jb20nLCAncGljYXNhd2ViLmdvb2dsZS5jb20nLCAnZ29yaWxsYXZpZC5jb20nLCAnZ29yaWxsYXZpZC5pbicsICdncmlmdGhvc3QuY29tJywgJ2h1Z2VmaWxlcy5uZXQnLCAnaXBpdGhvcy50bycsICdpc2hhcmVkLmV1JywgJ2tpbmdmaWxlcy5uZXQnLCAnbWFpbC5ydScsICdteS5tYWlsLnJ1JywgJ3ZpZGVvYXBpLm15Lm1haWwucnUnLCAnbWlnaHR5dXBsb2FkLmNvbScsICdtb29zaGFyZS5iaXonLCAnbW92ZGl2eC5jb20nLCAnbW92cG9kLm5ldCcsICdtb3Zwb2QuaW4nLCAnbW92cmVlbC5jb20nLCAnbXJmaWxlLm1lJywgJ25vc3ZpZGVvLmNvbScsICdvcGVubG9hZC5pbycsICdwbGF5ZWQudG8nLCAnYml0c2hhcmUuY29tJywgJ2ZpbGVmYWN0b3J5LmNvbScsICdrMnMuY2MnLCAnb2Jvb20uY29tJywgJ3JhcGlkZ2F0b3IubmV0JywgJ3VwbG9hZGVkLm5ldCcsICdwcmltZXNoYXJlLnR2JywgJ2JpdHNoYXJlLmNvbScsICdmaWxlZmFjdG9yeS5jb20nLCAnazJzLmNjJywgJ29ib29tLmNvbScsICdyYXBpZGdhdG9yLm5ldCcsICd1cGxvYWRlZC5uZXQnLCAnc2hhcmVyZXBvLmNvbScsICdzdGFnZXZ1LmNvbScsICdzdHJlYW1jbG91ZC5ldScsICdzdHJlYW1pbi50bycsICd0aGVmaWxlLm1lJywgJ3RoZXZpZGVvLm1lJywgJ3R1c2ZpbGVzLm5ldCcsICd1cGxvYWRjLmNvbScsICd6YWxhYS5jb20nLCAndXBsb2Fkcm9ja2V0Lm5ldCcsICd1cHRvYm94LmNvbScsICd2LXZpZHMuY29tJywgJ3ZlZWhkLmNvbScsICd2aWRidWxsLmNvbScsICd2aWRlb21lZ2EudHYnLCAndmlkcGxheS5uZXQnLCAndmlkc3BvdC5uZXQnLCAndmlkdG8ubWUnLCAndmlkemkudHYnLCAndmltZW8uY29tJywgJ3ZrLmNvbScsICd2b2Rsb2NrZXIuY29tJywgJ3hmaWxlbG9hZC5jb20nLCAneHZpZHN0YWdlLmNvbScsICd6ZXR0YWhvc3QudHYnXQpnX2lnbm9yZVNldFJlc29sdmVkPVsncGx1Z2luLnZpZGVvLmRyYW1hc29ubGluZScsJ3BsdWdpbi52aWRlby5mNG1UZXN0ZXInLCdwbHVnaW4udmlkZW8uc2hhaGlkbWJjbmV0JywncGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsJywncGx1Z2luLnN0cmVhbS52YXVnaG5saXZlLnR2JywncGx1Z2luLnZpZGVvLlplbVRWLXNoYW5pJ10KCmNsYXNzIE5vUmVkaXJlY3Rpb24odXJsbGliMi5IVFRQRXJyb3JQcm9jZXNzb3IpOgogICBkZWYgaHR0cF9yZXNwb25zZShzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICByZXR1cm4gcmVzcG9uc2UKICAgaHR0cHNfcmVzcG9uc2UgPSBodHRwX3Jlc3BvbnNlCgpSRU1PVEVfREJHPUZhbHNlOwppZiBSRU1PVEVfREJHOgogICAgIyBNYWtlIHB5ZGV2IGRlYnVnZ2VyIHdvcmtzIGZvciBhdXRvIHJlbG9hZC4KICAgICMgTm90ZSBweWRldmQgbW9kdWxlIG5lZWQgdG8gYmUgY29waWVkIGluIFhCTUNcc3lzdGVtXHB5dGhvblxMaWJccHlzcmMKICAgIHRyeToKICAgICAgICBpbXBvcnQgcHlzcmMucHlkZXZkIGFzIHB5ZGV2ZAogICAgIyBzdGRvdXRUb1NlcnZlciBhbmQgc3RkZXJyVG9TZXJ2ZXIgcmVkaXJlY3Qgc3Rkb3V0IGFuZCBzdGRlcnIgdG8gZWNsaXBzZSBjb25zb2xlCiAgICAgICAgcHlkZXZkLnNldHRyYWNlKCdsb2NhbGhvc3QnLCBzdGRvdXRUb1NlcnZlcj1UcnVlLCBzdGRlcnJUb1NlcnZlcj1UcnVlKQogICAgZXhjZXB0IEltcG9ydEVycm9yOgogICAgICAgIHN5cy5zdGRlcnIud3JpdGUoIkVycm9yOiAiICsKICAgICAgICAgICAgIllvdSBtdXN0IGFkZCBvcmcucHl0aG9uLnB5ZGV2LmRlYnVnLnB5c3JjIHRvIHlvdXIgUFlUSE9OUEFUSC4iKQogICAgICAgIHN5cy5leGl0KDEpCgoKYWRkb24gPSB4Ym1jYWRkb24uQWRkb24oJ3BsdWdpbi52aWRlby5taW5hcycpCmFkZG9uX3ZlcnNpb24gPSBhZGRvbi5nZXRBZGRvbkluZm8oJ3ZlcnNpb24nKQpwcm9maWxlID0geGJtYy50cmFuc2xhdGVQYXRoKGFkZG9uLmdldEFkZG9uSW5mbygncHJvZmlsZScpLmRlY29kZSgndXRmLTgnKSkKaG9tZSA9IHhibWMudHJhbnNsYXRlUGF0aChhZGRvbi5nZXRBZGRvbkluZm8oJ3BhdGgnKS5kZWNvZGUoJ3V0Zi04JykpCmZhdm9yaXRlcyA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnZmF2b3JpdGVzJykKaGlzdG9yeSA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnaGlzdG9yeScpClJFViA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnbGlzdF9yZXZpc2lvbicpCmljb24gPSBvcy5wYXRoLmpvaW4oaG9tZSwgJ2ljb24ucG5nJykKRkFOQVJUID0gb3MucGF0aC5qb2luKGhvbWUsICdmYW5hcnQuanBnJykKc291cmNlX2ZpbGUgPSBvcy5wYXRoLmpvaW4oaG9tZSwgJ3NvdXJjZV9maWxlJykKZnVuY3Rpb25zX2RpciA9IHByb2ZpbGUKCmNvbW11bml0eWZpbGVzID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICdMaXZld2ViVFYnKQpkb3dubG9hZGVyID0gZG93bmxvYWRlci5TaW1wbGVEb3dubG9hZGVyKCkKZGVidWcgPSBhZGRvbi5nZXRTZXR0aW5nKCdkZWJ1ZycpCmlmIG9zLnBhdGguZXhpc3RzKGZhdm9yaXRlcyk9PVRydWU6CiAgICBGQVYgPSBvcGVuKGZhdm9yaXRlcykucmVhZCgpCmVsc2U6IEZBViA9IFtdCmlmIG9zLnBhdGguZXhpc3RzKHNvdXJjZV9maWxlKT09VHJ1ZToKICAgIFNPVVJDRVMgPSBvcGVuKHNvdXJjZV9maWxlKS5yZWFkKCkKZWxzZTogU09VUkNFUyA9IFtdCgoKZGVmIGFkZG9uX2xvZyhzdHJpbmcpOgogICAgaWYgZGVidWcgPT0gJ3RydWUnOgogICAgICAgIHhibWMubG9nKCJbYWRkb24udHZkaXJldG8tJXNdOiAlcyIgJShhZGRvbl92ZXJzaW9uLCBzdHJpbmcpKQoKCmRlZiBtYWtlUmVxdWVzdCh1cmwsIGhlYWRlcnM9Tm9uZSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBoZWFkZXJzIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBoZWFkZXJzID0geydVc2VyLWFnZW50JyA6ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IFdPVzY0OyBydjoxOS4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzE5LjAnfQogICAgICAgICAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QodXJsLE5vbmUsaGVhZGVycykKICAgICAgICAgICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQogICAgICAgICAgICBkYXRhID0gcmVzcG9uc2UucmVhZCgpCiAgICAgICAgICAgIHJlc3BvbnNlLmNsb3NlKCkKICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICBleGNlcHQgdXJsbGliMi5VUkxFcnJvciwgZToKICAgICAgICAgICAgYWRkb25fbG9nKCdVUkw6ICcrdXJsKQogICAgICAgICAgICBpZiBoYXNhdHRyKGUsICdjb2RlJyk6CiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1dlIGZhaWxlZCB3aXRoIGVycm9yIGNvZGUgLSAlcy4nICUgZS5jb2RlKQogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oVFYgRGlyZXRvLFdlIGZhaWxlZCB3aXRoIGVycm9yIGNvZGUgLSAiK3N0cihlLmNvZGUpKyIsMTAwMDAsIitpY29uKyIpIikKICAgICAgICAgICAgZWxpZiBoYXNhdHRyKGUsICdyZWFzb24nKToKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnV2UgZmFpbGVkIHRvIHJlYWNoIGEgc2VydmVyLicpCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1JlYXNvbjogJXMnICVlLnJlYXNvbikKICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKFRWIERpcmV0byxXZSBmYWlsZWQgdG8gcmVhY2ggYSBzZXJ2ZXIuIC0gIitzdHIoZS5yZWFzb24pKyIsMTAwMDAsIitpY29uKyIpIikKCmRlZiBnZXRTb3VyY2VzKCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhmYXZvcml0ZXMpID09IFRydWU6CiAgICAgICAgICAgICAgICBhZGREaXIoJ0Zhdm9yaXRlcycsJ3VybCcsNCxvcy5wYXRoLmpvaW4oaG9tZSwgJ3Jlc291cmNlcycsICdmYXZvcml0ZS5wbmcnKSxGQU5BUlQsJycsJycsJycsJycpCiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoImJyb3dzZV94bWxfZGF0YWJhc2UiKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgICAgICBhZGREaXIoJ1hNTCBEYXRhYmFzZScsJ2h0dHA6Ly94Ym1jcGx1cy54Yi5mdW5waWMuZGUvd3d3LWRhdGEvZmlsZXN5c3RlbS8nLDE1LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQogICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCJicm93c2VfY29tbXVuaXR5IikgPT0gInRydWUiOgogICAgICAgICAgICAgICAgYWRkRGlyKCdDb21tdW5pdHkgRmlsZXMnLCdjb21tdW5pdHlfZmlsZXMnLDE2LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQogICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCJzZWFyY2hvdGhlcnBsdWdpbnMiKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgICAgICBhZGREaXIoJ1NlYXJjaCBPdGhlciBQbHVnaW5zJywnU2VhcmNoIFBsdWdpbnMnLDI1LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PVRydWU6CiAgICAgICAgICAgICAgICBzb3VyY2VzID0ganNvbi5sb2FkcyhvcGVuKHNvdXJjZV9maWxlLCJyIikucmVhZCgpKQogICAgICAgICAgICAgICAgI3ByaW50ICdzb3VyY2VzJyxzb3VyY2VzCiAgICAgICAgICAgICAgICBpZiBsZW4oc291cmNlcykgPiAxOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHNvdXJjZXM6CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMjIGZvciBwcmUgMS4wLjggc291cmNlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShpLCBsaXN0KToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIoaVswXS5lbmNvZGUoJ3V0Zi04JyksaVsxXS5lbmNvZGUoJ3V0Zi04JyksMSxpY29uLEZBTkFSVCwnJywnJywnJywnJywnc291cmNlJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWIgPSBpY29uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFuYXJ0ID0gRkFOQVJUCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYyA9ICcnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSA9ICcnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGl0cyA9ICcnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSAnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgndGh1bWJuYWlsJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRodW1iID0gaVsndGh1bWJuYWlsJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2ZhbmFydCcpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSBpWydmYW5hcnQnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnZGVzY3JpcHRpb24nKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYyA9IGlbJ2Rlc2NyaXB0aW9uJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2RhdGUnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSA9IGlbJ2RhdGUnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnZ2VucmUnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSBpWydnZW5yZSddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdjcmVkaXRzJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWRpdHMgPSBpWydjcmVkaXRzJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIoaVsndGl0bGUnXS5lbmNvZGUoJ3V0Zi04JyksaVsndXJsJ10uZW5jb2RlKCd1dGYtOCcpLDEsdGh1bWIsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxjcmVkaXRzLCdzb3VyY2UnKQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IHRyYWNlYmFjay5wcmludF9leGMoKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBpZiBsZW4oc291cmNlcykgPT0gMToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShzb3VyY2VzWzBdLCBsaXN0KToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldERhdGEoc291cmNlc1swXVsxXS5lbmNvZGUoJ3V0Zi04JyksRkFOQVJUKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0RGF0YShzb3VyY2VzWzBdWyd1cmwnXSwgc291cmNlc1swXVsnZmFuYXJ0J10pCiAgICAgICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKCkKCmRlZiBhZGRTb3VyY2UodXJsPU5vbmUpOgogICAgICAgIGlmIHVybCBpcyBOb25lOgogICAgICAgICAgICBpZiBub3QgYWRkb24uZ2V0U2V0dGluZygibmV3X2ZpbGVfc291cmNlIikgPT0gIiI6CiAgICAgICAgICAgICAgIHNvdXJjZV91cmwgPSBhZGRvbi5nZXRTZXR0aW5nKCduZXdfZmlsZV9zb3VyY2UnKS5kZWNvZGUoJ3V0Zi04JykKICAgICAgICAgICAgZWxpZiBub3QgYWRkb24uZ2V0U2V0dGluZygibmV3X3VybF9zb3VyY2UiKSA9PSAiIjoKICAgICAgICAgICAgICAgc291cmNlX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ25ld191cmxfc291cmNlJykuZGVjb2RlKCd1dGYtOCcpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc291cmNlX3VybCA9IHVybAogICAgICAgIGlmIHNvdXJjZV91cmwgPT0gJycgb3Igc291cmNlX3VybCBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4KICAgICAgICBhZGRvbl9sb2coJ0FkZGluZyBOZXcgU291cmNlOiAnK3NvdXJjZV91cmwuZW5jb2RlKCd1dGYtOCcpKQoKICAgICAgICBtZWRpYV9pbmZvID0gTm9uZQogICAgICAgICNwcmludCAnc291cmNlX3VybCcsc291cmNlX3VybAogICAgICAgIGRhdGEgPSBnZXRTb3VwKHNvdXJjZV91cmwpCiAgICAgICAgcHJpbnQgJ3NvdXJjZV91cmwnLHNvdXJjZV91cmwKICAgICAgICBpZiBpc2luc3RhbmNlKGRhdGEsQmVhdXRpZnVsU09BUCk6CiAgICAgICAgICAgIGlmIGRhdGEuZmluZCgnY2hhbm5lbHNfaW5mbycpOgogICAgICAgICAgICAgICAgbWVkaWFfaW5mbyA9IGRhdGEuY2hhbm5lbHNfaW5mbwogICAgICAgICAgICBlbGlmIGRhdGEuZmluZCgnaXRlbXNfaW5mbycpOgogICAgICAgICAgICAgICAgbWVkaWFfaW5mbyA9IGRhdGEuaXRlbXNfaW5mbwogICAgICAgIGlmIG1lZGlhX2luZm86CiAgICAgICAgICAgIHNvdXJjZV9tZWRpYSA9IHt9CiAgICAgICAgICAgIHNvdXJjZV9tZWRpYVsndXJsJ10gPSBzb3VyY2VfdXJsCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWyd0aXRsZSddID0gbWVkaWFfaW5mby50aXRsZS5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWyd0aHVtYm5haWwnXSA9IG1lZGlhX2luZm8udGh1bWJuYWlsLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ2ZhbmFydCddID0gbWVkaWFfaW5mby5mYW5hcnQuc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZ2VucmUnXSA9IG1lZGlhX2luZm8uZ2VucmUuc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZGVzY3JpcHRpb24nXSA9IG1lZGlhX2luZm8uZGVzY3JpcHRpb24uc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZGF0ZSddID0gbWVkaWFfaW5mby5kYXRlLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ2NyZWRpdHMnXSA9IG1lZGlhX2luZm8uY3JlZGl0cy5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgJy8nIGluIHNvdXJjZV91cmw6CiAgICAgICAgICAgICAgICBuYW1lU3RyID0gc291cmNlX3VybC5zcGxpdCgnLycpWy0xXS5zcGxpdCgnLicpWzBdCiAgICAgICAgICAgIGlmICdcXCcgaW4gc291cmNlX3VybDoKICAgICAgICAgICAgICAgIG5hbWVTdHIgPSBzb3VyY2VfdXJsLnNwbGl0KCdcXCcpWy0xXS5zcGxpdCgnLicpWzBdCiAgICAgICAgICAgIGlmICclJyBpbiBuYW1lU3RyOgogICAgICAgICAgICAgICAgbmFtZVN0ciA9IHVybGxpYi51bnF1b3RlX3BsdXMobmFtZVN0cikKICAgICAgICAgICAga2V5Ym9hcmQgPSB4Ym1jLktleWJvYXJkKG5hbWVTdHIsJ0Rpc3BsYXllZCBOYW1lLCBSZW5hbWU/JykKICAgICAgICAgICAga2V5Ym9hcmQuZG9Nb2RhbCgpCiAgICAgICAgICAgIGlmIChrZXlib2FyZC5pc0NvbmZpcm1lZCgpID09IEZhbHNlKToKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBuZXdTdHIgPSBrZXlib2FyZC5nZXRUZXh0KCkKICAgICAgICAgICAgaWYgbGVuKG5ld1N0cikgPT0gMDoKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBzb3VyY2VfbWVkaWEgPSB7fQogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ3RpdGxlJ10gPSBuZXdTdHIKICAgICAgICAgICAgc291cmNlX21lZGlhWyd1cmwnXSA9IHNvdXJjZV91cmwKICAgICAgICAgICAgc291cmNlX21lZGlhWydmYW5hcnQnXSA9IGZhbmFydAoKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PUZhbHNlOgogICAgICAgICAgICBzb3VyY2VfbGlzdCA9IFtdCiAgICAgICAgICAgIHNvdXJjZV9saXN0LmFwcGVuZChzb3VyY2VfbWVkaWEpCiAgICAgICAgICAgIGIgPSBvcGVuKHNvdXJjZV9maWxlLCJ3IikKICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKHNvdXJjZV9saXN0KSkKICAgICAgICAgICAgYi5jbG9zZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc291cmNlcyA9IGpzb24ubG9hZHMob3Blbihzb3VyY2VfZmlsZSwiciIpLnJlYWQoKSkKICAgICAgICAgICAgc291cmNlcy5hcHBlbmQoc291cmNlX21lZGlhKQogICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpCiAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhzb3VyY2VzKSkKICAgICAgICAgICAgYi5jbG9zZSgpCiAgICAgICAgYWRkb24uc2V0U2V0dGluZygnbmV3X3VybF9zb3VyY2UnLCAiIikKICAgICAgICBhZGRvbi5zZXRTZXR0aW5nKCduZXdfZmlsZV9zb3VyY2UnLCAiIikKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbih0dmRpcmV0byxOZXcgc291cmNlIGFkZGVkLiw1MDAwLCIraWNvbisiKSIpCiAgICAgICAgaWYgbm90IHVybCBpcyBOb25lOgogICAgICAgICAgICBpZiAneGJtY3BsdXMueGIuZnVucGljLmRlJyBpbiB1cmw6CiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5VcGRhdGUoJXM/bW9kZT0xNCxyZXBsYWNlKSIgJXN5cy5hcmd2WzBdKQogICAgICAgICAgICBlbGlmICdjb21tdW5pdHktbGlua3MnIGluIHVybDoKICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuQ29udGFpbmVyLlVwZGF0ZSglcz9tb2RlPTEwLHJlcGxhY2UpIiAlc3lzLmFyZ3ZbMF0pCiAgICAgICAgZWxzZTogYWRkb24ub3BlblNldHRpbmdzKCkKCmRlZiBybVNvdXJjZShuYW1lKToKICAgICAgICBzb3VyY2VzID0ganNvbi5sb2FkcyhvcGVuKHNvdXJjZV9maWxlLCJyIikucmVhZCgpKQogICAgICAgIGZvciBpbmRleCBpbiByYW5nZShsZW4oc291cmNlcykpOgogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHNvdXJjZXNbaW5kZXhdLCBsaXN0KToKICAgICAgICAgICAgICAgIGlmIHNvdXJjZXNbaW5kZXhdWzBdID09IG5hbWU6CiAgICAgICAgICAgICAgICAgICAgZGVsIHNvdXJjZXNbaW5kZXhdCiAgICAgICAgICAgICAgICAgICAgYiA9IG9wZW4oc291cmNlX2ZpbGUsInciKQogICAgICAgICAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhzb3VyY2VzKSkKICAgICAgICAgICAgICAgICAgICBiLmNsb3NlKCkKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgc291cmNlc1tpbmRleF1bJ3RpdGxlJ10gPT0gbmFtZToKICAgICAgICAgICAgICAgICAgICBkZWwgc291cmNlc1tpbmRleF0KICAgICAgICAgICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpCiAgICAgICAgICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKHNvdXJjZXMpKQogICAgICAgICAgICAgICAgICAgIGIuY2xvc2UoKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Db250YWluZXIuUmVmcmVzaCIpCgpkZWYgZ2V0X3htbF9kYXRhYmFzZSh1cmwsIGJyb3dzZT1GYWxzZSk6CiAgICAgICAgaWYgdXJsIGlzIE5vbmU6CiAgICAgICAgICAgIHVybCA9ICdodHRwOi8veGJtY3BsdXMueGIuZnVucGljLmRlL3d3dy1kYXRhL2ZpbGVzeXN0ZW0vJwogICAgICAgIHNvdXAgPSBCZWF1dGlmdWxTb3VwKG1ha2VSZXF1ZXN0KHVybCksIGNvbnZlcnRFbnRpdGllcz1CZWF1dGlmdWxTb3VwLkhUTUxfRU5USVRJRVMpCiAgICAgICAgZm9yIGkgaW4gc291cCgnYScpOgogICAgICAgICAgICBocmVmID0gaVsnaHJlZiddCiAgICAgICAgICAgIGlmIG5vdCBocmVmLnN0YXJ0c3dpdGgoJz8nKToKICAgICAgICAgICAgICAgIG5hbWUgPSBpLnN0cmluZwogICAgICAgICAgICAgICAgaWYgbmFtZSBub3QgaW4gWydQYXJlbnQgRGlyZWN0b3J5JywgJ3JlY3ljbGVfYmluLyddOgogICAgICAgICAgICAgICAgICAgIGlmIGhyZWYuZW5kc3dpdGgoJy8nKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYnJvd3NlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMTUsaWNvbixmYW5hcnQsJycsJycsJycpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxNCxpY29uLGZhbmFydCwnJywnJywnJykKICAgICAgICAgICAgICAgICAgICBlbGlmIGhyZWYuZW5kc3dpdGgoJy54bWwnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYnJvd3NlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc291cmNlX2ZpbGUpPT1UcnVlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5hbWUgaW4gU09VUkNFUzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUrJyAoaW4gdXNlKScsdXJsK2hyZWYsMTEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQoKCmRlZiBnZXRDb21tdW5pdHlTb3VyY2VzKGJyb3dzZT1GYWxzZSk6CiAgICAgICAgdXJsID0gJ2h0dHA6Ly9jb21tdW5pdHktbGlua3MuZ29vZ2xlY29kZS5jb20vc3ZuL3RydW5rLycKICAgICAgICBzb3VwID0gQmVhdXRpZnVsU291cChtYWtlUmVxdWVzdCh1cmwpLCBjb252ZXJ0RW50aXRpZXM9QmVhdXRpZnVsU291cC5IVE1MX0VOVElUSUVTKQogICAgICAgIGZpbGVzID0gc291cCgndWwnKVswXSgnbGknKVsxOl0KICAgICAgICBmb3IgaSBpbiBmaWxlczoKICAgICAgICAgICAgbmFtZSA9IGkoJ2EnKVswXVsnaHJlZiddCiAgICAgICAgICAgIGlmIGJyb3dzZToKICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtuYW1lLDEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtuYW1lLDExLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpCgpkZWYgZ2V0U291cCh1cmwsZGF0YT1Ob25lKToKICAgICAgICBpZiB1cmwuc3RhcnRzd2l0aCgnaHR0cDovLycpIG9yIHVybC5zdGFydHN3aXRoKCdodHRwczovLycpOgogICAgICAgICAgICBkYXRhID0gbWFrZVJlcXVlc3QodXJsKQogICAgICAgICAgICBpZiByZS5zZWFyY2goIiNFWFRNM1UiLGRhdGEpIG9yICdtM3UnIGluIHVybDoKICAgICAgICAgICAgICAgIHByaW50ICdmb3VuZCBtM3UgZGF0YScKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgZWxpZiBkYXRhID09IE5vbmU6CiAgICAgICAgICAgIGlmIG5vdCAnLycgIGluIHVybCBvciBub3QgJ1xcJyBpbiB1cmw6CiAgICAgICAgICAgICAgICBwcmludCAnTm8gZGlyZWN0b3J5IGZvdW5kLiBMZXRzIG1ha2UgdGhlIHVybCB0byBjYWNoZSBkaXInCiAgICAgICAgICAgICAgICB1cmwgPSBvcy5wYXRoLmpvaW4oY29tbXVuaXR5ZmlsZXMsdXJsKQogICAgICAgICAgICBpZiB4Ym1jdmZzLmV4aXN0cyh1cmwpOgogICAgICAgICAgICAgICAgaWYgdXJsLnN0YXJ0c3dpdGgoInNtYjovLyIpIG9yIHVybC5zdGFydHN3aXRoKCJuZnM6Ly8iKToKICAgICAgICAgICAgICAgICAgICBjb3B5ID0geGJtY3Zmcy5jb3B5KHVybCwgb3MucGF0aC5qb2luKHByb2ZpbGUsICd0ZW1wJywgJ3NvcmNlX3RlbXAudHh0JykpCiAgICAgICAgICAgICAgICAgICAgaWYgY29weToKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IG9wZW4ob3MucGF0aC5qb2luKHByb2ZpbGUsICd0ZW1wJywgJ3NvcmNlX3RlbXAudHh0JyksICJyIikucmVhZCgpCiAgICAgICAgICAgICAgICAgICAgICAgIHhibWN2ZnMuZGVsZXRlKG9zLnBhdGguam9pbihwcm9maWxlLCAndGVtcCcsICdzb3JjZV90ZW1wLnR4dCcpKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiZmFpbGVkIHRvIGNvcHkgZnJvbSBzbWI6IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IG9wZW4odXJsLCAncicpLnJlYWQoKQogICAgICAgICAgICAgICAgICAgIGlmIHJlLm1hdGNoKCIjRVhUTTNVIixkYXRhKW9yICdtM3UnIGluIHVybDoKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2ZvdW5kIG0zdSBkYXRhJwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCJTb3VwIERhdGEgbm90IGZvdW5kISIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICByZXR1cm4gQmVhdXRpZnVsU09BUChkYXRhLCBjb252ZXJ0RW50aXRpZXM9QmVhdXRpZnVsU3RvbmVTb3VwLlhNTF9FTlRJVElFUykKCgpkZWYgZ2V0RGF0YSh1cmwsZmFuYXJ0LCBkYXRhPU5vbmUpOgogICAgc291cCA9IGdldFNvdXAodXJsLGRhdGEpCiAgICAjcHJpbnQgdHlwZShzb3VwKQogICAgaWYgaXNpbnN0YW5jZShzb3VwLEJlYXV0aWZ1bFNPQVApOgogICAgI3ByaW50ICd4eHh4eHh4eHh4c291cCcsc291cAogICAgICAgIGlmIGxlbihzb3VwKCdjaGFubmVscycpKSA+IDAgYW5kIGFkZG9uLmdldFNldHRpbmcoJ2Rvbm90c2hvd2J5Y2hhbm5lbHMnKSA9PSAnZmFsc2UnOgogICAgICAgICAgICBjaGFubmVscyA9IHNvdXAoJ2NoYW5uZWwnKQogICAgICAgICAgICBmb3IgY2hhbm5lbCBpbiBjaGFubmVsczoKIyAgICAgICAgICAgICAgICBwcmludCBjaGFubmVsCgogICAgICAgICAgICAgICAgbGlua2VkVXJsPScnCiAgICAgICAgICAgICAgICBsY291bnQ9MAogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGxpbmtlZFVybCA9ICBjaGFubmVsKCdleHRlcm5hbGxpbmsnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICBsY291bnQ9bGVuKGNoYW5uZWwoJ2V4dGVybmFsbGluaycpKQogICAgICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgICAgICAjcHJpbnQgJ2xpbmtlZFVybCcsbGlua2VkVXJsLGxjb3VudAogICAgICAgICAgICAgICAgaWYgbGNvdW50PjE6IGxpbmtlZFVybD0nJwoKICAgICAgICAgICAgICAgIG5hbWUgPSBjaGFubmVsKCduYW1lJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSBjaGFubmVsKCd0aHVtYm5haWwnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbCA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBjaGFubmVsKCdmYW5hcnQnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykgPT0gInRydWUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gdGh1bWJuYWlsCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBjaGFubmVsKCdmYW5hcnQnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgZGVzYyA9IGNoYW5uZWwoJ2luZm8nKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICBpZiBkZXNjID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgZGVzYyA9ICcnCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGdlbnJlID0gY2hhbm5lbCgnZ2VucmUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICBpZiBnZW5yZSA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGdlbnJlID0gJycKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgZGF0ZSA9IGNoYW5uZWwoJ2RhdGUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICBpZiBkYXRlID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgZGF0ZSA9ICcnCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGNyZWRpdHMgPSBjaGFubmVsKCdjcmVkaXRzJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgY3JlZGl0cyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGNyZWRpdHMgPSAnJwoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBsaW5rZWRVcmw9PScnOgogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpLHVybC5lbmNvZGUoJ3V0Zi04JyksMix0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxjcmVkaXRzLFRydWUpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGxpbmtlZFVybAogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksbGlua2VkVXJsLmVuY29kZSgndXRmLTgnKSwxLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScpCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCdUaGVyZSB3YXMgYSBwcm9ibGVtIGFkZGluZyBkaXJlY3RvcnkgZnJvbSBnZXREYXRhKCk6ICcrbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFkZG9uX2xvZygnTm8gQ2hhbm5lbHM6IGdldEl0ZW1zJykKICAgICAgICAgICAgZ2V0SXRlbXMoc291cCgnaXRlbScpLGZhbmFydCkKICAgIGVsc2U6CiAgICAgICAgcGFyc2VfbTN1KHNvdXApCiMgYm9ycm93IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2VuZW45Mi9QMlAtU3RyZWFtcy1YQk1DL2Jsb2IvbWFzdGVyL3BsdWdpbi52aWRlby5wMnAtc3RyZWFtcy9yZXNvdXJjZXMvY29yZS9saXZlc3RyZWFtcy5weQojIFRoaXMgd2lsbCBub3QgZ28gdGhyb3VnaCB0aGUgZ2V0SXRlbXMgZnVuY3Rpb25zICggbWVhbnMgeW91IG11c3QgaGF2ZSByZWFkeSB0byBwbGF5IHVybCwgbm8gcmVnZXgpCmRlZiBwYXJzZV9tM3UoZGF0YSk6CiAgICBjb250ZW50ID0gZGF0YS5yc3RyaXAoKQogICAgbWF0Y2ggPSByZS5jb21waWxlKHInI0VYVElORjooLis/KSwoLio/KVtcblxyXSsoW15cclxuXSspJykuZmluZGFsbChjb250ZW50KQogICAgdG90YWwgPSBsZW4obWF0Y2gpCiAgICBwcmludCAndG90YWwgbTN1IGxpbmtzJyx0b3RhbAogICAgZm9yIG90aGVyLGNoYW5uZWxfbmFtZSxzdHJlYW1fdXJsIGluIG1hdGNoOgogICAgICAgIGlmICd0dmctbG9nbycgaW4gb3RoZXI6CiAgICAgICAgICAgIHRodW1ibmFpbCA9IHJlX21lKG90aGVyLCd0dmctbG9nbz1bXCciXSguKj8pW1wnIl0nKQogICAgICAgICAgICBpZiB0aHVtYm5haWw6CiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwuc3RhcnRzd2l0aCgnaHR0cCcpOgogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHRodW1ibmFpbAoKICAgICAgICAgICAgICAgIGVsaWYgbm90IGFkZG9uLmdldFNldHRpbmcoJ2xvZ28tZm9sZGVyUGF0aCcpID09ICIiOgogICAgICAgICAgICAgICAgICAgIGxvZ29fdXJsID0gYWRkb24uZ2V0U2V0dGluZygnbG9nby1mb2xkZXJQYXRoJykKICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSBsb2dvX3VybCArIHRodW1ibmFpbAoKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gdGh1bWJuYWlsCiAgICAgICAgICAgICNlbHNlOgoKICAgICAgICBlbHNlOgogICAgICAgICAgICB0aHVtYm5haWwgPSAnJwogICAgICAgIGlmICd0eXBlJyBpbiBvdGhlcjoKICAgICAgICAgICAgbW9kZV90eXBlID0gcmVfbWUob3RoZXIsJ3R5cGU9W1wnIl0oLio/KVtcJyJdJykKICAgICAgICAgICAgaWYgbW9kZV90eXBlID09ICd5dC1kbCc6CiAgICAgICAgICAgICAgICBzdHJlYW1fdXJsID0gc3RyZWFtX3VybCArIiZtb2RlPTE4IgogICAgICAgICAgICBlbGlmIG1vZGVfdHlwZSA9PSAncmVnZXgnOgogICAgICAgICAgICAgICAgdXJsID0gc3RyZWFtX3VybC5zcGxpdCgnJnJlZ2V4cz0nKQogICAgICAgICAgICAgICAgI3ByaW50IHVybFswXSBnZXRTb3VwKHVybCxkYXRhPU5vbmUpCiAgICAgICAgICAgICAgICByZWdleHMgPSBwYXJzZV9yZWdleChnZXRTb3VwKCcnLGRhdGE9dXJsWzFdKSkKCiAgICAgICAgICAgICAgICBhZGRMaW5rKHVybFswXSwgY2hhbm5lbF9uYW1lLHRodW1ibmFpbCwnJywnJywnJywnJywnJyxOb25lLHJlZ2V4cyx0b3RhbCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGVsaWYgbW9kZV90eXBlID09ICdmdHYnOgogICAgICAgICAgICAgICAgc3RyZWFtX3VybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uRi5ULlYvP25hbWU9Jyt1cmxsaWIucXVvdGUoY2hhbm5lbF9uYW1lKSArJyZ1cmw9JyArc3RyZWFtX3VybCArJyZtb2RlPTEyNSZjaF9mYW5hcnQ9bmEnCiAgICAgICAgYWRkTGluayhzdHJlYW1fdXJsLCBjaGFubmVsX25hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUsJycsdG90YWwpCmRlZiBnZXRDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KToKICAgICAgICBzb3VwID0gZ2V0U291cCh1cmwpCiAgICAgICAgY2hhbm5lbF9saXN0ID0gc291cC5maW5kKCdjaGFubmVsJywgYXR0cnM9eyduYW1lJyA6IG5hbWUuZGVjb2RlKCd1dGYtOCcpfSkKICAgICAgICBpdGVtcyA9IGNoYW5uZWxfbGlzdCgnaXRlbScpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBmYW5BcnQgPSBjaGFubmVsX2xpc3QoJ2ZhbmFydCcpWzBdLnN0cmluZwogICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToKICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQKICAgICAgICBmb3IgY2hhbm5lbCBpbiBjaGFubmVsX2xpc3QoJ3N1YmNoYW5uZWwnKToKICAgICAgICAgICAgbmFtZSA9IGNoYW5uZWwoJ25hbWUnKVswXS5zdHJpbmcKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gY2hhbm5lbCgndGh1bWJuYWlsJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSAnJwogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBub3QgY2hhbm5lbCgnZmFuYXJ0Jyk6CiAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykgPT0gInRydWUiOgogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSB0aHVtYm5haWwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gY2hhbm5lbCgnZmFuYXJ0JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRlc2MgPSBjaGFubmVsKCdpbmZvJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBkZXNjID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZGVzYyA9ICcnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBnZW5yZSA9IGNoYW5uZWwoJ2dlbnJlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBnZW5yZSA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGdlbnJlID0gJycKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRhdGUgPSBjaGFubmVsKCdkYXRlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBkYXRlID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZGF0ZSA9ICcnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjcmVkaXRzID0gY2hhbm5lbCgnY3JlZGl0cycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgY3JlZGl0cyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGNyZWRpdHMgPSAnJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx1cmwuZW5jb2RlKCd1dGYtOCcpLDMsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGNyZWRpdHMsZGF0ZSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdUaGVyZSB3YXMgYSBwcm9ibGVtIGFkZGluZyBkaXJlY3RvcnkgLSAnK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkKICAgICAgICBnZXRJdGVtcyhpdGVtcyxmYW5BcnQpCgoKZGVmIGdldFN1YkNoYW5uZWxJdGVtcyhuYW1lLHVybCxmYW5hcnQpOgogICAgICAgIHNvdXAgPSBnZXRTb3VwKHVybCkKICAgICAgICBjaGFubmVsX2xpc3QgPSBzb3VwLmZpbmQoJ3N1YmNoYW5uZWwnLCBhdHRycz17J25hbWUnIDogbmFtZS5kZWNvZGUoJ3V0Zi04Jyl9KQogICAgICAgIGl0ZW1zID0gY2hhbm5lbF9saXN0KCdzdWJpdGVtJykKICAgICAgICBnZXRJdGVtcyhpdGVtcyxmYW5hcnQpCgpkZWYgZ2V0SXRlbXMoaXRlbXMsZmFuYXJ0KToKICAgICAgICB0b3RhbCA9IGxlbihpdGVtcykKICAgICAgICBhZGRvbl9sb2coJ1RvdGFsIEl0ZW1zOiAlcycgJXRvdGFsKQogICAgICAgIGFkZF9wbGF5bGlzdCA9IGFkZG9uLmdldFNldHRpbmcoJ2FkZF9wbGF5bGlzdCcpCiAgICAgICAgYXNrX3BsYXlsaXN0X2l0ZW1zID1hZGRvbi5nZXRTZXR0aW5nKCdhc2tfcGxheWxpc3RfaXRlbXMnKQogICAgICAgIHVzZV90aHVtYiA9IGFkZG9uLmdldFNldHRpbmcoJ3VzZV90aHVtYicpCiAgICAgICAgcGFyZW50YWxibG9jayA9YWRkb24uZ2V0U2V0dGluZygncGFyZW50YWxibG9ja2VkJykKICAgICAgICBwYXJlbnRhbGJsb2NrPSBwYXJlbnRhbGJsb2NrPT0idHJ1ZSIKICAgICAgICBwcmVtaXVtcGluID1hZGRvbi5nZXRTZXR0aW5nKCdwcmVtaXVtcGluJykKICAgICAgICBwcmVtaXVtcGluID0gcHJlbWl1bXBpbj09Ik5hdGFsTWFuaWFjIgogICAgICAgIGZvciBpdGVtIGluIGl0ZW1zOgogICAgICAgICAgICBpc1hNTFNvdXJjZT1GYWxzZQogICAgICAgICAgICBpc0pzb25ycGMgPSBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgYXA9J2ZhbHNlJwogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBhcCA9IGl0ZW0oJ3ByZW1pdW0nKVswXS5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWRkb25fbG9nKGFwKQogICAgICAgICAgICAgICAgYXAgPSAnJwogICAgICAgICAgICBpZiBhcD09J3RydWUnOgogICAgICAgICAgICAgICAgaWYgbm90IHByZW1pdW1waW46IGNvbnRpbnVlCgkJCQoJCQkKICAgICAgICAgICAgYXBwbHlibG9jaz0nZmFsc2UnCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGFwcGx5YmxvY2sgPSBpdGVtKCdwYXJlbnRhbGJsb2NrJylbMF0uc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygncGFyZW50YWxibG9jayBFcnJvcicpCiAgICAgICAgICAgICAgICBhcHBseWJsb2NrID0gJycKICAgICAgICAgICAgaWYgYXBwbHlibG9jaz09J3RydWUnIGFuZCBwYXJlbnRhbGJsb2NrOiBjb250aW51ZQogICAgICAgICAgICAKCQkJCgkJCQoJCQkKCQkJCgkJCQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG5hbWUgPSBpdGVtKCd0aXRsZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgbmFtZSBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIG5hbWUgPSAndW5rbm93bj8nCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnTmFtZSBFcnJvcicpCiAgICAgICAgICAgICAgICBuYW1lID0gJycKCQkJCQoJCQkJCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBpdGVtKCdlcGcnKToKICAgICAgICAgICAgICAgICAgICBpZiBpdGVtLmVwZ191cmw6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnR2V0IEVQRyBSZWdleCcpCiAgICAgICAgICAgICAgICAgICAgICAgIGVwZ191cmwgPSBpdGVtLmVwZ191cmwuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGVwZ19yZWdleCA9IGl0ZW0uZXBnX3JlZ2V4LnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBlcGdfbmFtZSA9IGdldF9lcGcoZXBnX3VybCwgZXBnX3JlZ2V4KQogICAgICAgICAgICAgICAgICAgICAgICBpZiBlcGdfbmFtZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgKz0gJyAtICcgKyBlcGdfbmFtZQogICAgICAgICAgICAgICAgICAgIGVsaWYgaXRlbSgnZXBnJylbMF0uc3RyaW5nID4gMToKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSArPSBnZXRlcGcoaXRlbSgnZXBnJylbMF0uc3RyaW5nKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnRVBHIEVycm9yJykKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdXJsID0gW10KICAgICAgICAgICAgICAgIGlmIGxlbihpdGVtKCdsaW5rJykpID4wOgogICAgICAgICAgICAgICAgICAgICNwcmludCAnaXRlbSBsaW5rJywgaXRlbSgnbGluaycpCgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2xpbmsnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGkuc3RyaW5nKQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnbG9uaycpKSA+MDoKICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2l0ZW0gbGluaycsIGl0ZW0oJ2xpbmsnKQoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdsb25rJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChpLnN0cmluZykKCQkJCQkJCQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnc3BvcnRzZGV2aWwnKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnc3BvcnRzZGV2aWwnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcG9ydHNkZXZpbCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uU3BvcnRzRGV2aWwvP21vZGU9MSZhbXA7aXRlbT1jYXRjaGVyJTNkc3RyZWFtcyUyNnVybD0nICtpLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlciA9IGl0ZW0oJ3JlZmVyZXInKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlZmVyZXI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdyZWZlcmVyIGZvdW5kJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwb3J0c2RldmlsID0gc3BvcnRzZGV2aWwgKyAnJTI2cmVmZXJlcj0nICtyZWZlcmVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHNwb3J0c2RldmlsKQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgncDJwJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3AycCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICdzb3A6Ly8nIGluIGkuc3RyaW5nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvcCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucDJwLXN0cmVhbXMvP21vZGU9MnVybD0nK2kuc3RyaW5nICsnJicgKyAnbmFtZT0nK25hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHNvcCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcDJwPSdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucDJwLXN0cmVhbXMvP21vZGU9MSZ1cmw9JytpLnN0cmluZyArJyYnICsgJ25hbWU9JytuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChwMnApCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCd2YXVnaG4nKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgndmF1Z2huJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmF1Z2huID0gJ3BsdWdpbjovL3BsdWdpbi5zdHJlYW0udmF1Z2hubGl2ZS50di8/bW9kZT1QbGF5TGl2ZVN0cmVhbSZhbXA7Y2hhbm5lbD0nK2kuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHZhdWdobikKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2lsaXZlJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2lsaXZlJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90ICdodHRwJyBpbiBpLnN0cmluZzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbGl2ZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8udGJoLmlsaXZlLz91cmw9aHR0cDovL3d3dy5zdHJlYW1saXZlLnRvL3ZpZXcvJytpLnN0cmluZysnJmFtcDtsaW5rPTk5JmFtcDttb2RlPWlMaXZlUGxheScKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWxpdmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnRiaC5pbGl2ZS8/dXJsPScraS5zdHJpbmcrJyZhbXA7bGluaz05OSZhbXA7bW9kZT1pTGl2ZVBsYXknCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCd5dC1kbCcpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCd5dC1kbCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHl0ZGwgPSBpLnN0cmluZyArICcmbW9kZT0xOCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoeXRkbCkKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2RtJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2RtJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG0gPSAicGx1Z2luOi8vcGx1Z2luLnZpZGVvLmRhaWx5bW90aW9uX2NvbS8/bW9kZT1wbGF5VmlkZW8mdXJsPSIgKyBpLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChkbSkKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2RtbGl2ZScpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdkbWxpdmUnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbSA9ICJwbHVnaW46Ly9wbHVnaW4udmlkZW8uZGFpbHltb3Rpb25fY29tLz9tb2RlPXBsYXlMaXZlVmlkZW8mdXJsPSIgKyBpLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChkbSkKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3V0dWJlJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3V0dWJlJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyAnIGluIGkuc3RyaW5nIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dHViZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9zZWFyY2gvP3E9JysgdXJsbGliLnF1b3RlX3BsdXMoaS5zdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNKc29ucnBjPXV0dWJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGxlbihpLnN0cmluZykgPT0gMTE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/dmlkZW9faWQ9JysgaS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgKGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1BMJykgYW5kIG5vdCAnJm9yZGVyPScgaW4gaS5zdHJpbmcpIG9yIGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1VVJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/Jm9yZGVyPWRlZmF1bHQmcGxheWxpc3RfaWQ9JyArIGkuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1BMJykgb3IgaS5zdHJpbmcuc3RhcnRzd2l0aCgnVVUnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dHViZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9wbGF5Lz9wbGF5bGlzdF9pZD0nICsgaS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgaS5zdHJpbmcuc3RhcnRzd2l0aCgnVUMnKSBhbmQgbGVuKGkuc3RyaW5nKSA+IDEyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL2NoYW5uZWwvJyArIGkuc3RyaW5nICsgJy8nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNKc29ucnBjPXV0dWJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIG5vdCBpLnN0cmluZy5zdGFydHN3aXRoKCdVQycpIGFuZCBub3QgKGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1BMJykpICA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvdXNlci8nICsgaS5zdHJpbmcgKyAnLycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0pzb25ycGM9dXR1YmUKICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZCh1dHViZSkKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2ltZGInKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnaW1kYicpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2dlbmVzaXNvcnB1bHNhcicpID09ICcwJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWRiID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5nZW5lc2lzLz9hY3Rpb249cGxheSZpbWRiPScraS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1kYiA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucHVsc2FyL21vdmllL3R0JytpLnN0cmluZysnL3BsYXknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGltZGIpCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdmNG0nKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2Y0bScpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJy5mNG0nIGluIGkuc3RyaW5nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmNG0gPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3Rlci8/dXJsPScrdXJsbGliLnF1b3RlX3BsdXMoaS5zdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAnLm0zdTgnIGluIGkuc3RyaW5nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmNG0gPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3Rlci8/dXJsPScrdXJsbGliLnF1b3RlX3BsdXMoaS5zdHJpbmcpKycmYW1wO3N0cmVhbXR5cGU9SExTJwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmNG0gPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3Rlci8/dXJsPScrdXJsbGliLnF1b3RlX3BsdXMoaS5zdHJpbmcpKycmYW1wO3N0cmVhbXR5cGU9U0lNUExFJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChmNG0pCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdmdHYnKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnZnR2Jyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnR2ID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5GLlQuVi8/bmFtZT0nK3VybGxpYi5xdW90ZShuYW1lKSArJyZ1cmw9JyAraS5zdHJpbmcgKycmbW9kZT0xMjUmY2hfZmFuYXJ0PW5hJwogICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGZ0dikKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3VybHNvbHZlJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3VybHNvbHZlJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIgPSBpLnN0cmluZyArJyZtb2RlPTE5JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChyZXNvbHZlcikKICAgICAgICAgICAgICAgIGlmIGxlbih1cmwpIDwgMToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ0Vycm9yIDxsaW5rPiBlbGVtZW50LCBQYXNzaW5nOicrbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaXNYTUxTb3VyY2UgPSBpdGVtKCdleHRlcm5hbGxpbmsnKVswXS5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCgogICAgICAgICAgICBpZiBpc1hNTFNvdXJjZToKICAgICAgICAgICAgICAgIGV4dF91cmw9W2lzWE1MU291cmNlXQogICAgICAgICAgICAgICAgaXNYTUxTb3VyY2U9VHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaXNYTUxTb3VyY2U9RmFsc2UKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaXNKc29ucnBjID0gaXRlbSgnanNvbnJwYycpWzBdLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgaWYgaXNKc29ucnBjOgoKICAgICAgICAgICAgICAgIGV4dF91cmw9W2lzSnNvbnJwY10KICAgICAgICAgICAgICAgICNwcmludCAnSlNPTi1SUEMgZXh0X3VybCcsZXh0X3VybAogICAgICAgICAgICAgICAgaXNKc29ucnBjPVRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlzSnNvbnJwYz1GYWxzZQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSBpdGVtKCd0aHVtYm5haWwnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbCA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIG5vdCBpdGVtKCdmYW5hcnQnKToKICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IHRodW1ibmFpbAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBpdGVtKCdmYW5hcnQnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGZhbkFydCA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkZXNjID0gaXRlbSgnaW5mbycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZGVzYyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGRlc2MgPSAnJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZ2VucmUgPSBpdGVtKCdnZW5yZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZ2VucmUgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBnZW5yZSA9ICcnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkYXRlID0gaXRlbSgnZGF0ZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZGF0ZSA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGRhdGUgPSAnJwoKICAgICAgICAgICAgcmVnZXhzID0gTm9uZQogICAgICAgICAgICBpZiBpdGVtKCdyZWdleCcpOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHJlZ19pdGVtID0gaXRlbSgncmVnZXgnKQogICAgICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHBhcnNlX3JlZ2V4KHJlZ19pdGVtKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgbGVuKHVybCkgPiAxOgogICAgICAgICAgICAgICAgICAgIGFsdCA9IDAKICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdCA9IFtdCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gdXJsOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgIGFkZF9wbGF5bGlzdCA9PSAiZmFsc2UiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsdCArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkTGluayhpLCclcykgJXMnICUoYWx0LCBuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLFRydWUscGxheWxpc3QscmVnZXhzLHRvdGFsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAgYWRkX3BsYXlsaXN0ID09ICJ0cnVlIiBhbmQgIGFza19wbGF5bGlzdF9pdGVtcyA9PSAndHJ1ZSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVnZXhzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSsnJnJlZ2V4cz0nK3JlZ2V4cykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmICBhbnkoeCBpbiBpIGZvciB4IGluIHJlc29sdmVfdXJsKSBhbmQgIGkuc3RhcnRzd2l0aCgnaHR0cCcpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSsnJm1vZGU9MTknKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFwcGVuZChpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSkKICAgICAgICAgICAgICAgICAgICBpZiBsZW4ocGxheWxpc3QpID4gMToKICAgICAgICAgICAgICAgICAgICAgICAgYWRkTGluaygnJywgbmFtZSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgaWYgaXNYTUxTb3VyY2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcmVnZXhzID09IE5vbmU6ICM8ZXh0ZXJuYWxsaW5rPiBhbmQgPHJlZ2V4PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxleHRfdXJsWzBdLmVuY29kZSgndXRmLTgnKSwxLHRodW1ibmFpbCxmYW5hcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJyEhdXBkYXRlJyxyZWdleHMsdXJsWzBdLmVuY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjYWRkTGluayh1cmxbMF0sbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKyAgJ1tDT0xPUiB5ZWxsb3ddYnVpbGQgWE1MWy9DT0xPUl0nLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLFRydWUsTm9uZSxyZWdleHMsdG90YWwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxleHRfdXJsWzBdLmVuY29kZSgndXRmLTgnKSwxLHRodW1ibmFpbCxmYW5hcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScsTm9uZSxOb25lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksdXJsWzBdLmVuY29kZSgndXRmLTgnKSwxLHRodW1ibmFpbCxmYW5hcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBpc0pzb25ycGM6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxleHRfdXJsWzBdLDUzLHRodW1ibmFpbCxmYW5hcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScpCiAgICAgICAgICAgICAgICAgICAgICAgICN4Ym1jLmV4ZWN1dGVidWlsdGluKCJDb250YWluZXIuU2V0Vmlld01vZGUoNTAwKSIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgYWRkTGluayh1cmxbMF0sbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLFRydWUsTm9uZSxyZWdleHMsdG90YWwpCiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdzdWNjZXNzJwogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1RoZXJlIHdhcyBhIHByb2JsZW0gYWRkaW5nIGl0ZW0gLSAnK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkKCmRlZiBwYXJzZV9yZWdleChyZWdfaXRlbSk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcmVnZXhzID0ge30KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByZWdfaXRlbToKICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddID0ge30KICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWyduYW1lJ109aSgnbmFtZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAjcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZXMnXSA9IGkoJ2V4cHJlcycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2V4cHJlcyddID0gaSgnZXhwcmVzJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZXMnXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2V4cHJlcyddPScnCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFJlZmVyZXIgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3BhZ2UnXSA9IGkoJ3BhZ2UnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydyZWZlcmVyJ10gPSBpKCdyZWZlcmVyJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFJlZmVyZXIgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2Nvbm5lY3Rpb24nXSA9IGkoJ2Nvbm5lY3Rpb24nKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gY29ubmVjdGlvbiAtLSIpCgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ25vdHBsYXlhYmxlJ10gPSBpKCdub3RwbGF5YWJsZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBub3RwbGF5YWJsZSAtLSIpCgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ25vcmVkaXJlY3QnXSA9IGkoJ25vcmVkaXJlY3QnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gbm9yZWRpcmVjdCAtLSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnb3JpZ2luJ10gPSBpKCdvcmlnaW4nKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gb3JpZ2luIC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydhY2NlcHQnXSA9IGkoJ2FjY2VwdCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBhY2NlcHQgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2luY2x1ZGVoZWFkZXJzJ10gPSBpKCdpbmNsdWRlaGVhZGVycycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBpbmNsdWRlaGVhZGVycyAtLSIpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnbGlzdHJlcGVhdCddID0gaSgnbGlzdHJlcGVhdCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2xpc3RyZXBlYXQnLHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnbGlzdHJlcGVhdCddLGkoJ2xpc3RyZXBlYXQnKVswXS5zdHJpbmcsIGkKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gbGlzdHJlcGVhdCAtLSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncHJveHknXSA9IGkoJ3Byb3h5JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIHByb3h5IC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3gtcmVxJ10gPSBpKCd4LXJlcScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyB4LXJlcSAtLSIpCgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3gtYWRkciddID0gaSgneC1hZGRyJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIHgtYWRkciAtLSIpICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsneC1mb3J3YXJkJ10gPSBpKCd4LWZvcndhcmQnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8geC1mb3J3YXJkIC0tIikKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnYWdlbnQnXSA9IGkoJ2FnZW50JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFVzZXIgQWdlbnQgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3Bvc3QnXSA9IGkoJ3Bvc3QnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgcG9zdCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncmF3cG9zdCddID0gaSgncmF3cG9zdCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSByYXdwb3N0IikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydodG1sdW5lc2NhcGUnXSA9IGkoJ2h0bWx1bmVzY2FwZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBodG1sdW5lc2NhcGUiKQoKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncmVhZGNvb2tpZW9ubHknXSA9IGkoJ3JlYWRjb29raWVvbmx5JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHJlYWRDb29raWVPbmx5IikKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGkKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb29raWVqYXInXSA9IGkoJ2Nvb2tpZWphcicpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnY29va2llamFyJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb29raWVqYXInXT0nJwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBjb29raWVKYXIiKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3NldGNvb2tpZSddID0gaSgnc2V0Y29va2llJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHNldGNvb2tpZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnYXBwZW5kY29va2llJ10gPSBpKCdhcHBlbmRjb29raWUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgYXBwZW5kY29va2llIikKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaWdub3JlY2FjaGUnXSA9IGkoJ2lnbm9yZWNhY2hlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIG5vIGlnbm9yZWNhY2hlIikKICAgICAgICAgICAgICAgICAgICAgICAgI3RyeToKICAgICAgICAgICAgICAgICAgICAgICAgIyAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2lnbm9yZWNhY2hlJ10gPSBpKCdpZ25vcmVjYWNoZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAjZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAjICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIG5vIGlnbm9yZWNhY2hlIikKCiAgICAgICAgICAgICAgICAgICAgcmVnZXhzID0gdXJsbGliLnF1b3RlKHJlcHIocmVnZXhzKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZXhzCiAgICAgICAgICAgICAgICAgICAgI3ByaW50IHJlZ2V4cwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHJlZ2V4cyA9IE5vbmUKICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ3JlZ2V4IEVycm9yOiAnK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkKI2NvcGllcyBmcm9tIGxhbWRhJ3MgaW1wbGVtZW50YXRpb24KZGVmIGdldF91c3RyZWFtKHVybCk6CiAgICB0cnk6CiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMSwgNTEpOgogICAgICAgICAgICByZXN1bHQgPSBnZXRVcmwodXJsKQogICAgICAgICAgICBpZiAiRVhULVgtU1RSRUFNLUlORiIgaW4gcmVzdWx0OiByZXR1cm4gdXJsCiAgICAgICAgICAgIGlmIG5vdCAiRVhUTTNVIiBpbiByZXN1bHQ6IHJldHVybgogICAgICAgICAgICB4Ym1jLnNsZWVwKDIwMDApCiAgICAgICAgcmV0dXJuCiAgICBleGNlcHQ6CiAgICAgICAgcmV0dXJuCgpkZWYgZ2V0UmVnZXhQYXJzZWQocmVnZXhzLCB1cmwsY29va2llSmFyPU5vbmUsZm9yQ29va2llSmFyT25seT1GYWxzZSxyZWN1cnNpdmVDYWxsPUZhbHNlLGNhY2hlZFBhZ2VzPXt9LCByYXdQb3N0PUZhbHNlLCBjb29raWVfamFyX2ZpbGU9Tm9uZSk6IzAsMSwyID0gVVJMLCByZWdleE9ubHksIENvb2tpZUphck9ubHkKICAgICAgICBpZiBub3QgcmVjdXJzaXZlQ2FsbDoKICAgICAgICAgICAgcmVnZXhzID0gZXZhbCh1cmxsaWIudW5xdW90ZShyZWdleHMpKQogICAgICAgICNjYWNoZWRQYWdlcyA9IHt9CiAgICAgICAgI3ByaW50ICd1cmwnLHVybAogICAgICAgIGRvUmVnZXhzID0gcmUuY29tcGlsZSgnXCRkb3JlZ2V4XFsoW15cXV0qKVxdJykuZmluZGFsbCh1cmwpCiMgICAgICAgIHByaW50ICdkb1JlZ2V4cycsZG9SZWdleHMscmVnZXhzCiAgICAgICAgc2V0cmVzb2x2ZWQ9VHJ1ZQogICAgICAgIGZvciBrIGluIGRvUmVnZXhzOgogICAgICAgICAgICBpZiBrIGluIHJlZ2V4czoKICAgICAgICAgICAgICAgICNwcmludCAncHJvY2Vzc2luZyAnICxrCiAgICAgICAgICAgICAgICBtID0gcmVnZXhzW2tdCiAgICAgICAgICAgICAgICAjcHJpbnQgbQogICAgICAgICAgICAgICAgY29va2llSmFyUGFyYW09RmFsc2UKICAgICAgICAgICAgICAgIGlmICAnY29va2llamFyJyBpbiBtOiAjIHNvIGVpdGhlciBjcmVhdGUgb3IgcmV1c2UgZXhpc3RpbmcgamFyCiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdjb29raWVqYXIgZXhpc3RzJyxtWydjb29raWVqYXInXQogICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPW1bJ2Nvb2tpZWphciddCiAgICAgICAgICAgICAgICAgICAgaWYgICckZG9yZWdleCcgaW4gY29va2llSmFyUGFyYW06CiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphcj1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ2Nvb2tpZWphciddLGNvb2tpZUphcixUcnVlLCBUcnVlLGNhY2hlZFBhZ2VzKQogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXJQYXJhbT1UcnVlCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyUGFyYW09VHJ1ZQogICAgICAgICAgICAgICAgI3ByaW50ICdtW2Nvb2tpZWphcl0nLG1bJ2Nvb2tpZWphciddLGNvb2tpZUphcgogICAgICAgICAgICAgICAgaWYgY29va2llSmFyUGFyYW06CiAgICAgICAgICAgICAgICAgICAgaWYgY29va2llSmFyPT1Ob25lOgogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2NyZWF0ZSBjb29raWUgamFyJwogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9Tm9uZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnb3BlblsnIGluIG1bJ2Nvb2tpZWphciddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llX2phcl9maWxlPW1bJ2Nvb2tpZWphciddLnNwbGl0KCdvcGVuWycpWzFdLnNwbGl0KCddJylbMF0KCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphcj1nZXRDb29raWVKYXIoY29va2llX2phcl9maWxlKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBjb29raWVfamFyX2ZpbGU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlQ29va2llSmFyKGNvb2tpZUphcixjb29raWVfamFyX2ZpbGUpCiAgICAgICAgICAgICAgICAgICAgICAgICNpbXBvcnQgY29va2llbGliCiAgICAgICAgICAgICAgICAgICAgICAgICNjb29raWVKYXIgPSBjb29raWVsaWIuTFdQQ29va2llSmFyKCkKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdjb29raWVKYXIgbmV3Jyxjb29raWVKYXIKICAgICAgICAgICAgICAgICAgICBlbGlmICdzYXZlWycgaW4gbVsnY29va2llamFyJ106CiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZV9qYXJfZmlsZT1tWydjb29raWVqYXInXS5zcGxpdCgnc2F2ZVsnKVsxXS5zcGxpdCgnXScpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlX3BhdGg9b3MucGF0aC5qb2luKHByb2ZpbGUsY29va2llX2phcl9maWxlKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnY29tcGxldGVfcGF0aCcsY29tcGxldGVfcGF0aAogICAgICAgICAgICAgICAgICAgICAgICBzYXZlQ29va2llSmFyKGNvb2tpZUphcixjb29raWVfamFyX2ZpbGUpCiAgICAgICAgICAgICAgICBpZiAgbVsncGFnZSddIGFuZCAnJGRvcmVnZXgnIGluIG1bJ3BhZ2UnXToKICAgICAgICAgICAgICAgICAgICBtWydwYWdlJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydwYWdlJ10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykKCiAgICAgICAgICAgICAgICBpZiAnc2V0Y29va2llJyBpbiBtIGFuZCBtWydzZXRjb29raWUnXSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydzZXRjb29raWUnXToKICAgICAgICAgICAgICAgICAgICBtWydzZXRjb29raWUnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ3NldGNvb2tpZSddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpCiAgICAgICAgICAgICAgICBpZiAnYXBwZW5kY29va2llJyBpbiBtIGFuZCBtWydhcHBlbmRjb29raWUnXSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydhcHBlbmRjb29raWUnXToKICAgICAgICAgICAgICAgICAgICBtWydhcHBlbmRjb29raWUnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ2FwcGVuZGNvb2tpZSddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpCgoKICAgICAgICAgICAgICAgIGlmICAncG9zdCcgaW4gbSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydwb3N0J106CiAgICAgICAgICAgICAgICAgICAgbVsncG9zdCddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsncG9zdCddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3Bvc3QgaXMgbm93JyxtWydwb3N0J10KCiAgICAgICAgICAgICAgICBpZiAgJ3Jhd3Bvc3QnIGluIG0gYW5kICckZG9yZWdleCcgaW4gbVsncmF3cG9zdCddOgogICAgICAgICAgICAgICAgICAgIG1bJ3Jhd3Bvc3QnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ3Jhd3Bvc3QnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzLHJhd1Bvc3Q9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3Jhd3Bvc3QgaXMgbm93JyxtWydyYXdwb3N0J10KCiAgICAgICAgICAgICAgICBpZiAncmF3cG9zdCcgaW4gbSBhbmQgJyRlcG9jdGltZSQnIGluIG1bJ3Jhd3Bvc3QnXToKICAgICAgICAgICAgICAgICAgICBtWydyYXdwb3N0J109bVsncmF3cG9zdCddLnJlcGxhY2UoJyRlcG9jdGltZSQnLGdldEVwb2NUaW1lKCkpCgogICAgICAgICAgICAgICAgaWYgJ3Jhd3Bvc3QnIGluIG0gYW5kICckZXBvY3RpbWUyJCcgaW4gbVsncmF3cG9zdCddOgogICAgICAgICAgICAgICAgICAgIG1bJ3Jhd3Bvc3QnXT1tWydyYXdwb3N0J10ucmVwbGFjZSgnJGVwb2N0aW1lMiQnLGdldEVwb2NUaW1lMigpKQoKCiAgICAgICAgICAgICAgICBsaW5rPScnCiAgICAgICAgICAgICAgICBpZiBtWydwYWdlJ10gYW5kIG1bJ3BhZ2UnXSBpbiBjYWNoZWRQYWdlcyBhbmQgbm90ICdpZ25vcmVjYWNoZScgaW4gbSBhbmQgZm9yQ29va2llSmFyT25seT09RmFsc2UgOgogICAgICAgICAgICAgICAgICAgIGxpbmsgPSBjYWNoZWRQYWdlc1ttWydwYWdlJ11dCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmIG1bJ3BhZ2UnXSBhbmQgIG5vdCBtWydwYWdlJ109PScnIGFuZCAgbVsncGFnZSddLnN0YXJ0c3dpdGgoJ2h0dHAnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRlcG9jdGltZSQnIGluIG1bJ3BhZ2UnXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1bJ3BhZ2UnXT1tWydwYWdlJ10ucmVwbGFjZSgnJGVwb2N0aW1lJCcsZ2V0RXBvY1RpbWUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRlcG9jdGltZTIkJyBpbiBtWydwYWdlJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtWydwYWdlJ109bVsncGFnZSddLnJlcGxhY2UoJyRlcG9jdGltZTIkJyxnZXRFcG9jVGltZTIoKSkKCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnSW5nb3JpbmcgQ2FjaGUnLG1bJ3BhZ2UnXQogICAgICAgICAgICAgICAgICAgICAgICBwYWdlX3NwbGl0PW1bJ3BhZ2UnXS5zcGxpdCgnfCcpCiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VVcmw9cGFnZV9zcGxpdFswXQogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJfaW5fcGFnZT1Ob25lCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihwYWdlX3NwbGl0KT4xOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyX2luX3BhZ2U9cGFnZV9zcGxpdFsxXQoKIyAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAKIyAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm94eSA9IHVybGxpYjIuUHJveHlIYW5kbGVyKHsgKCdodHRwcycgPyBwcm94eXRvdXNlWzo1XT09Imh0dHBzIjoiaHR0cCIpIDogcHJveHl0b3VzZX0pCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIocHJveHkpCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIAojICAgICAgICAgICAgICAgICAgICAgICAgaW1wb3J0IHVybGxpYjIKIyAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICd1cmxsaWIyLmdldHByb3hpZXMnLHVybGxpYjIuZ2V0cHJveGllcygpCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfcHJveGllcz11cmxsaWIyLlByb3h5SGFuZGxlcih1cmxsaWIyLmdldHByb3hpZXMoKSkKICAgICAgICAKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdChwYWdlVXJsKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAncHJveHknIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm94eXRvdXNlPSBtWydwcm94eSddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAncHJveHl0b3VzZScscHJveHl0b3VzZQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybGxpYjIuZ2V0cHJveGllcz0gbGFtYmRhOiB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcGFnZVVybFs6NV09PSJodHRwcyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJveHkgPSB1cmxsaWIyLlByb3h5SGFuZGxlcih7ICdodHRwcycgOiBwcm94eXRvdXNlfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcmVxLnNldF9wcm94eShwcm94eXRvdXNlLCAnaHR0cHMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm94eSA9IHVybGxpYjIuUHJveHlIYW5kbGVyKHsgJ2h0dHAnICA6IHByb3h5dG91c2V9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNyZXEuc2V0X3Byb3h5KHByb3h5dG91c2UsICdodHRwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKHByb3h5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JywgJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgcnY6MTQuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xNC4wLjEnKQogICAgICAgICAgICAgICAgICAgICAgICBwcm94eXRvdXNlPU5vbmUKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdyZWZlcmVyJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1JlZmVyZXInLCBtWydyZWZlcmVyJ10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhY2NlcHQnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignQWNjZXB0JywgbVsnYWNjZXB0J10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhZ2VudCcgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLWFnZW50JywgbVsnYWdlbnQnXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3gtcmVxJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1gtUmVxdWVzdGVkLVdpdGgnLCBtWyd4LXJlcSddKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAneC1hZGRyJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ3gtYWRkcicsIG1bJ3gtYWRkciddKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAneC1mb3J3YXJkJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1gtRm9yd2FyZGVkLUZvcicsIG1bJ3gtZm9yd2FyZCddKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnc2V0Y29va2llJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2FkZGluZyBjb29raWUnLG1bJ3NldGNvb2tpZSddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignQ29va2llJywgbVsnc2V0Y29va2llJ10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhcHBlbmRjb29raWUnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnYXBwZW5kaW5nIGNvb2tpZSB0byBjb29raWVqYXInLG1bJ2FwcGVuZGNvb2tpZSddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVzdG9BcGVuZD1tWydhcHBlbmRjb29raWUnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llc3RvQXBlbmQ9Y29va2llc3RvQXBlbmQuc3BsaXQoJzsnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGggaW4gY29va2llc3RvQXBlbmQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbix2PWguc3BsaXQoJz0nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcsbj0gbi5zcGxpdCgnOicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2sgPSBjb29raWVsaWIuQ29va2llKHZlcnNpb249MCwgbmFtZT1uLCB2YWx1ZT12LCBwb3J0PU5vbmUsIHBvcnRfc3BlY2lmaWVkPUZhbHNlLCBkb21haW49dywgZG9tYWluX3NwZWNpZmllZD1GYWxzZSwgZG9tYWluX2luaXRpYWxfZG90PUZhbHNlLCBwYXRoPScvJywgcGF0aF9zcGVjaWZpZWQ9VHJ1ZSwgc2VjdXJlPUZhbHNlLCBleHBpcmVzPU5vbmUsIGRpc2NhcmQ9VHJ1ZSwgY29tbWVudD1Ob25lLCBjb21tZW50X3VybD1Ob25lLCByZXN0PXsnSHR0cE9ubHknOiBOb25lfSwgcmZjMjEwOT1GYWxzZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXIuc2V0X2Nvb2tpZShjaykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ29yaWdpbicgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdPcmlnaW4nLCBtWydvcmlnaW4nXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaGVhZGVyX2luX3BhZ2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJfaW5fcGFnZT1oZWFkZXJfaW5fcGFnZS5zcGxpdCgnJicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaCBpbiBoZWFkZXJfaW5fcGFnZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLHY9aC5zcGxpdCgnPScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIobix2KQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgY29va2llSmFyPT1Ob25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdjb29raWVKYXJWYWwnLGNvb2tpZUphcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llX2hhbmRsZXIgPSB1cmxsaWIyLkhUVFBDb29raWVQcm9jZXNzb3IoY29va2llSmFyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoY29va2llX2hhbmRsZXIsIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnbm9yZWRpcmVjdCcsJ25vcmVkaXJlY3QnIGluIG0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ25vcmVkaXJlY3QnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyMiA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKE5vUmVkaXJlY3Rpb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIyKQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2Nvbm5lY3Rpb24nIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5jb25uZWN0aW9uLy8vLy8vLicsbVsnY29ubmVjdGlvbiddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tIGtlZXBhbGl2ZSBpbXBvcnQgSFRUUEhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlZXBhbGl2ZV9oYW5kbGVyID0gSFRUUEhhbmRsZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoa2VlcGFsaXZlX2hhbmRsZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikKCgogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2FmdGVyIGNvb2tpZSBqYXInCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9Tm9uZQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3Bvc3QnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0RGF0YT1tWydwb3N0J10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICckTGl2ZVN0cmVhbVJlY2FwdGNoYScgaW4gcG9zdERhdGE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNhcHRjaGFfY2hhbGxlbmdlLGNhdHBjaGFfd29yZCk9cHJvY2Vzc1JlY2FwdGNoYShtWydwYWdlJ10pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2FwdGNoYV9jaGFsbGVuZ2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3REYXRhKz0ncmVjYXB0Y2hhX2NoYWxsZW5nZV9maWVsZDonK2NhcHRjaGFfY2hhbGxlbmdlKycscmVjYXB0Y2hhX3Jlc3BvbnNlX2ZpZWxkOicrY2F0cGNoYV93b3JkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGxpdHBvc3Q9cG9zdERhdGEuc3BsaXQoJywnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9e30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBwIGluIHNwbGl0cG9zdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuPXAuc3BsaXQoJzonKVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2PXAuc3BsaXQoJzonKVsxXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0W25dPXYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3QgPSB1cmxsaWIudXJsZW5jb2RlKHBvc3QpCgogICAgICAgICAgICAgICAgICAgICAgICBpZiAncmF3cG9zdCcgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9bVsncmF3cG9zdCddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnJExpdmVTdHJlYW1SZWNhcHRjaGEnIGluIHBvc3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNhcHRjaGFfY2hhbGxlbmdlLGNhdHBjaGFfd29yZCk9cHJvY2Vzc1JlY2FwdGNoYShtWydwYWdlJ10pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2FwdGNoYV9jaGFsbGVuZ2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdCs9JyZyZWNhcHRjaGFfY2hhbGxlbmdlX2ZpZWxkPScrY2FwdGNoYV9jaGFsbGVuZ2UrJyZyZWNhcHRjaGFfcmVzcG9uc2VfZmllbGQ9JytjYXRwY2hhX3dvcmQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcG9zdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSxwb3N0KQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQoKICAgICAgICAgICAgICAgICAgICAgICAgbGluayA9IHJlc3BvbnNlLnJlYWQoKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3Byb3h5JyBpbiBtIGFuZCBub3QgY3VycmVudF9wcm94aWVzIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKHVybGxpYjIuYnVpbGRfb3BlbmVyKGN1cnJlbnRfcHJveGllcykpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBsaW5rPWphdmFzY3JpcHRVbkVzY2FwZShsaW5rKQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgbGluayBUaGlzIGp1c3QgcHJpbnQgd2hvbGUgd2VicGFnZSBpbiBMT0cKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2luY2x1ZGVoZWFkZXJzJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgI2xpbmsrPXN0cihyZXNwb25zZS5oZWFkZXJzLmdldCgnU2V0LUNvb2tpZScpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluays9JyQkSEVBREVSU19TVEFSVCQkOicKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBiIGluIHJlc3BvbnNlLmhlYWRlcnM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluays9IGIrJzonK3Jlc3BvbnNlLmhlYWRlcnMuZ2V0KGIpKydcbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsrPSckJEhFQURFUlNfRU5EJCQ6JwojICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgbGluawogICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2cobGluaykKICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKGNvb2tpZUphciApCgogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlZFBhZ2VzW21bJ3BhZ2UnXV0gPSBsaW5rCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCBsaW5rCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnc3RvcmUgbGluayBmb3InLG1bJ3BhZ2UnXSxmb3JDb29raWVKYXJPbmx5CgogICAgICAgICAgICAgICAgICAgICAgICBpZiBmb3JDb29raWVKYXJPbmx5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tpZUphciMgZG8gbm90aGluZwogICAgICAgICAgICAgICAgICAgIGVsaWYgbVsncGFnZSddIGFuZCAgbm90IG1bJ3BhZ2UnXS5zdGFydHN3aXRoKCdodHRwJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1bJ3BhZ2UnXS5zdGFydHN3aXRoKCckcHlGdW5jdGlvbjonKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1kb0V2YWwobVsncGFnZSddLnNwbGl0KCckcHlGdW5jdGlvbjonKVsxXSwnJyxjb29raWVKYXIsbSApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBmb3JDb29raWVKYXJPbmx5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb29raWVKYXIjIGRvIG5vdGhpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbms9dmFsCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rPW1bJ3BhZ2UnXQogICAgICAgICAgICAgICAgaWYgJyRweUZ1bmN0aW9uOnBsYXltZWRpYSgnIGluIG1bJ2V4cHJlcyddIG9yICdBY3RpdmF0ZVdpbmRvdycgIGluIG1bJ2V4cHJlcyddICBvciAnJFBMQVlFUlBST1hZJD0nIGluIHVybCAgb3IgIGFueSh4IGluIHVybCBmb3IgeCBpbiBnX2lnbm9yZVNldFJlc29sdmVkKToKICAgICAgICAgICAgICAgICAgICBzZXRyZXNvbHZlZD1GYWxzZQogICAgICAgICAgICAgICAgaWYgICckZG9yZWdleCcgaW4gbVsnZXhwcmVzJ106CiAgICAgICAgICAgICAgICAgICAgbVsnZXhwcmVzJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydleHByZXMnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQogICAgICAgICAgICAgICAgaWYgbm90IG1bJ2V4cHJlcyddPT0nJzoKICAgICAgICAgICAgICAgICAgICBwcmludCAnZG9pbmcgaXQgJyxtWydleHByZXMnXQogICAgICAgICAgICAgICAgICAgIGlmICckTGl2ZVN0cmVhbUNhcHRjaGEnIGluIG1bJ2V4cHJlcyddOgogICAgICAgICAgICAgICAgICAgICAgICB2YWw9YXNrQ2FwdGNoYShtLGxpbmssY29va2llSmFyKQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3VybCBhbmQgdmFsJyx1cmwsdmFsCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwgdmFsKQogICAgICAgICAgICAgICAgICAgIGVsaWYgbVsnZXhwcmVzJ10uc3RhcnRzd2l0aCgnJHB5RnVuY3Rpb246Jykgb3IgJyMkcHlGdW5jdGlvbicgaW4gbVsnZXhwcmVzJ106CiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnZXhwZWVlZWVlZWVlZWVlZWVlZWVlZScsbVsnZXhwcmVzJ10KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbVsnZXhwcmVzJ10uc3RhcnRzd2l0aCgnJHB5RnVuY3Rpb246Jyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9ZG9FdmFsKG1bJ2V4cHJlcyddLnNwbGl0KCckcHlGdW5jdGlvbjonKVsxXSxsaW5rLGNvb2tpZUphcixtKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPWRvRXZhbEZ1bmN0aW9uKG1bJ2V4cHJlcyddLGxpbmssY29va2llSmFyLG0pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdBY3RpdmF0ZVdpbmRvdycgaW4gbVsnZXhwcmVzJ106IHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBwcmludCAndXJsIGsgdmFsJyx1cmwsayx2YWwKCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwgdmFsKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdsaXN0cmVwZWF0JyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdHJlcGVhdD1tWydsaXN0cmVwZWF0J10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldD1yZS5maW5kYWxsKG1bJ2V4cHJlcyddLGxpbmspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGlzdHJlcGVhdCxyZXQsIG0scmVnZXhzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBsaW5rPT0nJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnbGluaycsbGluawogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnID0gcmUuY29tcGlsZShtWydleHByZXMnXSkuc2VhcmNoKGxpbmspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9JycKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9cmVnLmdyb3VwKDEpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YygpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9bVsnZXhwcmVzJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiByYXdQb3N0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3Jhd3Bvc3QnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9dXJsbGliLnF1b3RlX3BsdXModmFsKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnaHRtbHVuZXNjYXBlJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ZhbD11cmxsaWIudW5xdW90ZV9wbHVzKHZhbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydCBIVE1MUGFyc2VyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9SFRNTFBhcnNlci5IVE1MUGFyc2VyKCkudW5lc2NhcGUodmFsKQogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsIHZhbCkKICAgICAgICAgICAgICAgICAgICAgICAgI3JldHVybiB2YWwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoIiRkb3JlZ2V4WyIgKyBrICsgIl0iLCcnKQogICAgICAgIGlmICckZXBvY3RpbWUkJyBpbiB1cmw6CiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJGVwb2N0aW1lJCcsZ2V0RXBvY1RpbWUoKSkKICAgICAgICBpZiAnJGVwb2N0aW1lMiQnIGluIHVybDoKICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpCgogICAgICAgIGlmICckR1VJRCQnIGluIHVybDoKICAgICAgICAgICAgaW1wb3J0IHV1aWQKICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckR1VJRCQnLHN0cih1dWlkLnV1aWQxKCkpLnVwcGVyKCkpCiAgICAgICAgaWYgJyRnZXRfY29va2llcyQnIGluIHVybDoKICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckZ2V0X2Nvb2tpZXMkJyxnZXRDb29raWVzU3RyaW5nKGNvb2tpZUphcikpCgogICAgICAgIGlmIHJlY3Vyc2l2ZUNhbGw6IHJldHVybiB1cmwKICAgICAgICBwcmludCAnZmluYWwgdXJsJyx1cmwKICAgICAgICBpZiB1cmw9PSIiOgogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gdXJsLHNldHJlc29sdmVkCmRlZiBnZXRtZDUodCk6CiAgICBpbXBvcnQgaGFzaGxpYgogICAgaD1oYXNobGliLm1kNSgpCiAgICBoLnVwZGF0ZSh0KQogICAgcmV0dXJuIGguaGV4ZGlnZXN0KCkKCmRlZiBkZWNyeXB0X3ZhdWdobmxpdmUoZW5jcnlwdGVkKToKICAgIHJldFZhbD0iIgogICAgcHJpbnQgJ2VuYycsZW5jcnlwdGVkCiAgICAjZm9yIHZhbCBpbiBlbmNyeXB0ZWQuc3BsaXQoJzonKToKICAgICMgICAgcmV0VmFsKz1jaHIoaW50KHZhbC5yZXBsYWNlKCIwbTAiLCIiKSkpCiAgICAjcmV0dXJuIHJldFZhbAoKZGVmIHBsYXltZWRpYShtZWRpYV91cmwpOgogICAgdHJ5OgogICAgICAgIGltcG9ydCAgQ3VzdG9tUGxheWVyCiAgICAgICAgcGxheWVyID0gQ3VzdG9tUGxheWVyLk15WEJNQ1BsYXllcigpCiAgICAgICAgbGlzdGl0ZW0gPSB4Ym1jZ3VpLkxpc3RJdGVtKCBsYWJlbCA9IHN0cihuYW1lKSwgaWNvbkltYWdlID0gIkRlZmF1bHRWaWRlby5wbmciLCB0aHVtYm5haWxJbWFnZSA9IHhibWMuZ2V0SW5mb0ltYWdlKCAiTGlzdEl0ZW0uVGh1bWIiICksIHBhdGg9bWVkaWFfdXJsICkKICAgICAgICBwbGF5ZXIucGxheSggbWVkaWFfdXJsLGxpc3RpdGVtKQogICAgICAgIHhibWMuc2xlZXAoMTAwMCkKICAgICAgICB3aGlsZSBwbGF5ZXIuaXNfYWN0aXZlOgogICAgICAgICAgICB4Ym1jLnNsZWVwKDIwMCkKICAgIGV4Y2VwdDoKICAgICAgICB0cmFjZWJhY2sucHJpbnRfZXhjKCkKICAgIHJldHVybiAnJwoKZGVmIGtvZGlKc29uUmVxdWVzdChwYXJhbXMpOgogICAgZGF0YSA9IGpzb24uZHVtcHMocGFyYW1zKQogICAgcmVxdWVzdCA9IHhibWMuZXhlY3V0ZUpTT05SUEMoZGF0YSkKCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSBqc29uLmxvYWRzKHJlcXVlc3QpCiAgICBleGNlcHQgVW5pY29kZURlY29kZUVycm9yOgogICAgICAgIHJlc3BvbnNlID0ganNvbi5sb2FkcyhyZXF1ZXN0LmRlY29kZSgndXRmLTgnLCAnaWdub3JlJykpCgogICAgdHJ5OgogICAgICAgIGlmICdyZXN1bHQnIGluIHJlc3BvbnNlOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VbJ3Jlc3VsdCddCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICBsb2dnZXIud2FybigiWyVzXSAlcyIgJSAocGFyYW1zWydtZXRob2QnXSwgcmVzcG9uc2VbJ2Vycm9yJ11bJ21lc3NhZ2UnXSkpCiAgICAgICAgcmV0dXJuIE5vbmUKCgpkZWYgc2V0S29kaVByb3h5KHByb3h5c2V0dGluZ3M9Tm9uZSk6CgogICAgaWYgcHJveHlzZXR0aW5ncz09Tm9uZToKICAgICAgICBwcmludCAncHJveHkgc2V0IHRvIG5vdGhpbmcnCiAgICAgICAgeGJtYy5leGVjdXRlSlNPTlJQQygneyJqc29ucnBjIjoiMi4wIiwgIm1ldGhvZCI6IlNldHRpbmdzLlNldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsudXNlaHR0cHByb3h5IiwgInZhbHVlIjpmYWxzZX0sICJpZCI6MX0nKQogICAgZWxzZToKICAgICAgICAKICAgICAgICBwcz1wcm94eXNldHRpbmdzLnNwbGl0KCc6JykKICAgICAgICBwcm94eVVSTD1wc1swXQogICAgICAgIHByb3h5UG9ydD1wc1sxXQogICAgICAgIHByb3h5VHlwZT1wc1syXQogICAgICAgIHByb3h5VXNlcm5hbWU9Tm9uZQogICAgICAgIHByb3h5UGFzc3dvcmQ9Tm9uZQogICAgICAgICAKICAgICAgICBpZiBsZW4ocHMpPjMgYW5kICdAJyBpbiBwcm94eXNldHRpbmdzOgogICAgICAgICAgICBwcm94eVVzZXJuYW1lPXBzWzNdCiAgICAgICAgICAgIHByb3h5UGFzc3dvcmQ9cHJveHlzZXR0aW5ncy5zcGxpdCgnQCcpWy0xXQoKICAgICAgICBwcmludCAncHJveHkgc2V0IHRvJywgcHJveHlUeXBlLCBwcm94eVVSTCxwcm94eVBvcnQKICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay51c2VodHRwcHJveHkiLCAidmFsdWUiOnRydWV9LCAiaWQiOjF9JykKICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHl0eXBlIiwgInZhbHVlIjonICsgc3RyKHByb3h5VHlwZSkgKyd9LCAiaWQiOjF9JykKICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHlzZXJ2ZXIiLCAidmFsdWUiOiInICsgc3RyKHByb3h5VVJMKSArJyJ9LCAiaWQiOjF9JykKICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHlwb3J0IiwgInZhbHVlIjonICsgc3RyKHByb3h5UG9ydCkgKyd9LCAiaWQiOjF9JykKICAgICAgICAKICAgICAgICAKICAgICAgICBpZiBub3QgcHJveHlVc2VybmFtZT09Tm9uZToKICAgICAgICAgICAgeGJtYy5leGVjdXRlSlNPTlJQQygneyJqc29ucnBjIjoiMi4wIiwgIm1ldGhvZCI6IlNldHRpbmdzLlNldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5dXNlcm5hbWUiLCAidmFsdWUiOiInICsgc3RyKHByb3h5VXNlcm5hbWUpICsnIn0sICJpZCI6MX0nKQogICAgICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHlwYXNzd29yZCIsICJ2YWx1ZSI6IicgKyBzdHIocHJveHlQYXNzd29yZCkgKycifSwgImlkIjoxfScpCgogICAgICAgIApkZWYgZ2V0Q29uZmlndXJlZFByb3h5KCk6CiAgICBwcm94eUFjdGl2ZSA9IGtvZGlKc29uUmVxdWVzdCh7J2pzb25ycGMnOiAnMi4wJywgIm1ldGhvZCI6IlNldHRpbmdzLkdldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsudXNlaHR0cHByb3h5In0sICdpZCc6IDF9KVsndmFsdWUnXQogICAgcHJpbnQgJ3Byb3h5QWN0aXZlJyxwcm94eUFjdGl2ZQogICAgcHJveHlUeXBlID0ga29kaUpzb25SZXF1ZXN0KHsnanNvbnJwYyc6ICcyLjAnLCAibWV0aG9kIjoiU2V0dGluZ3MuR2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHl0eXBlIn0sICdpZCc6IDF9KVsndmFsdWUnXQoKICAgIGlmIHByb3h5QWN0aXZlOiAjIFBST1hZX0hUVFAKICAgICAgICBwcm94eVVSTCA9IGtvZGlKc29uUmVxdWVzdCh7J2pzb25ycGMnOiAnMi4wJywgIm1ldGhvZCI6IlNldHRpbmdzLkdldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5c2VydmVyIn0sICdpZCc6IDF9KVsndmFsdWUnXQogICAgICAgIHByb3h5UG9ydCA9IHVuaWNvZGUoa29kaUpzb25SZXF1ZXN0KHsnanNvbnJwYyc6ICcyLjAnLCAibWV0aG9kIjoiU2V0dGluZ3MuR2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHlwb3J0In0sICdpZCc6IDF9KVsndmFsdWUnXSkKICAgICAgICBwcm94eVVzZXJuYW1lID0ga29kaUpzb25SZXF1ZXN0KHsnanNvbnJwYyc6ICcyLjAnLCAibWV0aG9kIjoiU2V0dGluZ3MuR2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHl1c2VybmFtZSJ9LCAnaWQnOiAxfSlbJ3ZhbHVlJ10KICAgICAgICBwcm94eVBhc3N3b3JkID0ga29kaUpzb25SZXF1ZXN0KHsnanNvbnJwYyc6ICcyLjAnLCAibWV0aG9kIjoiU2V0dGluZ3MuR2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHlwYXNzd29yZCJ9LCAnaWQnOiAxfSlbJ3ZhbHVlJ10KCiAgICAgICAgaWYgcHJveHlVc2VybmFtZSBhbmQgcHJveHlQYXNzd29yZCBhbmQgcHJveHlVUkwgYW5kIHByb3h5UG9ydDoKICAgICAgICAgICAgcmV0dXJuIHByb3h5VVJMICsgJzonICsgc3RyKHByb3h5UG9ydCkrJzonK3N0cihwcm94eVR5cGUpICsgJzonICsgcHJveHlVc2VybmFtZSArICdAJyArIHByb3h5UGFzc3dvcmQKICAgICAgICBlbGlmIHByb3h5VVJMIGFuZCBwcm94eVBvcnQ6CiAgICAgICAgICAgIHJldHVybiBwcm94eVVSTCArICc6JyArIHN0cihwcm94eVBvcnQpKyc6JytzdHIocHJveHlUeXBlKQogICAgZWxzZToKICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIApkZWYgcGxheW1lZGlhd2l0aHByb3h5KG1lZGlhX3VybCwgbmFtZSwgaWNvbkltYWdlLHByb3h5aXAscG9ydCk6CgogICAgcHJvZ3Jlc3MgPSB4Ym1jZ3VpLkRpYWxvZ1Byb2dyZXNzKCkKICAgIHByb2dyZXNzLmNyZWF0ZSgnUHJvZ3Jlc3MnLCAnUGxheWluZyB3aXRoIGN1c3RvbSBwcm94eScpCiAgICBwcm9ncmVzcy51cGRhdGUoIDEwLCAiIiwgInNldHRpbmcgcHJveHkuLiIsICIiICkKICAgIHByb3h5c2V0PUZhbHNlCiAgICBleGlzdGluZ19wcm94eT0nJwogICAgdHJ5OgogICAgICAgIAogICAgICAgIGV4aXN0aW5nX3Byb3h5PWdldENvbmZpZ3VyZWRQcm94eSgpCiAgICAgICAgcHJpbnQgJ2V4aXN0aW5nX3Byb3h5JyxleGlzdGluZ19wcm94eQogICAgICAgICNyZWFkIGFuZCBzZXQgaGVyZQogICAgICAgIHNldEtvZGlQcm94eSggcHJveHlpcCArICc6JyArIHBvcnQrJzowJykKCiAgICAgICAgcHJpbnQgJ3Byb3h5IHNldHRpbmcgY29tcGxldGUnLCBnZXRDb25maWd1cmVkUHJveHkoKQogICAgICAgIHByb3h5c2V0PVRydWUKICAgICAgICBwcm9ncmVzcy51cGRhdGUoIDgwLCAiIiwgInNldHRpbmcgcHJveHkgY29tcGxldGUsIG5vdyBwbGF5aW5nIiwgIiIgKQogICAgICAgIHByb2dyZXNzLmNsb3NlKCkKICAgICAgICBwcm9ncmVzcz1Ob25lCiAgICAgICAgaW1wb3J0ICBDdXN0b21QbGF5ZXIKICAgICAgICBwbGF5ZXIgPSBDdXN0b21QbGF5ZXIuTXlYQk1DUGxheWVyKCkKICAgICAgICBsaXN0aXRlbSA9IHhibWNndWkuTGlzdEl0ZW0oIGxhYmVsID0gc3RyKG5hbWUpLCBpY29uSW1hZ2UgPSBpY29uSW1hZ2UsIHRodW1ibmFpbEltYWdlID0geGJtYy5nZXRJbmZvSW1hZ2UoICJMaXN0SXRlbS5UaHVtYiIgKSwgcGF0aD1tZWRpYV91cmwgKQogICAgICAgIHBsYXllci5wbGF5KCBtZWRpYV91cmwsbGlzdGl0ZW0pCiAgICAgICAgeGJtYy5zbGVlcCgxMDAwKQogICAgICAgIHdoaWxlIHBsYXllci5pc19hY3RpdmU6CiAgICAgICAgICAgIHhibWMuc2xlZXAoMjAwKQogICAgZXhjZXB0OgogICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoKQogICAgaWYgcHJvZ3Jlc3M6CiAgICAgICAgcHJvZ3Jlc3MuY2xvc2UoKQogICAgaWYgcHJveHlzZXQ6CiAgICAgICAgcHJpbnQgJ25vdyByZXNldHRpbmcgdGhlIHByb3h5IGJhY2snCiAgICAgICAgc2V0S29kaVByb3h5KGV4aXN0aW5nX3Byb3h5KQogICAgICAgIHByaW50ICdyZXNldCBoZXJlJwogICAgcmV0dXJuICcnCgoKZGVmIGdldF9zYXdfcnRtcChwYWdlX3ZhbHVlLCByZWZlcmVyPU5vbmUpOgogICAgaWYgcmVmZXJlcjoKICAgICAgICByZWZlcmVyPVsoJ1JlZmVyZXInLHJlZmVyZXIpXQogICAgaWYgcGFnZV92YWx1ZS5zdGFydHN3aXRoKCJodHRwIik6CiAgICAgICAgcGFnZV91cmw9cGFnZV92YWx1ZQogICAgICAgIHBhZ2VfdmFsdWU9IGdldFVybChwYWdlX3ZhbHVlLGhlYWRlcnM9cmVmZXJlcikKCiAgICBzdHJfcGF0dGVybj0iKGV2YWxcKGZ1bmN0aW9uXChwLGEsYyxrLGUsKD86cnxkKS4qKSIKCiAgICByZWdfcmVzPXJlLmNvbXBpbGUoc3RyX3BhdHRlcm4pLmZpbmRhbGwocGFnZV92YWx1ZSkKICAgIHI9IiIKICAgIGlmIHJlZ19yZXMgYW5kIGxlbihyZWdfcmVzKT4wOgogICAgICAgIGZvciB2IGluIHJlZ19yZXM6CiAgICAgICAgICAgIHIxPWdldF91bnBhY2tlZCh2KQogICAgICAgICAgICByMj1yZV9tZShyMSwnXCcoLio/KVwnJykKICAgICAgICAgICAgaWYgJ3VuZXNjYXBlJyBpbiByMToKICAgICAgICAgICAgICAgIHIxPXVybGxpYi51bnF1b3RlKHIyKQogICAgICAgICAgICByKz1yMSsnXG4nCiAgICAgICAgcHJpbnQgJ2ZpbmFsIHZhbHVlIGlzICcscgoKICAgICAgICBwYWdlX3VybD1yZV9tZShyLCdzcmM9IiguKj8pIicpCgogICAgICAgIHBhZ2VfdmFsdWU9IGdldFVybChwYWdlX3VybCxoZWFkZXJzPXJlZmVyZXIpCgogICAgI3ByaW50IHBhZ2VfdmFsdWUKCiAgICBydG1wPXJlX21lKHBhZ2VfdmFsdWUsJ3N0cmVhbWVyXCcuKj9cJyguKj8pXCdcKScpCiAgICBwbGF5cGF0aD1yZV9tZShwYWdlX3ZhbHVlLCdmaWxlXCcsXHNcJyguKj8pXCcnKQoKCiAgICByZXR1cm4gcnRtcCsnIHBsYXlwYXRoPScrcGxheXBhdGggKycgcGFnZVVybD0nK3BhZ2VfdXJsCgpkZWYgZ2V0X2xldG9uX3J0bXAocGFnZV92YWx1ZSwgcmVmZXJlcj1Ob25lKToKICAgIGlmIHJlZmVyZXI6CiAgICAgICAgcmVmZXJlcj1bKCdSZWZlcmVyJyxyZWZlcmVyKV0KICAgIGlmIHBhZ2VfdmFsdWUuc3RhcnRzd2l0aCgiaHR0cCIpOgogICAgICAgIHBhZ2VfdmFsdWU9IGdldFVybChwYWdlX3ZhbHVlLGhlYWRlcnM9cmVmZXJlcikKICAgIHN0cl9wYXR0ZXJuPSJ2YXIgYSA9ICguKj8pO1xzKnZhciBiID0gKC4qPyk7XHMqdmFyIGMgPSAoLio/KTtccyp2YXIgZCA9ICguKj8pO1xzKnZhciBmID0gKC4qPyk7XHMqdmFyIHZfcGFydCA9ICcoLio/KSc7IgogICAgcmVnX3Jlcz1yZS5jb21waWxlKHN0cl9wYXR0ZXJuKS5maW5kYWxsKHBhZ2VfdmFsdWUpWzBdCgogICAgYSxiLGMsZCxmLHY9KHJlZ19yZXMpCiAgICBmPWludChmKQogICAgYT1pbnQoYSkvZgogICAgYj1pbnQoYikvZgogICAgYz1pbnQoYykvZgogICAgZD1pbnQoZCkvZgoKICAgIHJldD0gJ3J0bXA6Ly8nICsgc3RyKGEpICsgJy4nICsgc3RyKGIpICsgJy4nICsgc3RyKGMpICsgJy4nICsgc3RyKGQpICsgdjsKICAgIHJldHVybiByZXQKCmRlZiBjcmVhdGVNM3VGb3JEYXNoKHVybCx1c2VyYWdlbnQ9Tm9uZSk6CiAgICBzdHI9JyNFWFRNM1UnCiAgICBzdHIrPSdcbiNFWFQtWC1TVFJFQU0tSU5GOlBST0dSQU0tSUQ9MSxCQU5EV0lEVEg9MzYxODE2JwogICAgc3RyKz0nXG4nK3VybCsnJmJ5dGVzPTAtMjAwMDAwJyMrJ3xVc2VyLUFnZW50PScrdXNlcmFnZW50CiAgICBzb3VyY2VfZmlsZSA9IG9zLnBhdGguam9pbihwcm9maWxlLCAndGVzdGZpbGUubTN1JykKICAgIHN0cis9J1xuJwogICAgU2F2ZVRvRmlsZShzb3VyY2VfZmlsZSxzdHIpCiAgICAjcmV0dXJuICdDOi9Vc2Vycy9zaGFuaS9Eb3dubG9hZHMvdGVzdC5tM3U4JwogICAgcmV0dXJuIHNvdXJjZV9maWxlCgpkZWYgU2F2ZVRvRmlsZShmaWxlX25hbWUscGFnZV9kYXRhLGFwcGVuZD1GYWxzZSk6CiAgICBpZiBhcHBlbmQ6CiAgICAgICAgZiA9IG9wZW4oZmlsZV9uYW1lLCAnYScpCiAgICAgICAgZi53cml0ZShwYWdlX2RhdGEpCiAgICAgICAgZi5jbG9zZSgpCiAgICBlbHNlOgogICAgICAgIGY9b3BlbihmaWxlX25hbWUsJ3diJykKICAgICAgICBmLndyaXRlKHBhZ2VfZGF0YSkKICAgICAgICBmLmNsb3NlKCkKICAgICAgICByZXR1cm4gJycKCmRlZiBMb2FkRmlsZShmaWxlX25hbWUpOgogICAgZj1vcGVuKGZpbGVfbmFtZSwncmInKQogICAgZD1mLnJlYWQoKQogICAgZi5jbG9zZSgpCiAgICByZXR1cm4gZAoKZGVmIGdldF9wYWNrZWRfaXBob25ldHZfdXJsKHBhZ2VfZGF0YSk6CiAgICBpbXBvcnQgcmUsYmFzZTY0LHVybGxpYjsKICAgIHM9cGFnZV9kYXRhCiAgICB3aGlsZSAnZ2VoKCcgaW4gczoKICAgICAgICBpZiBzLnN0YXJ0c3dpdGgoJ2xvbCgnKTogcz1zWzU6LTFdCiMgICAgICAgcHJpbnQgJ3MgaXMgJyxzCiAgICAgICAgcz1yZS5jb21waWxlKCciKC4qPykiJykuZmluZGFsbChzKVswXTsKICAgICAgICBzPSAgYmFzZTY0LmI2NGRlY29kZShzKTsKICAgICAgICBzPXVybGxpYi51bnF1b3RlKHMpOwogICAgcHJpbnQgcwogICAgcmV0dXJuIHMKCmRlZiBnZXRfZmVycmFyaV91cmwocGFnZV9kYXRhKToKICAgIHByaW50ICdnZXRfZGFnX3VybDInLHBhZ2VfZGF0YQogICAgcGFnZV9kYXRhMj1nZXRVcmwocGFnZV9kYXRhKTsKICAgIHBhdHQ9JyhodHRwLiopJwogICAgaW1wb3J0IHV1aWQKICAgIHBsYXliYWNrPXN0cih1dWlkLnV1aWQxKCkpLnVwcGVyKCkKICAgIGxpbmtzPXJlLmNvbXBpbGUocGF0dCkuZmluZGFsbChwYWdlX2RhdGEyKQogICAgaGVhZGVycz1bKCdYLVBsYXliYWNrLVNlc3Npb24tSWQnLHBsYXliYWNrKV0KICAgIGZvciBsIGluIGxpbmtzOgogICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHBhZ2VfZGF0YXRlbXA9Z2V0VXJsKGwsaGVhZGVycz1oZWFkZXJzKTsKCiAgICAgICAgZXhjZXB0OiBwYXNzCgogICAgcmV0dXJuIHBhZ2VfZGF0YSsnfCZYLVBsYXliYWNrLVNlc3Npb24tSWQ9JytwbGF5YmFjawoKCmRlZiBnZXRfZGFnX3VybChwYWdlX2RhdGEpOgogICAgcHJpbnQgJ2dldF9kYWdfdXJsJyxwYWdlX2RhdGEKICAgIGlmIHBhZ2VfZGF0YS5zdGFydHN3aXRoKCdodHRwOi8vZGFnLnRvdGFsLXN0cmVhbS5uZXQnKToKICAgICAgICBoZWFkZXJzPVsoJ1VzZXItQWdlbnQnLCdWZXJpc21vLUJsYWNrVUlfKDIuNC43LjUuOC4wLjM0KScpXQogICAgICAgIHBhZ2VfZGF0YT1nZXRVcmwocGFnZV9kYXRhLGhlYWRlcnM9aGVhZGVycyk7CgogICAgaWYgJzEyNy4wLjAuMScgaW4gcGFnZV9kYXRhOgogICAgICAgIHJldHVybiByZXZpc3RfZGFnKHBhZ2VfZGF0YSkKICAgIGVsaWYgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICE9ICcnOgogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJyZ2ZXJfdD0oW14mXSspJicpICsgJz93bXNBdXRoU2lnbj0nICsgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICsgJz09L21wNDonICsgcmVfbWUocGFnZV9kYXRhLCAnXFw/eT0oW14mXSspJicpCiAgICBlbHNlOgogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJ2hyZWY9IihbXiJdKykiW14iXSskJykKICAgICAgICBpZiBsZW4oZmluYWxfdXJsKT09MDoKICAgICAgICAgICAgZmluYWxfdXJsPXBhZ2VfZGF0YQogICAgZmluYWxfdXJsID0gZmluYWxfdXJsLnJlcGxhY2UoJyAnLCAnJTIwJykKICAgIHJldHVybiBmaW5hbF91cmwKCmRlZiByZV9tZShkYXRhLCByZV9wYXR0ZW4pOgogICAgbWF0Y2ggPSAnJwogICAgbSA9IHJlLnNlYXJjaChyZV9wYXR0ZW4sIGRhdGEpCiAgICBpZiBtICE9IE5vbmU6CiAgICAgICAgbWF0Y2ggPSBtLmdyb3VwKDEpCiAgICBlbHNlOgogICAgICAgIG1hdGNoID0gJycKICAgIHJldHVybiBtYXRjaAoKZGVmIHJldmlzdF9kYWcocGFnZV9kYXRhKToKICAgIGZpbmFsX3VybCA9ICcnCiAgICBpZiAnMTI3LjAuMC4xJyBpbiBwYWdlX2RhdGE6CiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnJnZlcl90PShbXiZdKykmJykgKyAnIGxpdmU9dHJ1ZSB0aW1lb3V0PTE1IHBsYXlwYXRoPScgKyByZV9tZShwYWdlX2RhdGEsICdcXD95PShbYS16QS1aMC05LV9cXC5AXSspJykKCiAgICBpZiByZV9tZShwYWdlX2RhdGEsICd0b2tlbj0oW14mXSspJicpICE9ICcnOgogICAgICAgIGZpbmFsX3VybCA9IGZpbmFsX3VybCArICc/dG9rZW49JyArIHJlX21lKHBhZ2VfZGF0YSwgJ3Rva2VuPShbXiZdKykmJykKICAgIGVsaWYgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICE9ICcnOgogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJyZ2ZXJfdD0oW14mXSspJicpICsgJz93bXNBdXRoU2lnbj0nICsgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICsgJz09L21wNDonICsgcmVfbWUocGFnZV9kYXRhLCAnXFw/eT0oW14mXSspJicpCiAgICBlbHNlOgogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJ0hSRUY9IihbXiJdKykiJykKCiAgICBpZiAnZGFnMS5hc3gnIGluIGZpbmFsX3VybDoKICAgICAgICByZXR1cm4gZ2V0X2RhZ191cmwoZmluYWxfdXJsKQoKICAgIGlmICdkZXZpbmxpdmVmcy5mcGxpdmUubmV0JyBub3QgaW4gZmluYWxfdXJsOgogICAgICAgIGZpbmFsX3VybCA9IGZpbmFsX3VybC5yZXBsYWNlKCdkZXZpbmxpdmUnLCAnZmxpdmUnKQogICAgaWYgJ3Blcm1saXZlZnMuZnBsaXZlLm5ldCcgbm90IGluIGZpbmFsX3VybDoKICAgICAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwucmVwbGFjZSgncGVybWxpdmUnLCAnZmxpdmUnKQogICAgcmV0dXJuIGZpbmFsX3VybAoKCmRlZiBnZXRfdW53aXNlKCBzdHJfZXZhbCk6CiAgICBwYWdlX3ZhbHVlPSIiCiAgICB0cnk6CiAgICAgICAgc3M9IncsaSxzLGU9KCIrc3RyX2V2YWwrJyknCiAgICAgICAgZXhlYyAoc3MpCiAgICAgICAgcGFnZV92YWx1ZT11bndpc2VfZnVuYyh3LGkscyxlKQogICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZG91dCkKICAgICNwcmludCAndW5wYWNrZWQnLHBhZ2VfdmFsdWUKICAgIHJldHVybiBwYWdlX3ZhbHVlCgpkZWYgdW53aXNlX2Z1bmMoIHcsIGksIHMsIGUpOgogICAgbElsbCA9IDA7CiAgICBsbDFJID0gMDsKICAgIElsMWwgPSAwOwogICAgbGwxbCA9IFtdOwogICAgbDFsSSA9IFtdOwogICAgd2hpbGUgVHJ1ZToKICAgICAgICBpZiAobElsbCA8IDUpOgogICAgICAgICAgICBsMWxJLmFwcGVuZCh3W2xJbGxdKQogICAgICAgIGVsaWYgKGxJbGwgPCBsZW4odykpOgogICAgICAgICAgICBsbDFsLmFwcGVuZCh3W2xJbGxdKTsKICAgICAgICBsSWxsKz0xOwogICAgICAgIGlmIChsbDFJIDwgNSk6CiAgICAgICAgICAgIGwxbEkuYXBwZW5kKGlbbGwxSV0pCiAgICAgICAgZWxpZiAobGwxSSA8IGxlbihpKSk6CiAgICAgICAgICAgIGxsMWwuYXBwZW5kKGlbbGwxSV0pCiAgICAgICAgbGwxSSs9MTsKICAgICAgICBpZiAoSWwxbCA8IDUpOgogICAgICAgICAgICBsMWxJLmFwcGVuZChzW0lsMWxdKQogICAgICAgIGVsaWYgKElsMWwgPCBsZW4ocykpOgogICAgICAgICAgICBsbDFsLmFwcGVuZChzW0lsMWxdKTsKICAgICAgICBJbDFsKz0xOwogICAgICAgIGlmIChsZW4odykgKyBsZW4oaSkgKyBsZW4ocykgKyBsZW4oZSkgPT0gbGVuKGxsMWwpICsgbGVuKGwxbEkpICsgbGVuKGUpKToKICAgICAgICAgICAgYnJlYWs7CgogICAgbEkxbCA9ICcnLmpvaW4obGwxbCkjLmpvaW4oJycpOwogICAgSTFsSSA9ICcnLmpvaW4obDFsSSkjLmpvaW4oJycpOwogICAgbGwxSSA9IDA7CiAgICBsMWxsID0gW107CiAgICBmb3IgbElsbCBpbiByYW5nZSgwLGxlbihsbDFsKSwyKToKICAgICAgICAjcHJpbnQgJ2FycmF5IGknLGxJbGwsbGVuKGxsMWwpCiAgICAgICAgbGwxMSA9IC0xOwogICAgICAgIGlmICggb3JkKEkxbElbbGwxSV0pICUgMik6CiAgICAgICAgICAgIGxsMTEgPSAxOwogICAgICAgICNwcmludCAndmFsIGlzICcsIGxJMWxbbElsbDogbElsbCsyXQogICAgICAgIGwxbGwuYXBwZW5kKGNociggICAgaW50KGxJMWxbbElsbDogbElsbCsyXSwgMzYpIC0gbGwxMSkpOwogICAgICAgIGxsMUkrPTE7CiAgICAgICAgaWYgKGxsMUkgPj0gbGVuKGwxbEkpKToKICAgICAgICAgICAgbGwxSSA9IDA7CiAgICByZXQ9Jycuam9pbihsMWxsKQogICAgaWYgJ2V2YWwoZnVuY3Rpb24odyxpLHMsZSknIGluIHJldDoKICAgICAgICBwcmludCAnU1RJTEwgR09pbmcnCiAgICAgICAgcmV0PXJlLmNvbXBpbGUoJ2V2YWxcKGZ1bmN0aW9uXCh3LGkscyxlXCkuKn1cKCguKj8pXCknKS5maW5kYWxsKHJldClbMF0KICAgICAgICByZXR1cm4gZ2V0X3Vud2lzZShyZXQpCiAgICBlbHNlOgogICAgICAgIHByaW50ICdGSU5JU0hFRCcKICAgICAgICByZXR1cm4gcmV0CgpkZWYgZ2V0X3VucGFja2VkKCBwYWdlX3ZhbHVlLCByZWdleF9mb3JfdGV4dD0nJywgaXRlcmF0aW9ucz0xLCB0b3RhbF9pdGVyYXRpb249MSk6CiAgICB0cnk6CiAgICAgICAgcmVnX2RhdGE9Tm9uZQogICAgICAgIGlmIHBhZ2VfdmFsdWUuc3RhcnRzd2l0aCgiaHR0cCIpOgogICAgICAgICAgICBwYWdlX3ZhbHVlPSBnZXRVcmwocGFnZV92YWx1ZSkKICAgICAgICBwcmludCAncGFnZV92YWx1ZScscGFnZV92YWx1ZQogICAgICAgIGlmIHJlZ2V4X2Zvcl90ZXh0IGFuZCBsZW4ocmVnZXhfZm9yX3RleHQpPjA6CiAgICAgICAgICAgIHBhZ2VfdmFsdWU9cmUuY29tcGlsZShyZWdleF9mb3JfdGV4dCkuZmluZGFsbChwYWdlX3ZhbHVlKVswXSAjZ2V0IHRoZSBqcyB2YXJpYWJsZQoKICAgICAgICBwYWdlX3ZhbHVlPXVucGFjayhwYWdlX3ZhbHVlLGl0ZXJhdGlvbnMsdG90YWxfaXRlcmF0aW9uKQogICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZG91dCkKICAgIHByaW50ICd1bnBhY2tlZCcscGFnZV92YWx1ZQogICAgaWYgJ3NhdjFsaXZlLnR2JyBpbiBwYWdlX3ZhbHVlOgogICAgICAgIHBhZ2VfdmFsdWU9cGFnZV92YWx1ZS5yZXBsYWNlKCdzYXYxbGl2ZS50dicsJ3Nhd2xpdmUudHYnKSAjcXVpY2sgZml4IHNvbWUgYnVnIHNvbWV3aGVyZQogICAgICAgIHByaW50ICdzYXYxIHVucGFja2VkJyxwYWdlX3ZhbHVlCiAgICByZXR1cm4gcGFnZV92YWx1ZQoKZGVmIHVucGFjayhzSmF2YXNjcmlwdCxpdGVyYXRpb249MSwgdG90YWxpdGVyYXRpb25zPTIgICk6CiAgICBwcmludCAnaXRlcmF0aW9uJyxpdGVyYXRpb24KICAgIGlmIHNKYXZhc2NyaXB0LnN0YXJ0c3dpdGgoJ3ZhciBfMHhjYjhhPScpOgogICAgICAgIGFTcGxpdD1zSmF2YXNjcmlwdC5zcGxpdCgndmFyIF8weGNiOGE9JykKICAgICAgICBzcz0ibXlhcnJheT0iK2FTcGxpdFsxXS5zcGxpdCgiZXZhbCgiKVswXQogICAgICAgIGV4ZWMoc3MpCiAgICAgICAgYTE9NjIKICAgICAgICBjMT1pbnQoYVNwbGl0WzFdLnNwbGl0KCIsNjIsIilbMV0uc3BsaXQoJywnKVswXSkKICAgICAgICBwMT1teWFycmF5WzBdCiAgICAgICAgazE9bXlhcnJheVszXQogICAgICAgIHdpdGggb3BlbigndGVtcCBmaWxlJytzdHIoaXRlcmF0aW9uKSsnLmpzJywgIndiIikgYXMgZmlsZXdyaXRlcjoKICAgICAgICAgICAgZmlsZXdyaXRlci53cml0ZShzdHIoazEpKQogICAgICAgICNhYT0xLzAKICAgIGVsc2U6CgogICAgICAgIGlmICJybiBwfSgnIiBpbiBzSmF2YXNjcmlwdDoKICAgICAgICAgICAgYVNwbGl0ID0gc0phdmFzY3JpcHQuc3BsaXQoInJuIHB9KCciKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFTcGxpdCA9IHNKYXZhc2NyaXB0LnNwbGl0KCJybiBBfSgnIikKICAgICAgICBwcmludCBhU3BsaXQKCiAgICAgICAgcDEsYTEsYzEsazE9KCcnLCcwJywnMCcsJycpCgogICAgICAgIHNzPSJwMSxhMSxjMSxrMT0oJyIrYVNwbGl0WzFdLnNwbGl0KCIuc3BsaSIpWzBdKycpJwogICAgICAgIGV4ZWMoc3MpCiAgICBrMT1rMS5zcGxpdCgnfCcpCiAgICBhU3BsaXQgPSBhU3BsaXRbMV0uc3BsaXQoIikpJyIpCiMgICAgcHJpbnQgJyBwIGFycmF5IGlzICcsbGVuKGFTcGxpdCkKIyAgIHByaW50IGxlbihhU3BsaXQgKQoKICAgICNwPXN0cihhU3BsaXRbMF0rJykpJykjLnJlcGxhY2UoIlxcIiwiIikjLnJlcGxhY2UoJ1xcXFwnLCdcXCcpCgogICAgI3ByaW50IGFTcGxpdFsxXQogICAgI2FTcGxpdCA9IGFTcGxpdFsxXS5zcGxpdCgiLCIpCiAgICAjcHJpbnQgYVNwbGl0WzBdCiAgICAjYSA9IGludChhU3BsaXRbMV0pCiAgICAjYyA9IGludChhU3BsaXRbMl0pCiAgICAjayA9IGFTcGxpdFszXS5zcGxpdCgiLiIpWzBdLnJlcGxhY2UoIiciLCAnJykuc3BsaXQoJ3wnKQogICAgI2E9aW50KGEpCiAgICAjYz1pbnQoYykKCiAgICAjcD1wLnJlcGxhY2UoJ1xcJywgJycpCiMgICAgcHJpbnQgJ3AgdmFsIGlzICcscFswOjEwMF0sJy4uLi4uLi4uLi4uLicscFstMTAwOl0sbGVuKHApCiMgICAgcHJpbnQgJ3AxIHZhbCBpcyAnLHAxWzA6MTAwXSwnLi4uLi4uLi4uLi4uJyxwMVstMTAwOl0sbGVuKHAxKQoKICAgICNwcmludCBhLGExCiAgICAjcHJpbnQgYyxhMQogICAgI3ByaW50ICdrIHZhbCBpcyAnLGtbLTEwOl0sbGVuKGspCiMgICAgcHJpbnQgJ2sxIHZhbCBpcyAnLGsxWy0xMDpdLGxlbihrMSkKICAgIGUgPSAnJwogICAgZCA9ICcnIzMyODIzCgogICAgI3NVbnBhY2tlZCA9IHN0cihfX3VucGFjayhwLCBhLCBjLCBrLCBlLCBkKSkKICAgIHNVbnBhY2tlZDEgPSBzdHIoX191bnBhY2socDEsIGExLCBjMSwgazEsIGUsIGQsaXRlcmF0aW9uKSkKCiAgICAjcHJpbnQgc1VucGFja2VkWzoyMDBdKycuLi4uJytzVW5wYWNrZWRbLTEwMDpdLCBsZW4oc1VucGFja2VkKQojICAgIHByaW50IHNVbnBhY2tlZDFbOjIwMF0rJy4uLi4nK3NVbnBhY2tlZDFbLTEwMDpdLCBsZW4oc1VucGFja2VkMSkKCiAgICAjZXhlYygnc1VucGFja2VkMT0iJytzVW5wYWNrZWQxKyciJykKICAgIGlmIGl0ZXJhdGlvbj49dG90YWxpdGVyYXRpb25zOgojICAgICAgICBwcmludCAnZmluYWwgcmVzJyxzVW5wYWNrZWQxWzoyMDBdKycuLi4uJytzVW5wYWNrZWQxWy0xMDA6XSwgbGVuKHNVbnBhY2tlZDEpCiAgICAgICAgcmV0dXJuIHNVbnBhY2tlZDEjLnJlcGxhY2UoJ1xcXFwnLCAnXFwnKQogICAgZWxzZToKIyAgICAgICAgcHJpbnQgJ2ZpbmFsIHJlcyBmb3IgdGhpcyBpdGVyYXRpb24gaXMnLGl0ZXJhdGlvbgogICAgICAgIHJldHVybiB1bnBhY2soc1VucGFja2VkMSxpdGVyYXRpb24rMSkjLnJlcGxhY2UoJ1xcJywgJycpLGl0ZXJhdGlvbikjLnJlcGxhY2UoJ1xcJywgJycpOyN1bnBhY2soc1VucGFja2VkLnJlcGxhY2UoJ1xcJywgJycpKQoKZGVmIF9fdW5wYWNrKHAsIGEsIGMsIGssIGUsIGQsIGl0ZXJhdGlvbix2PTEpOgoKICAgICN3aXRoIG9wZW4oJ2JlZm9yZSBmaWxlJytzdHIoaXRlcmF0aW9uKSsnLmpzJywgIndiIikgYXMgZmlsZXdyaXRlcjoKICAgICMgICAgZmlsZXdyaXRlci53cml0ZShzdHIocCkpCiAgICB3aGlsZSAoYyA+PSAxKToKICAgICAgICBjID0gYyAtMQogICAgICAgIGlmIChrW2NdKToKICAgICAgICAgICAgYWE9c3RyKF9faXRvYU5ldyhjLCBhKSkKICAgICAgICAgICAgaWYgdj09MToKICAgICAgICAgICAgICAgIHA9cmUuc3ViKCdcXGInICsgYWEgKydcXGInLCBrW2NdLCBwKSMgVEhJUyBJUyBCbG9vZHkgc2xvdyEKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHA9ZmluZEFuZFJlcGxhY2VXb3JkKHAsYWEsa1tjXSkKCiAgICAgICAgICAgICNwPWZpbmRBbmRSZXBsYWNlV29yZChwLGFhLGtbY10pCgoKICAgICN3aXRoIG9wZW4oJ2FmdGVyIGZpbGUnK3N0cihpdGVyYXRpb24pKycuanMnLCAid2IiKSBhcyBmaWxld3JpdGVyOgogICAgIyAgICBmaWxld3JpdGVyLndyaXRlKHN0cihwKSkKICAgIHJldHVybiBwCgojCiNmdW5jdGlvbiBlcXVhbGF2ZW50IHRvIHJlLnN1YignXFxiJyArIGFhICsnXFxiJywga1tjXSwgcCkKZGVmIGZpbmRBbmRSZXBsYWNlV29yZChzb3VyY2Vfc3RyLCB3b3JkX3RvX2ZpbmQscmVwbGFjZV93aXRoKToKICAgIHNwbGl0cz1Ob25lCiAgICBzcGxpdHM9c291cmNlX3N0ci5zcGxpdCh3b3JkX3RvX2ZpbmQpCiAgICBpZiBsZW4oc3BsaXRzKT4xOgogICAgICAgIG5ld19zdHJpbmc9W10KICAgICAgICBjdXJyZW50X2luZGV4PTAKICAgICAgICBmb3IgY3VycmVudF9zcGxpdCBpbiBzcGxpdHM6CiAgICAgICAgICAgICNwcmludCAnaGVyZScsaQogICAgICAgICAgICBuZXdfc3RyaW5nLmFwcGVuZChjdXJyZW50X3NwbGl0KQogICAgICAgICAgICB2YWw9d29yZF90b19maW5kI2J5IGRlZmF1bHQgYXNzdW1lIGl0IHdhcyB3cm9uZyB0byBzcGxpdAoKICAgICAgICAgICAgI2lmIGl0cyBmaXJzdCBvbmUgYW5kIGl0ZW0gaXMgYmxhbmsgdGhlbiBjaGVjayBuZXh0IGl0ZW0gaXMgdmFsaWQgb3Igbm90CiAgICAgICAgICAgIGlmIGN1cnJlbnRfaW5kZXg9PWxlbihzcGxpdHMpLTE6CiAgICAgICAgICAgICAgICB2YWw9JycgIyBsYXN0IG9uZSBub3RoaW5nIHRvIGFwcGVuZCBub3JtYWxseQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgbGVuKGN1cnJlbnRfc3BsaXQpPT0wOiAjaWYgYmxhbmsgY2hlY2sgbmV4dCBvbmUgd2l0aCBjdXJyZW50IHNwbGl0IHZhbHVlCiAgICAgICAgICAgICAgICAgICAgaWYgKCBsZW4oc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV0pPT0wIGFuZCB3b3JkX3RvX2ZpbmRbMF0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKSBvciAobGVuKHNwbGl0c1tjdXJyZW50X2luZGV4KzFdKT4wICBhbmQgc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV1bMF0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKTojIGZpcnN0IGp1c3QganVzdCBjaGVjayBuZXh0CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1yZXBsYWNlX3dpdGgKICAgICAgICAgICAgICAgICNub3QgYmxhbmssIHRoZW4gY2hlY2sgY3VycmVudCBlbmR2YWx1ZSBhbmQgbmV4dCBmaXJzdCB2YWx1ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBpZiAoc3BsaXRzW2N1cnJlbnRfaW5kZXhdWy0xXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpIGFuZCAoKCBsZW4oc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV0pPT0wIGFuZCB3b3JkX3RvX2ZpbmRbMF0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKSBvciAobGVuKHNwbGl0c1tjdXJyZW50X2luZGV4KzFdKT4wICBhbmQgc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV1bMF0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKSk6IyBmaXJzdCBqdXN0IGp1c3QgY2hlY2sgbmV4dAogICAgICAgICAgICAgICAgICAgICAgICB2YWw9cmVwbGFjZV93aXRoCgogICAgICAgICAgICBuZXdfc3RyaW5nLmFwcGVuZCh2YWwpCiAgICAgICAgICAgIGN1cnJlbnRfaW5kZXgrPTEKICAgICAgICAjYWFhYT0xLzAKICAgICAgICBzb3VyY2Vfc3RyPScnLmpvaW4obmV3X3N0cmluZykKICAgIHJldHVybiBzb3VyY2Vfc3RyCgpkZWYgX19pdG9hKG51bSwgcmFkaXgpOgojICAgIHByaW50ICdudW0gcmVkJyxudW0sIHJhZGl4CiAgICByZXN1bHQgPSAiIgogICAgaWYgbnVtPT0wOiByZXR1cm4gJzAnCiAgICB3aGlsZSBudW0gPiAwOgogICAgICAgIHJlc3VsdCA9ICIwMTIzNDU2Nzg5YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoiW251bSAlIHJhZGl4XSArIHJlc3VsdAogICAgICAgIG51bSAvPSByYWRpeAogICAgcmV0dXJuIHJlc3VsdAoKZGVmIF9faXRvYU5ldyhjYywgYSk6CiAgICBhYT0iIiBpZiBjYyA8IGEgZWxzZSBfX2l0b2FOZXcoaW50KGNjIC8gYSksYSkKICAgIGNjID0gKGNjICUgYSkKICAgIGJiPWNocihjYyArIDI5KSBpZiBjYz4gMzUgZWxzZSBzdHIoX19pdG9hKGNjLDM2KSkKICAgIHJldHVybiBhYStiYgoKCmRlZiBnZXRDb29raWVzU3RyaW5nKGNvb2tpZUphcik6CiAgICB0cnk6CiAgICAgICAgY29va2llU3RyaW5nPSIiCiAgICAgICAgZm9yIGluZGV4LCBjb29raWUgaW4gZW51bWVyYXRlKGNvb2tpZUphcik6CiAgICAgICAgICAgIGNvb2tpZVN0cmluZys9Y29va2llLm5hbWUgKyAiPSIgKyBjb29raWUudmFsdWUgKyI7IgogICAgZXhjZXB0OiBwYXNzCiAgICAjcHJpbnQgJ2Nvb2tpZVN0cmluZycsY29va2llU3RyaW5nCiAgICByZXR1cm4gY29va2llU3RyaW5nCgoKZGVmIHNhdmVDb29raWVKYXIoY29va2llSmFyLENPT0tJRUZJTEUpOgogICAgdHJ5OgogICAgICAgIGNvbXBsZXRlX3BhdGg9b3MucGF0aC5qb2luKHByb2ZpbGUsQ09PS0lFRklMRSkKICAgICAgICBjb29raWVKYXIuc2F2ZShjb21wbGV0ZV9wYXRoLGlnbm9yZV9kaXNjYXJkPVRydWUpCiAgICBleGNlcHQ6IHBhc3MKCmRlZiBnZXRDb29raWVKYXIoQ09PS0lFRklMRSk6CgogICAgY29va2llSmFyPU5vbmUKICAgIGlmIENPT0tJRUZJTEU6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBjb21wbGV0ZV9wYXRoPW9zLnBhdGguam9pbihwcm9maWxlLENPT0tJRUZJTEUpCiAgICAgICAgICAgIGNvb2tpZUphciA9IGNvb2tpZWxpYi5MV1BDb29raWVKYXIoKQogICAgICAgICAgICBjb29raWVKYXIubG9hZChjb21wbGV0ZV9wYXRoLGlnbm9yZV9kaXNjYXJkPVRydWUpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBjb29raWVKYXI9Tm9uZQoKICAgIGlmIG5vdCBjb29raWVKYXI6CiAgICAgICAgY29va2llSmFyID0gY29va2llbGliLkxXUENvb2tpZUphcigpCgogICAgcmV0dXJuIGNvb2tpZUphcgoKZGVmIGRvRXZhbChmdW5fY2FsbCxwYWdlX2RhdGEsQ29va2llX0phcixtKToKICAgIHJldF92YWw9JycKICAgIGlmIGZ1bmN0aW9uc19kaXIgbm90IGluIHN5cy5wYXRoOgogICAgICAgIHN5cy5wYXRoLmFwcGVuZChmdW5jdGlvbnNfZGlyKQoKICAgIHByaW50IGZ1bl9jYWxsCiAgICB0cnk6CiAgICAgICAgcHlfZmlsZT0naW1wb3J0ICcrZnVuX2NhbGwuc3BsaXQoJy4nKVswXQogICAgICAgIHByaW50IHB5X2ZpbGUsc3lzLnBhdGgKICAgICAgICBleGVjKCBweV9maWxlKQogICAgICAgIHByaW50ICdkb25lJwogICAgZXhjZXB0OgogICAgICAgIHByaW50ICdlcnJvciBpbiBpbXBvcnQnCiAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4YyhmaWxlPXN5cy5zdGRvdXQpCiAgICBwcmludCAncmV0X3ZhbD0nK2Z1bl9jYWxsCiAgICBleGVjICgncmV0X3ZhbD0nK2Z1bl9jYWxsKQogICAgcHJpbnQgcmV0X3ZhbAogICAgI2V4ZWMoJ3JldF92YWw9MSsxJykKICAgIHJldHVybiBzdHIocmV0X3ZhbCkKCmRlZiBkb0V2YWxGdW5jdGlvbihmdW5fY2FsbCxwYWdlX2RhdGEsQ29va2llX0phcixtKToKICAgIHByaW50ICdkb0V2YWxGdW5jdGlvbicKICAgIHJldF92YWw9JycKICAgIGlmIGZ1bmN0aW9uc19kaXIgbm90IGluIHN5cy5wYXRoOgogICAgICAgIHN5cy5wYXRoLmFwcGVuZChmdW5jdGlvbnNfZGlyKQogICAgZj1vcGVuKGZ1bmN0aW9uc19kaXIrIi9MU1Byb2R5bmFtaWNDb2RlLnB5IiwidyIpCiAgICBmLndyaXRlKGZ1bl9jYWxsKTsKICAgIGYuY2xvc2UoKQogICAgaW1wb3J0IExTUHJvZHluYW1pY0NvZGUKICAgIHJldF92YWw9TFNQcm9keW5hbWljQ29kZS5HZXRMU1Byb0RhdGEocGFnZV9kYXRhLENvb2tpZV9KYXIsbSkKICAgIHJldHVybiBzdHIocmV0X3ZhbCkKCgpkZWYgcHJvY2Vzc1JlY2FwdGNoYSh1cmwpOgogICAgaHRtbF90ZXh0PWdldFVybCh1cmwpCiAgICByZWNhcENoYWxsZW5nZT0iIgogICAgc29sdXRpb249IiIKICAgIGNhcF9yZWc9IjxzY3JpcHQuKj9zcmM9XCIoLio/cmVjYXAuKj8pXCIiCiAgICBtYXRjaCA9cmUuZmluZGFsbChjYXBfcmVnLCBodG1sX3RleHQpCiAgICBjYXB0Y2hhPUZhbHNlCiAgICBjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbD1Ob25lCiAgICBzb2x1dGlvbj1Ob25lCgogICAgaWYgbWF0Y2ggYW5kIGxlbihtYXRjaCk+MDogI25ldyBzaGlueSBjYXB0Y2hhIQogICAgICAgIGNhcHRjaGFfdXJsPW1hdGNoWzBdCiAgICAgICAgY2FwdGNoYT1UcnVlCgogICAgICAgIGNhcF9jaGFsbF9yZWc9J2NoYWxsZW5nZS4qP1wnKC4qPylcJycKICAgICAgICBjYXBfaW1hZ2VfcmVnPSdcJyguKj8pXCcnCiAgICAgICAgY2FwdGNoYV9zY3JpcHQ9Z2V0VXJsKGNhcHRjaGFfdXJsKQogICAgICAgIHJlY2FwQ2hhbGxlbmdlPXJlLmZpbmRhbGwoY2FwX2NoYWxsX3JlZywgY2FwdGNoYV9zY3JpcHQpWzBdCiAgICAgICAgY2FwdGNoYV9yZWxvYWQ9J2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpL3JlbG9hZD9jPSc7CiAgICAgICAgY2FwdGNoYV9rPWNhcHRjaGFfdXJsLnNwbGl0KCdrPScpWzFdCiAgICAgICAgY2FwdGNoYV9yZWxvYWQrPXJlY2FwQ2hhbGxlbmdlKycmaz0nK2NhcHRjaGFfaysnJmNhcHRjaGFfaz0xJnR5cGU9aW1hZ2UmbGFuZz1lbi1HQicKICAgICAgICBjYXB0Y2hhX3JlbG9hZF9qcz1nZXRVcmwoY2FwdGNoYV9yZWxvYWQpCiAgICAgICAgY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGw9cmUuZmluZGFsbChjYXBfaW1hZ2VfcmVnLCBjYXB0Y2hhX3JlbG9hZF9qcylbMF0KICAgICAgICBjYXB0Y2hhX2ltYWdlX3VybD0naHR0cDovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS9hcGkvaW1hZ2U/Yz0nK2NhcHRjaGFfcmVsb2FkX3Jlc3BvbnNlX2NoYWxsCiAgICAgICAgaWYgbm90IGNhcHRjaGFfaW1hZ2VfdXJsLnN0YXJ0c3dpdGgoImh0dHAiKToKICAgICAgICAgICAgY2FwdGNoYV9pbWFnZV91cmw9J2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpLycrY2FwdGNoYV9pbWFnZV91cmwKICAgICAgICBpbXBvcnQgcmFuZG9tCiAgICAgICAgbj1yYW5kb20ucmFuZHJhbmdlKDEwMCwxMDAwLDUpCiAgICAgICAgbG9jYWxfY2FwdGNoYSA9IG9zLnBhdGguam9pbihwcm9maWxlLHN0cihuKSArImNhcHRjaGEuaW1nIiApCiAgICAgICAgbG9jYWxGaWxlID0gb3Blbihsb2NhbF9jYXB0Y2hhLCAid2IiKQogICAgICAgIGxvY2FsRmlsZS53cml0ZShnZXRVcmwoY2FwdGNoYV9pbWFnZV91cmwpKQogICAgICAgIGxvY2FsRmlsZS5jbG9zZSgpCiAgICAgICAgc29sdmVyID0gSW5wdXRXaW5kb3coY2FwdGNoYT1sb2NhbF9jYXB0Y2hhKQogICAgICAgIHNvbHV0aW9uID0gc29sdmVyLmdldCgpCiAgICAgICAgb3MucmVtb3ZlKGxvY2FsX2NhcHRjaGEpCiAgICByZXR1cm4gY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGwgLHNvbHV0aW9uCgpkZWYgZ2V0VXJsKHVybCwgY29va2llSmFyPU5vbmUscG9zdD1Ob25lLCB0aW1lb3V0PTIwLCBoZWFkZXJzPU5vbmUpOgoKCiAgICBjb29raWVfaGFuZGxlciA9IHVybGxpYjIuSFRUUENvb2tpZVByb2Nlc3Nvcihjb29raWVKYXIpCiAgICBvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlciwgdXJsbGliMi5IVFRQQmFzaWNBdXRoSGFuZGxlcigpLCB1cmxsaWIyLkhUVFBIYW5kbGVyKCkpCiAgICAjb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCiAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QodXJsKQogICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IFdPVzY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMzMuMC4xNzUwLjE1NCBTYWZhcmkvNTM3LjM2JykKICAgIGlmIGhlYWRlcnM6CiAgICAgICAgZm9yIGgsaHYgaW4gaGVhZGVyczoKICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoaCxodikKCiAgICByZXNwb25zZSA9IG9wZW5lci5vcGVuKHJlcSxwb3N0LHRpbWVvdXQ9dGltZW91dCkKICAgIGxpbms9cmVzcG9uc2UucmVhZCgpCiAgICByZXNwb25zZS5jbG9zZSgpCiAgICByZXR1cm4gbGluazsKCmRlZiBnZXRfZGVjb2RlKHN0cixyZWc9Tm9uZSk6CiAgICBpZiByZWc6CiAgICAgICAgc3RyPXJlLmZpbmRhbGwocmVnLCBzdHIpWzBdCiAgICBzMSA9IHVybGxpYi51bnF1b3RlKHN0clswOiBsZW4oc3RyKS0xXSk7CiAgICB0ID0gJyc7CiAgICBmb3IgaSBpbiByYW5nZSggbGVuKHMxKSk6CiAgICAgICAgdCArPSBjaHIob3JkKHMxW2ldKSAtIHMxW2xlbihzMSktMV0pOwogICAgdD11cmxsaWIudW5xdW90ZSh0KQogICAgcHJpbnQgdAogICAgcmV0dXJuIHQKCmRlZiBqYXZhc2NyaXB0VW5Fc2NhcGUoc3RyKToKICAgIGpzPXJlLmZpbmRhbGwoJ3VuZXNjYXBlXChcJyguKj8pXCcnLHN0cikKICAgIHByaW50ICdqcycsanMKICAgIGlmIChub3QganM9PU5vbmUpIGFuZCBsZW4oanMpPjA6CiAgICAgICAgZm9yIGogaW4ganM6CiAgICAgICAgICAgICNwcmludCB1cmxsaWIudW5xdW90ZShqKQogICAgICAgICAgICBzdHI9c3RyLnJlcGxhY2UoaiAsdXJsbGliLnVucXVvdGUoaikpCiAgICByZXR1cm4gc3RyCgppaWQ9MApkZWYgYXNrQ2FwdGNoYShtLGh0bWxfcGFnZSwgY29va2llSmFyKToKICAgIGdsb2JhbCBpaWQKICAgIGlpZCs9MQogICAgZXhwcmU9IG1bJ2V4cHJlcyddCiAgICBwYWdlX3VybCA9IG1bJ3BhZ2UnXQogICAgY2FwdGNoYV9yZWdleD1yZS5jb21waWxlKCdcJExpdmVTdHJlYW1DYXB0Y2hhXFsoW15cXV0qKVxdJykuZmluZGFsbChleHByZSlbMF0KCiAgICBjYXB0Y2hhX3VybD1yZS5jb21waWxlKGNhcHRjaGFfcmVnZXgpLmZpbmRhbGwoaHRtbF9wYWdlKVswXQogICAgcHJpbnQgZXhwcmUsY2FwdGNoYV9yZWdleCxjYXB0Y2hhX3VybAogICAgaWYgbm90IGNhcHRjaGFfdXJsLnN0YXJ0c3dpdGgoImh0dHAiKToKICAgICAgICBwYWdlXz0naHR0cDovLycrIiIuam9pbihwYWdlX3VybC5zcGxpdCgnLycpWzI6M10pCiAgICAgICAgaWYgY2FwdGNoYV91cmwuc3RhcnRzd2l0aCgiLyIpOgogICAgICAgICAgICBjYXB0Y2hhX3VybD1wYWdlXytjYXB0Y2hhX3VybAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGNhcHRjaGFfdXJsPXBhZ2VfKycvJytjYXB0Y2hhX3VybAoKICAgIGxvY2FsX2NhcHRjaGEgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgc3RyKGlpZCkrImNhcHRjaGEuanBnIiApCiAgICBsb2NhbEZpbGUgPSBvcGVuKGxvY2FsX2NhcHRjaGEsICJ3YiIpCiAgICBwcmludCAnIGMgY2FwdXJsJyxjYXB0Y2hhX3VybAogICAgcmVxID0gdXJsbGliMi5SZXF1ZXN0KGNhcHRjaGFfdXJsKQogICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBydjoxNC4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzE0LjAuMScpCiAgICBpZiAncmVmZXJlcicgaW4gbToKICAgICAgICByZXEuYWRkX2hlYWRlcignUmVmZXJlcicsIG1bJ3JlZmVyZXInXSkKICAgIGlmICdhZ2VudCcgaW4gbToKICAgICAgICByZXEuYWRkX2hlYWRlcignVXNlci1hZ2VudCcsIG1bJ2FnZW50J10pCiAgICBpZiAnc2V0Y29va2llJyBpbiBtOgogICAgICAgIHByaW50ICdhZGRpbmcgY29va2llJyxtWydzZXRjb29raWUnXQogICAgICAgIHJlcS5hZGRfaGVhZGVyKCdDb29raWUnLCBtWydzZXRjb29raWUnXSkKCiAgICAjY29va2llX2hhbmRsZXIgPSB1cmxsaWIyLkhUVFBDb29raWVQcm9jZXNzb3IoY29va2llSmFyKQogICAgI29wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGNvb2tpZV9oYW5kbGVyLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkKICAgICNvcGVuZXIgPSB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikKICAgIHVybGxpYjIudXJsb3BlbihyZXEpCiAgICByZXNwb25zZSA9IHVybGxpYjIudXJsb3BlbihyZXEpCgogICAgbG9jYWxGaWxlLndyaXRlKHJlc3BvbnNlLnJlYWQoKSkKICAgIHJlc3BvbnNlLmNsb3NlKCkKICAgIGxvY2FsRmlsZS5jbG9zZSgpCiAgICBzb2x2ZXIgPSBJbnB1dFdpbmRvdyhjYXB0Y2hhPWxvY2FsX2NhcHRjaGEpCiAgICBzb2x1dGlvbiA9IHNvbHZlci5nZXQoKQogICAgcmV0dXJuIHNvbHV0aW9uCgpkZWYgYXNrQ2FwdGNoYU5ldyhpbWFnZXJlZ2V4LGh0bWxfcGFnZSxjb29raWVKYXIsbSk6CiAgICBnbG9iYWwgaWlkCiAgICBpaWQrPTEKCgogICAgaWYgbm90IGltYWdlcmVnZXg9PScnOgogICAgICAgIGlmIGh0bWxfcGFnZS5zdGFydHN3aXRoKCJodHRwIik6CiAgICAgICAgICAgIHBhZ2VfPWdldFVybChodG1sX3BhZ2UsY29va2llSmFyPWNvb2tpZUphcikKICAgICAgICBlbHNlOgogICAgICAgICAgICBwYWdlXz1odG1sX3BhZ2UKICAgICAgICBjYXB0Y2hhX3VybD1yZS5jb21waWxlKGltYWdlcmVnZXgpLmZpbmRhbGwoaHRtbF9wYWdlKVswXQogICAgZWxzZToKICAgICAgICBjYXB0Y2hhX3VybD1odG1sX3BhZ2UKICAgICAgICBpZiAnb25lcGxheS50di9lbWJlZCcgaW4gaHRtbF9wYWdlOgogICAgICAgICAgICBpbXBvcnQgb25lcGxheQogICAgICAgICAgICBwYWdlXz1nZXRVcmwoaHRtbF9wYWdlLGNvb2tpZUphcj1jb29raWVKYXIpCiAgICAgICAgICAgIGNhcHRjaGFfdXJsPW9uZXBsYXkuZ2V0Q2FwdGNoYVVybChwYWdlXykKCiAgICBsb2NhbF9jYXB0Y2hhID0gb3MucGF0aC5qb2luKHByb2ZpbGUsIHN0cihpaWQpKyJjYXB0Y2hhLmpwZyIgKQogICAgbG9jYWxGaWxlID0gb3Blbihsb2NhbF9jYXB0Y2hhLCAid2IiKQogICAgcHJpbnQgJyBjIGNhcHVybCcsY2FwdGNoYV91cmwKICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdChjYXB0Y2hhX3VybCkKICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JywgJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgcnY6MTQuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xNC4wLjEnKQogICAgaWYgJ3JlZmVyZXInIGluIG06CiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1JlZmVyZXInLCBtWydyZWZlcmVyJ10pCiAgICBpZiAnYWdlbnQnIGluIG06CiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItYWdlbnQnLCBtWydhZ2VudCddKQogICAgaWYgJ2FjY2VwdCcgaW4gbToKICAgICAgICByZXEuYWRkX2hlYWRlcignQWNjZXB0JywgbVsnYWNjZXB0J10pCiAgICBpZiAnc2V0Y29va2llJyBpbiBtOgogICAgICAgIHByaW50ICdhZGRpbmcgY29va2llJyxtWydzZXRjb29raWUnXQogICAgICAgIHJlcS5hZGRfaGVhZGVyKCdDb29raWUnLCBtWydzZXRjb29raWUnXSkKCiAgICAjY29va2llX2hhbmRsZXIgPSB1cmxsaWIyLkhUVFBDb29raWVQcm9jZXNzb3IoY29va2llSmFyKQogICAgI29wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGNvb2tpZV9oYW5kbGVyLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkKICAgICNvcGVuZXIgPSB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikKICAgICN1cmxsaWIyLnVybG9wZW4ocmVxKQogICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQoKICAgIGxvY2FsRmlsZS53cml0ZShyZXNwb25zZS5yZWFkKCkpCiAgICByZXNwb25zZS5jbG9zZSgpCiAgICBsb2NhbEZpbGUuY2xvc2UoKQogICAgc29sdmVyID0gSW5wdXRXaW5kb3coY2FwdGNoYT1sb2NhbF9jYXB0Y2hhKQogICAgc29sdXRpb24gPSBzb2x2ZXIuZ2V0KCkKICAgIHJldHVybiBzb2x1dGlvbgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgRnVuY3Rpb24gIDogR1VJRWRpdEV4cG9ydE5hbWUgICAgICAgICAgICAgICAgICAgICAgICAgIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBQYXJhbWV0ZXIgOiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIwojIG5hbWUgICAgICAgIHN1Z2VzdGVkIG5hbWUgZm9yIGV4cG9ydCAgICAgICAgICAgICAgICAgICMKIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIAojIFJldHVybnMgICA6ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMKIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjCiMgbmFtZSAgICAgICAgbmFtZSBvZiBleHBvcnQgZXhjbHVkaW5nIGFueSBleHRlbnNpb24gICAgIwojICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCmRlZiBUYWtlSW5wdXQobmFtZSwgaGVhZG5hbWUpOgoKCiAgICBrYiA9IHhibWMuS2V5Ym9hcmQoJ2RlZmF1bHQnLCAnaGVhZGluZycsIFRydWUpCiAgICBrYi5zZXREZWZhdWx0KG5hbWUpCiAgICBrYi5zZXRIZWFkaW5nKGhlYWRuYW1lKQogICAga2Iuc2V0SGlkZGVuSW5wdXQoRmFsc2UpCiAgICByZXR1cm4ga2IuZ2V0VGV4dCgpCgogICAKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpjbGFzcyBJbnB1dFdpbmRvdyh4Ym1jZ3VpLldpbmRvd0RpYWxvZyk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICBzZWxmLmNwdGxvYyA9IGt3YXJncy5nZXQoJ2NhcHRjaGEnKQogICAgICAgIHNlbGYuaW1nID0geGJtY2d1aS5Db250cm9sSW1hZ2UoMzM1LDMwLDYyNCw2MCxzZWxmLmNwdGxvYykKICAgICAgICBzZWxmLmFkZENvbnRyb2woc2VsZi5pbWcpCiAgICAgICAgc2VsZi5rYmQgPSB4Ym1jLktleWJvYXJkKCkKCiAgICBkZWYgZ2V0KHNlbGYpOgogICAgICAgIHNlbGYuc2hvdygpCiAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgIHNlbGYua2JkLmRvTW9kYWwoKQogICAgICAgIGlmIChzZWxmLmtiZC5pc0NvbmZpcm1lZCgpKToKICAgICAgICAgICAgdGV4dCA9IHNlbGYua2JkLmdldFRleHQoKQogICAgICAgICAgICBzZWxmLmNsb3NlKCkKICAgICAgICAgICAgcmV0dXJuIHRleHQKICAgICAgICBzZWxmLmNsb3NlKCkKICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBnZXRFcG9jVGltZSgpOgogICAgaW1wb3J0IHRpbWUKICAgIHJldHVybiBzdHIoaW50KHRpbWUudGltZSgpKjEwMDApKQoKZGVmIGdldEVwb2NUaW1lMigpOgogICAgaW1wb3J0IHRpbWUKICAgIHJldHVybiBzdHIoaW50KHRpbWUudGltZSgpKSkKCmRlZiBnZXRfcGFyYW1zKCk6CiAgICAgICAgcGFyYW09W10KICAgICAgICBwYXJhbXN0cmluZz1zeXMuYXJndlsyXQogICAgICAgIGlmIGxlbihwYXJhbXN0cmluZyk+PTI6CiAgICAgICAgICAgIHBhcmFtcz1zeXMuYXJndlsyXQogICAgICAgICAgICBjbGVhbmVkcGFyYW1zPXBhcmFtcy5yZXBsYWNlKCc/JywnJykKICAgICAgICAgICAgaWYgKHBhcmFtc1tsZW4ocGFyYW1zKS0xXT09Jy8nKToKICAgICAgICAgICAgICAgIHBhcmFtcz1wYXJhbXNbMDpsZW4ocGFyYW1zKS0yXQogICAgICAgICAgICBwYWlyc29mcGFyYW1zPWNsZWFuZWRwYXJhbXMuc3BsaXQoJyYnKQogICAgICAgICAgICBwYXJhbT17fQogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4ocGFpcnNvZnBhcmFtcykpOgogICAgICAgICAgICAgICAgc3BsaXRwYXJhbXM9e30KICAgICAgICAgICAgICAgIHNwbGl0cGFyYW1zPXBhaXJzb2ZwYXJhbXNbaV0uc3BsaXQoJz0nKQogICAgICAgICAgICAgICAgaWYgKGxlbihzcGxpdHBhcmFtcykpPT0yOgogICAgICAgICAgICAgICAgICAgIHBhcmFtW3NwbGl0cGFyYW1zWzBdXT1zcGxpdHBhcmFtc1sxXQogICAgICAgIHJldHVybiBwYXJhbQoKCmRlZiBnZXRGYXZvcml0ZXMoKToKICAgICAgICBpdGVtcyA9IGpzb24ubG9hZHMob3BlbihmYXZvcml0ZXMpLnJlYWQoKSkKICAgICAgICB0b3RhbCA9IGxlbihpdGVtcykKICAgICAgICBmb3IgaSBpbiBpdGVtczoKICAgICAgICAgICAgbmFtZSA9IGlbMF0KICAgICAgICAgICAgdXJsID0gaVsxXQogICAgICAgICAgICBpY29uaW1hZ2UgPSBpWzJdCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZhbkFydCA9IGlbM10KICAgICAgICAgICAgICAgIGlmIGZhbkFydCA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3VzZV90aHVtYicpID09ICJ0cnVlIjoKICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBpY29uaW1hZ2UKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0CiAgICAgICAgICAgIHRyeTogcGxheWxpc3QgPSBpWzVdCiAgICAgICAgICAgIGV4Y2VwdDogcGxheWxpc3QgPSBOb25lCiAgICAgICAgICAgIHRyeTogcmVnZXhzID0gaVs2XQogICAgICAgICAgICBleGNlcHQ6IHJlZ2V4cyA9IE5vbmUKCiAgICAgICAgICAgIGlmIGlbNF0gPT0gMDoKICAgICAgICAgICAgICAgIGFkZExpbmsodXJsLG5hbWUsaWNvbmltYWdlLGZhbkFydCwnJywnJywnJywnZmF2JyxwbGF5bGlzdCxyZWdleHMsdG90YWwpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwsaVs0XSxpY29uaW1hZ2UsZmFuYXJ0LCcnLCcnLCcnLCcnLCdmYXYnKQoKCmRlZiBhZGRGYXZvcml0ZShuYW1lLHVybCxpY29uaW1hZ2UsZmFuYXJ0LG1vZGUscGxheWxpc3Q9Tm9uZSxyZWdleHM9Tm9uZSk6CiAgICAgICAgZmF2TGlzdCA9IFtdCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIHNlZW1zIHRoYXQgYWZ0ZXIKICAgICAgICAgICAgbmFtZSA9IG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGZhdm9yaXRlcyk9PUZhbHNlOgogICAgICAgICAgICBhZGRvbl9sb2coJ01ha2luZyBGYXZvcml0ZXMgRmlsZScpCiAgICAgICAgICAgIGZhdkxpc3QuYXBwZW5kKChuYW1lLHVybCxpY29uaW1hZ2UsZmFuYXJ0LG1vZGUscGxheWxpc3QscmVnZXhzKSkKICAgICAgICAgICAgYSA9IG9wZW4oZmF2b3JpdGVzLCAidyIpCiAgICAgICAgICAgIGEud3JpdGUoanNvbi5kdW1wcyhmYXZMaXN0KSkKICAgICAgICAgICAgYS5jbG9zZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYWRkb25fbG9nKCdBcHBlbmRpbmcgRmF2b3JpdGVzJykKICAgICAgICAgICAgYSA9IG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkKICAgICAgICAgICAgZGF0YSA9IGpzb24ubG9hZHMoYSkKICAgICAgICAgICAgZGF0YS5hcHBlbmQoKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQsbW9kZSkpCiAgICAgICAgICAgIGIgPSBvcGVuKGZhdm9yaXRlcywgInciKQogICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoZGF0YSkpCiAgICAgICAgICAgIGIuY2xvc2UoKQoKCmRlZiBybUZhdm9yaXRlKG5hbWUpOgogICAgICAgIGRhdGEgPSBqc29uLmxvYWRzKG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkpCiAgICAgICAgZm9yIGluZGV4IGluIHJhbmdlKGxlbihkYXRhKSk6CiAgICAgICAgICAgIGlmIGRhdGFbaW5kZXhdWzBdPT1uYW1lOgogICAgICAgICAgICAgICAgZGVsIGRhdGFbaW5kZXhdCiAgICAgICAgICAgICAgICBiID0gb3BlbihmYXZvcml0ZXMsICJ3IikKICAgICAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhkYXRhKSkKICAgICAgICAgICAgICAgIGIuY2xvc2UoKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5SZWZyZXNoIikKCmRlZiB1cmxzb2x2ZXIodXJsKToKICAgIGltcG9ydCB1cmxyZXNvbHZlcgogICAgaG9zdCA9IHVybHJlc29sdmVyLkhvc3RlZE1lZGlhRmlsZSh1cmwpCiAgICBpZiBob3N0OgogICAgICAgIHJlc29sdmVyID0gdXJscmVzb2x2ZXIucmVzb2x2ZSh1cmwpCiAgICAgICAgcmVzb2x2ZWQgPSByZXNvbHZlcgogICAgICAgIGlmIGlzaW5zdGFuY2UocmVzb2x2ZWQsbGlzdCk6CiAgICAgICAgICAgIGZvciBrIGluIHJlc29sdmVkOgogICAgICAgICAgICAgICAgcXVhbGl0eSA9IGFkZG9uLmdldFNldHRpbmcoJ3F1YWxpdHknKQogICAgICAgICAgICAgICAgaWYga1sncXVhbGl0eSddID09ICdIRCcgIDoKICAgICAgICAgICAgICAgICAgICByZXNvbHZlciA9IGtbJ3VybCddCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVsaWYga1sncXVhbGl0eSddID09ICdTRCcgOgogICAgICAgICAgICAgICAgICAgIHJlc29sdmVyID0ga1sndXJsJ10KICAgICAgICAgICAgICAgIGVsaWYga1sncXVhbGl0eSddID09ICcxMDgwcCcgYW5kIGFkZG9uLmdldFNldHRpbmcoJzEwODBwcXVhbGl0eScpID09ICd0cnVlJyA6CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIgPSBrWyd1cmwnXQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmVzb2x2ZXIgPSByZXNvbHZlZAogICAgZWxzZToKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbih0dmRpcmV0byxVcmxyZXNvbHZlciBkb25vdCBzdXBwb3J0IHRoaXMgZG9tYWluLiAtICw1MDAwKSIpCiAgICByZXR1cm4gcmVzb2x2ZXIKZGVmIHBsYXlfcGxheWxpc3QobmFtZSwgbXVfcGxheWxpc3QscXVldWVWaWRlbz1Ob25lKToKICAgICAgICBwbGF5bGlzdCA9IHhibWMuUGxheUxpc3QoeGJtYy5QTEFZTElTVF9WSURFTykKCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnYXNrX3BsYXlsaXN0X2l0ZW1zJykgPT0gJ3RydWUnIGFuZCBub3QgcXVldWVWaWRlbyA6CiAgICAgICAgICAgIGltcG9ydCB1cmxwYXJzZQogICAgICAgICAgICBuYW1lcyA9IFtdCiAgICAgICAgICAgIGZvciBpIGluIG11X3BsYXlsaXN0OgogICAgICAgICAgICAgICAgZF9uYW1lPXVybHBhcnNlLnVybHBhcnNlKGkpLm5ldGxvYwogICAgICAgICAgICAgICAgaWYgZF9uYW1lID09ICcnOgogICAgICAgICAgICAgICAgICAgIG5hbWVzLmFwcGVuZChuYW1lKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBuYW1lcy5hcHBlbmQoZF9uYW1lKQogICAgICAgICAgICBkaWFsb2cgPSB4Ym1jZ3VpLkRpYWxvZygpCiAgICAgICAgICAgIGluZGV4ID0gZGlhbG9nLnNlbGVjdCgnQ2hvb3NlIGEgdmlkZW8gc291cmNlJywgbmFtZXMpCiAgICAgICAgICAgIGlmIGluZGV4ID49IDA6CiAgICAgICAgICAgICAgICBpZiAiJm1vZGU9MTkiIGluIG11X3BsYXlsaXN0W2luZGV4XToKICAgICAgICAgICAgICAgICAgICAjcGxheXNldHJlc29sdmVkICh1cmxzb2x2ZXIobXVfcGxheWxpc3RbaW5kZXhdLnJlcGxhY2UoJyZtb2RlPTE5JywnJykpLG5hbWUsaWNvbmltYWdlLFRydWUpCiAgICAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybHNvbHZlcihtdV9wbGF5bGlzdFtpbmRleF0ucmVwbGFjZSgnJm1vZGU9MTknLCcnKS5yZXBsYWNlKCc7JywnJykpKQogICAgICAgICAgICAgICAgZWxpZiAiJGRvcmVnZXgiIGluIG11X3BsYXlsaXN0W2luZGV4XSA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQgbXVfcGxheWxpc3RbaW5kZXhdCiAgICAgICAgICAgICAgICAgICAgc2VwYXRlID0gbXVfcGxheWxpc3RbaW5kZXhdLnNwbGl0KCcmcmVnZXhzPScpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgc2VwYXRlCiAgICAgICAgICAgICAgICAgICAgdXJsLHNldHJlc29sdmVkID0gZ2V0UmVnZXhQYXJzZWQoc2VwYXRlWzFdLCBzZXBhdGVbMF0pCiAgICAgICAgICAgICAgICAgICAgdXJsMiA9IHVybC5yZXBsYWNlKCc7JywnJykKICAgICAgICAgICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsMikKCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHVybCA9IG11X3BsYXlsaXN0W2luZGV4XQogICAgICAgICAgICAgICAgICAgIHhibWMuUGxheWVyKCkucGxheSh1cmwpCiAgICAgICAgZWxpZiBub3QgcXVldWVWaWRlbzoKICAgICAgICAgICAgI3BsYXlsaXN0ID0geGJtYy5QbGF5TGlzdCgxKSAjIDEgbWVhbnMgdmlkZW8KICAgICAgICAgICAgcGxheWxpc3QuY2xlYXIoKQogICAgICAgICAgICBpdGVtID0gMAogICAgICAgICAgICBmb3IgaSBpbiBtdV9wbGF5bGlzdDoKICAgICAgICAgICAgICAgIGl0ZW0gKz0gMQogICAgICAgICAgICAgICAgaW5mbyA9IHhibWNndWkuTGlzdEl0ZW0oJyVzKSAlcycgJShzdHIoaXRlbSksbmFtZSkpCiAgICAgICAgICAgICAgICAjIERvbid0IGRvIHRoaXMgYXMgcmVnZXggcGFyc2VkIG1pZ2h0IHRha2UgbG9uZ2VyCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaWYgIiRkb3JlZ2V4IiBpbiBpOgogICAgICAgICAgICAgICAgICAgICAgICBzZXBhdGUgPSBpLnNwbGl0KCcmcmVnZXhzPScpCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50IHNlcGF0ZQogICAgICAgICAgICAgICAgICAgICAgICB1cmwsc2V0cmVzb2x2ZWQgPSBnZXRSZWdleFBhcnNlZChzZXBhdGVbMV0sIHNlcGF0ZVswXSkKICAgICAgICAgICAgICAgICAgICBlbGlmICImbW9kZT0xOSIgaW4gaToKICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsc29sdmVyKGkucmVwbGFjZSgnJm1vZGU9MTknLCcnKS5yZXBsYWNlKCc7JywnJykpICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgdXJsOgogICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hZGQodXJsLCBpbmZvKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFkZChpLCBpbmZvKQogICAgICAgICAgICAgICAgICAgIHBhc3MgI3hibWMuUGxheWVyKCkucGxheSh1cmwpCgogICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdwbGF5bGlzdC5wbGF5b2Zmc2V0KHZpZGVvLDApJykKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgIGxpc3RpdGVtID0geGJtY2d1aS5MaXN0SXRlbShuYW1lKQogICAgICAgICAgICAgICAgcGxheWxpc3QuYWRkKG11X3BsYXlsaXN0LCBsaXN0aXRlbSkKCgpkZWYgZG93bmxvYWRfZmlsZShuYW1lLCB1cmwpOgogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3NhdmVfbG9jYXRpb24nKSA9PSAiIjoKICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oJ3R2ZGlyZXRvJywnQ2hvb3NlIGEgbG9jYXRpb24gdG8gc2F2ZSBmaWxlcy4nLDE1MDAwLCIraWNvbisiKSIpCiAgICAgICAgICAgIGFkZG9uLm9wZW5TZXR0aW5ncygpCiAgICAgICAgcGFyYW1zID0geyd1cmwnOiB1cmwsICdkb3dubG9hZF9wYXRoJzogYWRkb24uZ2V0U2V0dGluZygnc2F2ZV9sb2NhdGlvbicpfQogICAgICAgIGRvd25sb2FkZXIuZG93bmxvYWQobmFtZSwgcGFyYW1zKQogICAgICAgIGRpYWxvZyA9IHhibWNndWkuRGlhbG9nKCkKICAgICAgICByZXQgPSBkaWFsb2cueWVzbm8oJ3R2ZGlyZXRvJywgJ0RvIHlvdSB3YW50IHRvIGFkZCB0aGlzIGZpbGUgYXMgYSBzb3VyY2U/JykKICAgICAgICBpZiByZXQ6CiAgICAgICAgICAgIGFkZFNvdXJjZShvcy5wYXRoLmpvaW4oYWRkb24uZ2V0U2V0dGluZygnc2F2ZV9sb2NhdGlvbicpLCBuYW1lKSkKCmRlZiBfc2VhcmNoKHVybCxuYW1lKToKICAgIyBwcmludCB1cmwsbmFtZQogICAgcGx1Z2luc2VhcmNodXJscyA9IFsncGx1Z2luLnZpZGVvLlBzeWNob1RWJyxcCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnBoc3RyZWFtcycsXAoJICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsJyxcCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLkNhblRWTGl2ZScsXAogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby5jY2xvdWR0dicsXAogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby5wcm9zcG9ydCcsXAogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby5wMnBzcG9ydCcsXAogICAgICAgICAgICAgXQogICAgbmFtZXMgPSBbJ1BzeWNobyBUVicsJ1Bob2VuaXgnLCdTcG9ydHNEZXZpbCcsJ0NhblRWTGl2ZScsJ0NjbG91ZHR2JywnUHJvc3BvcnQnLFwKICAgICAgICAgICAgICdQMnBzcG9ydCddCiAgICBkaWFsb2cgPSB4Ym1jZ3VpLkRpYWxvZygpCiAgICBpbmRleCA9IGRpYWxvZy5zZWxlY3QoJ0Nob29zZSBhIHZpZGVvIHNvdXJjZScsIG5hbWVzKQoKICAgIGlmIGluZGV4ID49IDA6CiAgICAgICAgdXJsID0gcGx1Z2luc2VhcmNodXJsc1tpbmRleF0KICAgICAgICBwcmludCAndXJsJyx1cmwKICAgICAgICBwbHVnaW5xdWVyeWJ5SlNPTih1cmwpCgpkZWYgYWRkRGlyKG5hbWUsdXJsLG1vZGUsaWNvbmltYWdlLGZhbmFydCxkZXNjcmlwdGlvbixnZW5yZSxkYXRlLGNyZWRpdHMsc2hvd2NvbnRleHQ9RmFsc2UscmVnZXhzPU5vbmUscmVnX3VybD1Ob25lLGFsbGluZm89e30pOgoKICAgICAgICB1PXN5cy5hcmd2WzBdKyI/dXJsPSIrdXJsbGliLnF1b3RlX3BsdXModXJsKSsiJm1vZGU9IitzdHIobW9kZSkrIiZuYW1lPSIrdXJsbGliLnF1b3RlX3BsdXMobmFtZSkrIiZmYW5hcnQ9Iit1cmxsaWIucXVvdGVfcGx1cyhmYW5hcnQpCiAgICAgICAgb2s9VHJ1ZQogICAgICAgIGlmIGRhdGUgPT0gJyc6CiAgICAgICAgICAgIGRhdGUgPSBOb25lCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZGVzY3JpcHRpb24gKz0gJ1xuXG5EYXRlOiAlcycgJWRhdGUKICAgICAgICBsaXo9eGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9IkRlZmF1bHRGb2xkZXIucG5nIiwgdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKQogICAgICAgIGlmIGxlbihhbGxpbmZvKSA8MSA6CiAgICAgICAgICAgIGxpei5zZXRJbmZvKHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz17ICJUaXRsZSI6IG5hbWUsICJQbG90IjogZGVzY3JpcHRpb24sICJHZW5yZSI6IGdlbnJlLCAiZGF0ZWFkZGVkIjogZGF0ZSwgImNyZWRpdHMiOiBjcmVkaXRzIH0pCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbGl6LnNldEluZm8odHlwZT0iVmlkZW8iLCBpbmZvTGFiZWxzPSBhbGxpbmZvKQogICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiRmFuYXJ0X0ltYWdlIiwgZmFuYXJ0KQogICAgICAgIGlmIHNob3djb250ZXh0OgogICAgICAgICAgICBjb250ZXh0TWVudSA9IFtdCiAgICAgICAgICAgIHBhcmVudGFsYmxvY2sgPWFkZG9uLmdldFNldHRpbmcoJ3BhcmVudGFsYmxvY2tlZCcpCiAgICAgICAgICAgIHBhcmVudGFsYmxvY2s9IHBhcmVudGFsYmxvY2s9PSJ0cnVlIgogICAgICAgICAgICBwYXJlbnRhbGJsb2NrZWRwaW4gPWFkZG9uLmdldFNldHRpbmcoJ3BhcmVudGFsYmxvY2tlZHBpbicpCiMgICAgICAgICAgICBwcmludCAncGFyZW50YWxibG9ja2VkcGluJyxwYXJlbnRhbGJsb2NrZWRwaW4KICAgICAgICAgICAgaWYgbGVuKHBhcmVudGFsYmxvY2tlZHBpbik+MDoKICAgICAgICAgICAgICAgIGlmIHBhcmVudGFsYmxvY2s6CiAgICAgICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnRGlzYWJsZSBQYXJlbnRhbCBCbG9jaycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NTUmbmFtZT0lcyknICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0VuYWJsZSBQYXJlbnRhbCBCbG9jaycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NTYmbmFtZT0lcyknICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHNob3djb250ZXh0ID09ICdzb3VyY2UnOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5hbWUgaW4gc3RyKFNPVVJDRVMpOgogICAgICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1JlbW92ZSBmcm9tIFNvdXJjZXMnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTgmbmFtZT0lcyknICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVsaWYgc2hvd2NvbnRleHQgPT0gJ2Rvd25sb2FkJzoKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0Rvd25sb2FkJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9OSZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkKICAgICAgICAgICAgZWxpZiBzaG93Y29udGV4dCA9PSAnZmF2JzoKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1JlbW92ZSBmcm9tIHR2ZGlyZXRvIEZhdm9yaXRlcycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NiZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkKICAgICAgICAgICAgaWYgc2hvd2NvbnRleHQgPT0gJyEhdXBkYXRlJzoKICAgICAgICAgICAgICAgIGZhdl9wYXJhbXMyID0gKAogICAgICAgICAgICAgICAgICAgICclcz91cmw9JXMmbW9kZT0xNyZyZWdleHM9JXMnCiAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMocmVnX3VybCksIHJlZ2V4cykKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1IgeWVsbG93XSEhdXBkYXRlWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcyknICVmYXZfcGFyYW1zMikpCiAgICAgICAgICAgIGlmIG5vdCBuYW1lIGluIEZBVjoKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0FkZCB0byB0dmRpcmV0byBGYXZvcml0ZXMnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTUmbmFtZT0lcyZ1cmw9JXMmaWNvbmltYWdlPSVzJmZhbmFydD0lcyZmYXZfbW9kZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMoaWNvbmltYWdlKSwgdXJsbGliLnF1b3RlX3BsdXMoZmFuYXJ0KSwgbW9kZSkpKQogICAgICAgICAgICBsaXouYWRkQ29udGV4dE1lbnVJdGVtcyhjb250ZXh0TWVudSkKICAgICAgICBvaz14Ym1jcGx1Z2luLmFkZERpcmVjdG9yeUl0ZW0oaGFuZGxlPWludChzeXMuYXJndlsxXSksdXJsPXUsbGlzdGl0ZW09bGl6LGlzRm9sZGVyPVRydWUpCiAgICAgICAgcmV0dXJuIG9rCmRlZiB5dGRsX2Rvd25sb2FkKHVybCx0aXRsZSxtZWRpYV90eXBlPSd2aWRlbycpOgogICAgIyBwbGF5IGluIHhibWMgd2hpbGUgcGxheWluZyBnbyBiYWNrIHRvIGNvbnRleHRNZW51KGMpIHRvICIhIURvd25sb2FkISEiCiAgICAjIFRyaWFsIHlhc2NlZW46IHNlcGVyYXRlIHxVc2VyLUFnZW50PQogICAgaW1wb3J0IHlvdXR1YmVkbAogICAgaWYgbm90IHVybCA9PSAnJzoKICAgICAgICBpZiBtZWRpYV90eXBlPT0gJ2F1ZGlvJzoKICAgICAgICAgICAgeW91dHViZWRsLnNpbmdsZV9ZRCh1cmwsZG93bmxvYWQ9VHJ1ZSxhdWRpbz1UcnVlKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHlvdXR1YmVkbC5zaW5nbGVfWUQodXJsLGRvd25sb2FkPVRydWUpCiAgICBlbGlmIHhibWMuUGxheWVyKCkuaXNQbGF5aW5nKCkgPT0gVHJ1ZSA6CiAgICAgICAgaW1wb3J0IFlEU3RyZWFtRXh0cmFjdG9yCiAgICAgICAgaWYgWURTdHJlYW1FeHRyYWN0b3IuaXNEb3dubG9hZGluZygpID09IFRydWU6CgogICAgICAgICAgICBZRFN0cmVhbUV4dHJhY3Rvci5tYW5hZ2VEb3dubG9hZHMoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHhibWNfdXJsID0geGJtYy5QbGF5ZXIoKS5nZXRQbGF5aW5nRmlsZSgpCgogICAgICAgICAgICB4Ym1jX3VybCA9IHhibWNfdXJsLnNwbGl0KCd8VXNlci1BZ2VudD0nKVswXQogICAgICAgICAgICBpbmZvID0geyd1cmwnOnhibWNfdXJsLCd0aXRsZSc6dGl0bGUsJ21lZGlhX3R5cGUnOm1lZGlhX3R5cGV9CiAgICAgICAgICAgIHlvdXR1YmVkbC5zaW5nbGVfWUQoJycsZG93bmxvYWQ9VHJ1ZSxkbF9pbmZvPWluZm8pCiAgICBlbHNlOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKERPV05MT0FELEZpcnN0IFBsYXkgW0NPTE9SIHllbGxvd11XSElMRSBwbGF5aW5nIGRvd25sb2FkWy9DT0xPUl0gLDEwMDAwKSIpCgojIyBMdW5hdGl4eiBQc2V1ZG9UViBmZWF0dXJlCmRlZiBhc2NpaShzdHJpbmcpOgogICAgaWYgaXNpbnN0YW5jZShzdHJpbmcsIGJhc2VzdHJpbmcpOgogICAgICAgIGlmIGlzaW5zdGFuY2Uoc3RyaW5nLCB1bmljb2RlKToKICAgICAgICAgICBzdHJpbmcgPSBzdHJpbmcuZW5jb2RlKCdhc2NpaScsICdpZ25vcmUnKQogICAgcmV0dXJuIHN0cmluZwpkZWYgdW5pKHN0cmluZywgZW5jb2RpbmcgPSAndXRmLTgnKToKICAgIGlmIGlzaW5zdGFuY2Uoc3RyaW5nLCBiYXNlc3RyaW5nKToKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShzdHJpbmcsIHVuaWNvZGUpOgogICAgICAgICAgICBzdHJpbmcgPSB1bmljb2RlKHN0cmluZywgZW5jb2RpbmcsICdpZ25vcmUnKQogICAgcmV0dXJuIHN0cmluZwpkZWYgcmVtb3ZlTm9uQXNjaWkocyk6IHJldHVybiAiIi5qb2luKGZpbHRlcihsYW1iZGEgeDogb3JkKHgpPDEyOCwgcykpCgpkZWYgc2VuZEpTT04oIGNvbW1hbmQpOgogICAgZGF0YSA9ICcnCiAgICB0cnk6CiAgICAgICAgZGF0YSA9IHhibWMuZXhlY3V0ZUpTT05SUEModW5pKGNvbW1hbmQpKQogICAgZXhjZXB0IFVuaWNvZGVFbmNvZGVFcnJvcjoKICAgICAgICBkYXRhID0geGJtYy5leGVjdXRlSlNPTlJQQyhhc2NpaShjb21tYW5kKSkKCiAgICByZXR1cm4gdW5pKGRhdGEpCgpkZWYgcGx1Z2lucXVlcnlieUpTT04odXJsLGdpdmVfbWVfcmVzdWx0PU5vbmUscGxheWxpc3Q9RmFsc2UpOgogICAgaWYgJ2F1ZGlvJyBpbiB1cmw6CiAgICAgICAganNvbl9xdWVyeSA9IHVuaSgneyJqc29ucnBjIjoiMi4wIiwibWV0aG9kIjoiRmlsZXMuR2V0RGlyZWN0b3J5IiwicGFyYW1zIjogeyJkaXJlY3RvcnkiOiIlcyIsIm1lZGlhIjoidmlkZW8iLCAicHJvcGVydGllcyI6IFsidGl0bGUiLCAiYWxidW0iLCAiYXJ0aXN0IiwgImR1cmF0aW9uIiwidGh1bWJuYWlsIiwgInllYXIiXX0sICJpZCI6IDF9JykgJXVybAogICAgZWxzZToKICAgICAgICBqc29uX3F1ZXJ5ID0gdW5pKCd7Impzb25ycGMiOiIyLjAiLCJtZXRob2QiOiJGaWxlcy5HZXREaXJlY3RvcnkiLCJwYXJhbXMiOnsiZGlyZWN0b3J5IjoiJXMiLCJtZWRpYSI6InZpZGVvIiwicHJvcGVydGllcyI6WyAicGxvdCIsInBsYXljb3VudCIsImRpcmVjdG9yIiwgImdlbnJlIiwidm90ZXMiLCJkdXJhdGlvbiIsInRyYWlsZXIiLCJwcmVtaWVyZWQiLCJ0aHVtYm5haWwiLCJ0aXRsZSIsInllYXIiLCJkYXRlYWRkZWQiLCJmYW5hcnQiLCJyYXRpbmciLCJzZWFzb24iLCJlcGlzb2RlIiwic3R1ZGlvIiwibXBhYSJdfSwiaWQiOjF9JykgJXVybAogICAganNvbl9mb2xkZXJfZGV0YWlsID0ganNvbi5sb2FkcyhzZW5kSlNPTihqc29uX3F1ZXJ5KSkKICAgICNwcmludCBqc29uX2ZvbGRlcl9kZXRhaWwKICAgIGlmIGdpdmVfbWVfcmVzdWx0OgogICAgICAgIHJldHVybiBqc29uX2ZvbGRlcl9kZXRhaWwKICAgIGlmIGpzb25fZm9sZGVyX2RldGFpbC5oYXNfa2V5KCdlcnJvcicpOgogICAgICAgIHJldHVybgogICAgZWxzZToKCiAgICAgICAgZm9yIGkgaW4ganNvbl9mb2xkZXJfZGV0YWlsWydyZXN1bHQnXVsnZmlsZXMnXSA6CiAgICAgICAgICAgIG1ldGEgPXt9CiAgICAgICAgICAgIHVybCA9IGlbJ2ZpbGUnXQogICAgICAgICAgICBuYW1lID0gcmVtb3ZlTm9uQXNjaWkoaVsnbGFiZWwnXSkKICAgICAgICAgICAgdGh1bWJuYWlsID0gcmVtb3ZlTm9uQXNjaWkoaVsndGh1bWJuYWlsJ10pCiAgICAgICAgICAgIGZhbmFydCA9IHJlbW92ZU5vbkFzY2lpKGlbJ2ZhbmFydCddKQogICAgICAgICAgICBtZXRhID0gZGljdCgoayx2KSBmb3IgaywgdiBpbiBpLml0ZXJpdGVtcygpIGlmIG5vdCB2ID09ICcwJyBvciBub3QgdiA9PSAtMSBvciB2ID09ICcnKQogICAgICAgICAgICBtZXRhLnBvcCgiZmlsZSIsIE5vbmUpCiAgICAgICAgICAgIGlmIGlbJ2ZpbGV0eXBlJ10gPT0gJ2ZpbGUnOgogICAgICAgICAgICAgICAgaWYgcGxheWxpc3Q6CiAgICAgICAgICAgICAgICAgICAgcGxheV9wbGF5bGlzdChuYW1lLHVybCxxdWV1ZVZpZGVvPScxJykKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBhZGRMaW5rKHVybCxuYW1lLHRodW1ibmFpbCxmYW5hcnQsJycsJycsJycsJycsTm9uZSwnJyx0b3RhbD1sZW4oanNvbl9mb2xkZXJfZGV0YWlsWydyZXN1bHQnXVsnZmlsZXMnXSksYWxsaW5mbz1tZXRhKQogICAgICAgICAgICAgICAgICAgICN4Ym1jLmV4ZWN1dGVidWlsdGluKCJDb250YWluZXIuU2V0Vmlld01vZGUoNTAwKSIpCiAgICAgICAgICAgICAgICAgICAgaWYgaVsndHlwZSddIGFuZCBpWyd0eXBlJ10gPT0gJ3R2c2hvdycgOgogICAgICAgICAgICAgICAgICAgICAgICB4Ym1jcGx1Z2luLnNldENvbnRlbnQoaW50KHN5cy5hcmd2WzFdKSwgJ3R2c2hvd3MnKQogICAgICAgICAgICAgICAgICAgIGVsaWYgaVsnZXBpc29kZSddID4gMCA6CiAgICAgICAgICAgICAgICAgICAgICAgIHhibWNwbHVnaW4uc2V0Q29udGVudChpbnQoc3lzLmFyZ3ZbMV0pLCAnZXBpc29kZXMnKQoKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCw1Myx0aHVtYm5haWwsZmFuYXJ0LCcnLCcnLCcnLCcnLGFsbGluZm89bWV0YSkKICAgICAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgpkZWYgYWRkTGluayh1cmwsbmFtZSxpY29uaW1hZ2UsZmFuYXJ0LGRlc2NyaXB0aW9uLGdlbnJlLGRhdGUsc2hvd2NvbnRleHQscGxheWxpc3QscmVnZXhzLHRvdGFsLHNldENvb2tpZT0iIixhbGxpbmZvPXt9KToKICAgICAgICAjcHJpbnQgJ3VybCxuYW1lJyx1cmwsbmFtZQogICAgICAgIGNvbnRleHRNZW51ID1bXQogICAgICAgIHBhcmVudGFsYmxvY2sgPWFkZG9uLmdldFNldHRpbmcoJ3BhcmVudGFsYmxvY2tlZCcpCiAgICAgICAgcGFyZW50YWxibG9jaz0gcGFyZW50YWxibG9jaz09InRydWUiCiAgICAgICAgcGFyZW50YWxibG9ja2VkcGluID1hZGRvbi5nZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWRwaW4nKQojICAgICAgICBwcmludCAncGFyZW50YWxibG9ja2VkcGluJyxwYXJlbnRhbGJsb2NrZWRwaW4KICAgICAgICBpZiBsZW4ocGFyZW50YWxibG9ja2VkcGluKT4wOgogICAgICAgICAgICBpZiBwYXJlbnRhbGJsb2NrOgogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnRGlzYWJsZSBQYXJlbnRhbCBCbG9jaycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NTUmbmFtZT0lcyknICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdFbmFibGUgUGFyZW50YWwgQmxvY2snLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTU2Jm5hbWU9JXMpJyAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgbmFtZSA9IG5hbWUuZW5jb2RlKCd1dGYtOCcpCiAgICAgICAgZXhjZXB0OiBwYXNzCgkJCgkJCgkJI3ByZW1pdW1waW4gPWFkZG9uLmdldFNldHRpbmcoJ3ByZW1pdW1waW4nKQoJCQoJCQoJCQogICAgICAgIG9rID0gVHJ1ZQogICAgICAgIGlzRm9sZGVyPUZhbHNlCiAgICAgICAgaWYgcmVnZXhzOgogICAgICAgICAgICBtb2RlID0gJzE3JwogICAgICAgICAgICBpZiAnbGlzdHJlcGVhdCcgaW4gcmVnZXhzOgogICAgICAgICAgICAgICAgaXNGb2xkZXI9VHJ1ZQogICAgICAgICAgICAgICAgcHJpbnQgJ3NldHRpbmcgYXMgZm9sZGVyIGluIGxpbmsnCiAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1tDT0xPUiB3aGl0ZV0hIURvd25sb2FkIEN1cnJlbnRseSBQbGF5aW5nISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTIxJm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQogICAgICAgIGVsaWYgIChhbnkoeCBpbiB1cmwgZm9yIHggaW4gcmVzb2x2ZV91cmwpIGFuZCAgdXJsLnN0YXJ0c3dpdGgoJ2h0dHAnKSkgb3IgdXJsLmVuZHN3aXRoKCcmbW9kZT0xOScpOgogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyZtb2RlPTE5JywnJykKICAgICAgICAgICAgbW9kZSA9ICcxOScKICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQgQ3VycmVudGx5IFBsYXlpbmchIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjEmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgZWxpZiB1cmwuZW5kc3dpdGgoJyZtb2RlPTE4Jyk6CiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJm1vZGU9MTgnLCcnKQogICAgICAgICAgICBtb2RlID0gJzE4JwogICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1Igd2hpdGVdISFEb3dubG9hZCEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yMyZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkKICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnZGxhdWRpb29ubHknKSA9PSAndHJ1ZSc6CiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCchIURvd25sb2FkIFtDT0xPUiBzZWFibHVlXUF1ZGlvISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTI0Jm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkKICAgICAgICBlbGlmIHVybC5zdGFydHN3aXRoKCdtYWduZXQ6P3h0PScpOgogICAgICAgICAgICBpZiAnJicgaW4gdXJsIGFuZCBub3QgJyZhbXA7JyBpbiB1cmwgOgogICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoJyYnLCcmYW1wOycpCiAgICAgICAgICAgIHVybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucHVsc2FyL3BsYXk/dXJpPScgKyB1cmwKICAgICAgICAgICAgbW9kZSA9ICcxMicKICAgICAgICBlbHNlOgogICAgICAgICAgICBtb2RlID0gJzEyJwogICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1Igd2hpdGVdISFEb3dubG9hZCBDdXJyZW50bHkgUGxheWluZyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yMSZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkKICAgICAgICBpZiAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/dmlkZW9faWQ9JyBpbiB1cmw6CiAgICAgICAgICAgICAgeXRfYXVkaW9fdXJsID0gdXJsLnJlcGxhY2UoJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvP3ZpZGVvX2lkPScsJ2h0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9JykKICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCchIURvd25sb2FkIFtDT0xPUiBibHVlXUF1ZGlvISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTI0Jm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHl0X2F1ZGlvX3VybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgdT1zeXMuYXJndlswXSsiPyIKICAgICAgICBwbGF5X2xpc3QgPSBGYWxzZQogICAgICAgIGlmIHBsYXlsaXN0OgogICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdhZGRfcGxheWxpc3QnKSA9PSAiZmFsc2UiOgogICAgICAgICAgICAgICAgdSArPSAidXJsPSIrdXJsbGliLnF1b3RlX3BsdXModXJsKSsiJm1vZGU9Iittb2RlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICB1ICs9ICJtb2RlPTEzJm5hbWU9JXMmcGxheWxpc3Q9JXMiICUodXJsbGliLnF1b3RlX3BsdXMobmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHN0cihwbGF5bGlzdCkucmVwbGFjZSgnLCcsJ3x8JykpKQogICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUgKyAnW0NPTE9SIGdyZWVuXVsvQ09MT1JdJwogICAgICAgICAgICAgICAgcGxheV9saXN0ID0gVHJ1ZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHUgKz0gInVybD0iK3VybGxpYi5xdW90ZV9wbHVzKHVybCkrIiZtb2RlPSIrbW9kZQogICAgICAgIGlmIHJlZ2V4czoKICAgICAgICAgICAgdSArPSAiJnJlZ2V4cz0iK3JlZ2V4cwogICAgICAgIGlmIG5vdCBzZXRDb29raWUgPT0gJyc6CiAgICAgICAgICAgIHUgKz0gIiZzZXRDb29raWU9Iit1cmxsaWIucXVvdGVfcGx1cyhzZXRDb29raWUpCgogICAgICAgIGlmIGRhdGUgPT0gJyc6CiAgICAgICAgICAgIGRhdGUgPSBOb25lCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZGVzY3JpcHRpb24gKz0gJ1xuXG5EYXRlOiAlcycgJWRhdGUKICAgICAgICBsaXo9eGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9IkRlZmF1bHRWaWRlby5wbmciLCB0aHVtYm5haWxJbWFnZT1pY29uaW1hZ2UpCiAgICAgICAgaWYgbGVuKGFsbGluZm8pIDwxOgogICAgICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSJWaWRlbyIsIGluZm9MYWJlbHM9eyAiVGl0bGUiOiBuYW1lLCAiUGxvdCI6IGRlc2NyaXB0aW9uLCAiR2VucmUiOiBnZW5yZSwgImRhdGVhZGRlZCI6IGRhdGUgfSkKCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbGl6LnNldEluZm8odHlwZT0iVmlkZW8iLCBpbmZvTGFiZWxzPWFsbGluZm8pCiAgICAgICAgbGl6LnNldFByb3BlcnR5KCJGYW5hcnRfSW1hZ2UiLCBmYW5hcnQpCiAgICAgICAgCiAgICAgICAgaWYgKG5vdCBwbGF5X2xpc3QpIGFuZCBub3QgYW55KHggaW4gdXJsIGZvciB4IGluIGdfaWdub3JlU2V0UmVzb2x2ZWQpIGFuZCBub3QgJyRQTEFZRVJQUk9YWSQ9JyBpbiB1cmw6IyAgKG5vdCB1cmwuc3RhcnRzd2l0aCgncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3RlcicpKToKICAgICAgICAgICAgaWYgcmVnZXhzOgogICAgICAgICAgICAgICAgI3ByaW50IHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKQogICAgICAgICAgICAgICAgaWYgJyRweUZ1bmN0aW9uOnBsYXltZWRpYSgnIG5vdCBpbiB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cykgYW5kICdub3RwbGF5YWJsZScgbm90IGluIHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKSBhbmQgJ2xpc3RyZXBlYXQnIG5vdCBpbiAgdXJsbGliLnVucXVvdGVfcGx1cyhyZWdleHMpIDoKICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3NldHRpbmcgaXNwbGF5YWJsZScsdXJsLCB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cyksdXJsCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFByb3BlcnR5KCdJc1BsYXlhYmxlJywgJ3RydWUnKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbGl6LnNldFByb3BlcnR5KCdJc1BsYXlhYmxlJywgJ3RydWUnKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFkZG9uX2xvZyggJ05PVCBzZXR0aW5nIGlzcGxheWFibGUnK3VybCkKICAgICAgICBpZiBzaG93Y29udGV4dDoKICAgICAgICAgICAgI2NvbnRleHRNZW51ID0gW10KICAgICAgICAgICAgaWYgc2hvd2NvbnRleHQgPT0gJ2Zhdic6CiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoCiAgICAgICAgICAgICAgICAgICAgKCdSZW1vdmUgZnJvbSB0dmRpcmV0byBGYXZvcml0ZXMnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTYmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkKICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICBlbGlmIG5vdCBuYW1lIGluIEZBVjoKICAgICAgICAgICAgICAgIGZhdl9wYXJhbXMgPSAoCiAgICAgICAgICAgICAgICAgICAgJyVzP21vZGU9NSZuYW1lPSVzJnVybD0lcyZpY29uaW1hZ2U9JXMmZmFuYXJ0PSVzJmZhdl9tb2RlPTAnCiAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKGljb25pbWFnZSksIHVybGxpYi5xdW90ZV9wbHVzKGZhbmFydCkpCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgaWYgcGxheWxpc3Q6CiAgICAgICAgICAgICAgICAgICAgZmF2X3BhcmFtcyArPSAncGxheWxpc3Q9Jyt1cmxsaWIucXVvdGVfcGx1cyhzdHIocGxheWxpc3QpLnJlcGxhY2UoJywnLCd8fCcpKQogICAgICAgICAgICAgICAgaWYgcmVnZXhzOgogICAgICAgICAgICAgICAgICAgIGZhdl9wYXJhbXMgKz0gIiZyZWdleHM9IityZWdleHMKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0FkZCB0byB0dmRpcmV0byBGYXZvcml0ZXMnLCdYQk1DLlJ1blBsdWdpbiglcyknICVmYXZfcGFyYW1zKSkKICAgICAgICAgICAgbGl6LmFkZENvbnRleHRNZW51SXRlbXMoY29udGV4dE1lbnUpCiAgICAgICAgaWYgbm90IHBsYXlsaXN0IGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2FkZF9wbGF5bGlzdCcpID09ICJmYWxzZSI6CiAgICAgICAgICAgICAgICBwbGF5bGlzdF9uYW1lID0gbmFtZS5zcGxpdCgnKSAnKVsxXQogICAgICAgICAgICAgICAgY29udGV4dE1lbnVfID0gWwogICAgICAgICAgICAgICAgICAgICgnUGxheSAnK3BsYXlsaXN0X25hbWUrJyBQbGF5TGlzdCcsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9MTMmbmFtZT0lcyZwbGF5bGlzdD0lcyknCiAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHBsYXlsaXN0X25hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyhzdHIocGxheWxpc3QpLnJlcGxhY2UoJywnLCd8fCcpKSkpCiAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgIGxpei5hZGRDb250ZXh0TWVudUl0ZW1zKGNvbnRleHRNZW51XykKICAgICAgICAjcHJpbnQgJ2FkZGluZycsbmFtZQogICAgICAgIG9rPXhibWNwbHVnaW4uYWRkRGlyZWN0b3J5SXRlbShoYW5kbGU9aW50KHN5cy5hcmd2WzFdKSx1cmw9dSxsaXN0aXRlbT1saXosdG90YWxJdGVtcz10b3RhbCxpc0ZvbGRlcj1pc0ZvbGRlcikKCiAgICAgICAgI3ByaW50ICdhZGRlZCcsbmFtZQogICAgICAgIHJldHVybiBvawoKICAgICAgICAKZGVmIHBsYXlzZXRyZXNvbHZlZCh1cmwsbmFtZSxpY29uaW1hZ2Usc2V0cmVzb2x2ZWQ9VHJ1ZSk6CiAgICBpZiBzZXRyZXNvbHZlZDoKICAgICAgICBsaXogPSB4Ym1jZ3VpLkxpc3RJdGVtKG5hbWUsIGljb25JbWFnZT1pY29uaW1hZ2UpCiAgICAgICAgbGl6LnNldEluZm8odHlwZT0nVmlkZW8nLCBpbmZvTGFiZWxzPXsnVGl0bGUnOm5hbWV9KQogICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiSXNQbGF5YWJsZSIsInRydWUiKQogICAgICAgIGxpei5zZXRQYXRoKHVybCkKICAgICAgICB4Ym1jcGx1Z2luLnNldFJlc29sdmVkVXJsKGludChzeXMuYXJndlsxXSksIFRydWUsIGxpeikKICAgIGVsc2U6CiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignWEJNQy5SdW5QbHVnaW4oJyt1cmwrJyknKQoKCiMjIFRoYW5rcyB0byBkYXNjaGFja2EsIGFuIGVwZyBzY3JhcGVyIGZvciBodHRwOi8vaS50ZWxlYm95LmNoL3Byb2dyYW1tL3N0YXRpb25fc2VsZWN0LnBocAojIyAgaHR0cDovL2ZvcnVtLnhibWMub3JnL3Bvc3QucGhwP3A9OTM2MjI4JnBvc3Rjb3VudD0xMDc2CmRlZiBnZXRlcGcobGluayk6CiAgICAgICAgdXJsPXVybGxpYi51cmxvcGVuKGxpbmspCiAgICAgICAgc291cmNlPXVybC5yZWFkKCkKICAgICAgICB1cmwuY2xvc2UoKQogICAgICAgIHNvdXJjZTIgPSBzb3VyY2Uuc3BsaXQoIkpldHp0IikKICAgICAgICBzb3VyY2UzID0gc291cmNlMlsxXS5zcGxpdCgncHJvZ3JhbW0vZGV0YWlsLnBocD9jb25zdF9pZD0nKQogICAgICAgIHNvdXJjZXVocnplaXQgPSBzb3VyY2UzWzFdLnNwbGl0KCc8YnIgLz48YSBocmVmPSIvJykKICAgICAgICBub3d0aW1lID0gc291cmNldWhyemVpdFswXVs0MDpsZW4oc291cmNldWhyemVpdFswXSldCiAgICAgICAgc291cmNldGl0bGUgPSBzb3VyY2UzWzJdLnNwbGl0KCI8L2E+PC9wPjwvZGl2PiIpCiAgICAgICAgbm93dGl0bGUgPSBzb3VyY2V0aXRsZVswXVsxNzpsZW4oc291cmNldGl0bGVbMF0pXQogICAgICAgIG5vd3RpdGxlID0gbm93dGl0bGUuZW5jb2RlKCd1dGYtOCcpCiAgICAgICAgcmV0dXJuICIgIC0gIitub3d0aXRsZSsiIC0gIitub3d0aW1lCgoKZGVmIGdldF9lcGcodXJsLCByZWdleCk6CiAgICAgICAgZGF0YSA9IG1ha2VSZXF1ZXN0KHVybCkKICAgICAgICB0cnk6CiAgICAgICAgICAgIGl0ZW0gPSByZS5maW5kYWxsKHJlZ2V4LCBkYXRhKVswXQogICAgICAgICAgICByZXR1cm4gaXRlbQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgYWRkb25fbG9nKCdyZWdleCBmYWlsZWQnKQogICAgICAgICAgICBhZGRvbl9sb2cocmVnZXgpCiAgICAgICAgICAgIHJldHVybgoKICAgIAojI25vdCBhIGdlbmVyaWMgaW1wbGVtZW5hdGlvbiBhcyBpdCBuZWVkcyB0byBjb252ZXJ0ICAgICAgICAgICAgCmRlZiBkMngoZCwgcm9vdD0icm9vdCIsbmVzdGVkPTApOgoKICAgIG9wID0gbGFtYmRhIHRhZzogJzwnICsgdGFnICsgJz4nCiAgICBjbCA9IGxhbWJkYSB0YWc6ICc8LycgKyB0YWcgKyAnPlxuJwogICAgbWwgPSBsYW1iZGEgdix4bWw6IHhtbCArIG9wKGtleSkgKyBzdHIodikgKyBjbChrZXkpCgogICAgeG1sID0gb3Aocm9vdCkgKyAnXG4nIGlmIHJvb3QgZWxzZSAiIgoKICAgIGZvciBrZXksdmwgaW4gZC5pdGVyaXRlbXMoKToKICAgICAgICB2dHlwZSA9IHR5cGUodmwpCiAgICAgICAgaWYgbmVzdGVkPT0wOiBrZXk9J3JlZ2V4JyAjZW5mb3JjaW5nIGFsbCB0b3AgbGV2ZWwgdGFncyB0byBiZSBuYW1lZCBhcyByZWdleAogICAgICAgIGlmIHZ0eXBlIGlzIGxpc3Q6IAogICAgICAgICAgICBmb3IgdiBpbiB2bDoKICAgICAgICAgICAgICAgIHY9ZXNjYXBlKHYpCiAgICAgICAgICAgICAgICB4bWwgPSBtbCh2LHhtbCkgICAgICAgICAKICAgICAgICAKICAgICAgICBpZiB2dHlwZSBpcyBkaWN0OiAKICAgICAgICAgICAgeG1sID0gbWwoJ1xuJyArIGQyeCh2bCxOb25lLG5lc3RlZCsxKSx4bWwpICAgICAgICAgCiAgICAgICAgaWYgdnR5cGUgaXMgbm90IGxpc3QgYW5kIHZ0eXBlIGlzIG5vdCBkaWN0OiAKICAgICAgICAgICAgaWYgbm90IHZsIGlzIE5vbmU6IHZsPWVzY2FwZSh2bCkKICAgICAgICAgICAgeG1sID0gbWwodmwseG1sKQoKICAgIHhtbCArPSBjbChyb290KSBpZiByb290IGVsc2UgIiIKCiAgICByZXR1cm4geG1sCnhibWNwbHVnaW4uc2V0Q29udGVudChpbnQoc3lzLmFyZ3ZbMV0pLCAnbW92aWVzJykKCnRyeToKICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX1VOU09SVEVEKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX0xBQkVMKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX0RBVEUpCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgeGJtY3BsdWdpbi5hZGRTb3J0TWV0aG9kKGludChzeXMuYXJndlsxXSksIHhibWNwbHVnaW4uU09SVF9NRVRIT0RfR0VOUkUpCmV4Y2VwdDoKICAgIHBhc3MKCnBhcmFtcz1nZXRfcGFyYW1zKCkKCnVybD1Ob25lCm5hbWU9Tm9uZQptb2RlPU5vbmUKcGxheWxpc3Q9Tm9uZQppY29uaW1hZ2U9Tm9uZQpmYW5hcnQ9RkFOQVJUCnBsYXlsaXN0PU5vbmUKZmF2X21vZGU9Tm9uZQpyZWdleHM9Tm9uZQoKdHJ5OgogICAgdXJsPXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJ1cmwiXSkuZGVjb2RlKCd1dGYtOCcpCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgbmFtZT11cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1sibmFtZSJdKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIGljb25pbWFnZT11cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1siaWNvbmltYWdlIl0pCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgZmFuYXJ0PXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJmYW5hcnQiXSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICBtb2RlPWludChwYXJhbXNbIm1vZGUiXSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICBwbGF5bGlzdD1ldmFsKHVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJwbGF5bGlzdCJdKS5yZXBsYWNlKCd8fCcsJywnKSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICBmYXZfbW9kZT1pbnQocGFyYW1zWyJmYXZfbW9kZSJdKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIHJlZ2V4cz1wYXJhbXNbInJlZ2V4cyJdCmV4Y2VwdDoKICAgIHBhc3MKCmFkZG9uX2xvZygiTW9kZTogIitzdHIobW9kZSkpCgoKaWYgbm90IHVybCBpcyBOb25lOgogICAgYWRkb25fbG9nKCJVUkw6ICIrc3RyKHVybC5lbmNvZGUoJ3V0Zi04JykpKQphZGRvbl9sb2coIk5hbWU6ICIrc3RyKG5hbWUpKQoKaWYgbW9kZT09Tm9uZToKICAgIGFkZG9uX2xvZygiZ2V0U291cmNlcyIpCiAgICBnZXRTb3VyY2VzKCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09MToKICAgIGFkZG9uX2xvZygiZ2V0RGF0YSIpCiAgICBkYXRhPU5vbmUKICAgIGlmIHJlZ2V4czoKICAgICAgICBkYXRhPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgdXJsKQogICAgICAgIHVybD0nJwogICAgICAgICNjcmVhdGUgeG1sIGhlcmUKICAgIGdldERhdGEodXJsLGZhbmFydCxkYXRhKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZWxpZiBtb2RlPT0yOgogICAgYWRkb25fbG9nKCJnZXRDaGFubmVsSXRlbXMiKQogICAgZ2V0Q2hhbm5lbEl0ZW1zKG5hbWUsdXJsLGZhbmFydCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09MzoKICAgIGFkZG9uX2xvZygiZ2V0U3ViQ2hhbm5lbEl0ZW1zIikKICAgIGdldFN1YkNoYW5uZWxJdGVtcyhuYW1lLHVybCxmYW5hcnQpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTQ6CiAgICBhZGRvbl9sb2coImdldEZhdm9yaXRlcyIpCiAgICBnZXRGYXZvcml0ZXMoKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZWxpZiBtb2RlPT01OgogICAgYWRkb25fbG9nKCJhZGRGYXZvcml0ZSIpCiAgICB0cnk6CiAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJ1xcICcpWzFdCiAgICBleGNlcHQ6CiAgICAgICAgcGFzcwogICAgdHJ5OgogICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCcgIC0gJylbMF0KICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCiAgICBhZGRGYXZvcml0ZShuYW1lLHVybCxpY29uaW1hZ2UsZmFuYXJ0LGZhdl9tb2RlKQoKZWxpZiBtb2RlPT02OgogICAgYWRkb25fbG9nKCJybUZhdm9yaXRlIikKICAgIHRyeToKICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnXFwgJylbMV0KICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCiAgICB0cnk6CiAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJyAgLSAnKVswXQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKICAgIHJtRmF2b3JpdGUobmFtZSkKCmVsaWYgbW9kZT09NzoKICAgIGFkZG9uX2xvZygiYWRkU291cmNlIikKICAgIGFkZFNvdXJjZSh1cmwpCgplbGlmIG1vZGU9PTg6CiAgICBhZGRvbl9sb2coInJtU291cmNlIikKICAgIHJtU291cmNlKG5hbWUpCgplbGlmIG1vZGU9PTk6CiAgICBhZGRvbl9sb2coImRvd25sb2FkX2ZpbGUiKQogICAgZG93bmxvYWRfZmlsZShuYW1lLCB1cmwpCgplbGlmIG1vZGU9PTEwOgogICAgYWRkb25fbG9nKCJnZXRDb21tdW5pdHlTb3VyY2VzIikKICAgIGdldENvbW11bml0eVNvdXJjZXMoKQoKZWxpZiBtb2RlPT0xMToKICAgIGFkZG9uX2xvZygiYWRkU291cmNlIikKICAgIGFkZFNvdXJjZSh1cmwpCgplbGlmIG1vZGU9PTEyOgogICAgYWRkb25fbG9nKCJzZXRSZXNvbHZlZFVybCIpCiAgICBpZiBub3QgdXJsLnN0YXJ0c3dpdGgoInBsdWdpbjovL3BsdWdpbiIpIG9yIG5vdCBhbnkoeCBpbiB1cmwgZm9yIHggaW4gZ19pZ25vcmVTZXRSZXNvbHZlZCk6I25vdCB1cmwuc3RhcnRzd2l0aCgicGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3RlciIpIDoKICAgICAgICBpdGVtID0geGJtY2d1aS5MaXN0SXRlbShwYXRoPXVybCkKICAgICAgICB4Ym1jcGx1Z2luLnNldFJlc29sdmVkVXJsKGludChzeXMuYXJndlsxXSksIFRydWUsIGl0ZW0pCiAgICBlbHNlOgogICAgICAgIHByaW50ICdOb3Qgc2V0dGluZyBzZXRSZXNvbHZlZFVybCcKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdYQk1DLlJ1blBsdWdpbignK3VybCsnKScpCgoKZWxpZiBtb2RlPT0xMzoKICAgIGFkZG9uX2xvZygicGxheV9wbGF5bGlzdCIpCiAgICBwbGF5X3BsYXlsaXN0KG5hbWUsIHBsYXlsaXN0KQoKZWxpZiBtb2RlPT0xNDoKICAgIGFkZG9uX2xvZygiZ2V0X3htbF9kYXRhYmFzZSIpCiAgICBnZXRfeG1sX2RhdGFiYXNlKHVybCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09MTU6CiAgICBhZGRvbl9sb2coImJyb3dzZV94bWxfZGF0YWJhc2UiKQogICAgZ2V0X3htbF9kYXRhYmFzZSh1cmwsIFRydWUpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTE2OgogICAgYWRkb25fbG9nKCJicm93c2VfY29tbXVuaXR5IikKICAgIGdldENvbW11bml0eVNvdXJjZXModXJsLGJyb3dzZT1UcnVlKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZWxpZiBtb2RlPT0xNzoKICAgIGFkZG9uX2xvZygiZ2V0UmVnZXhQYXJzZWQiKQoKICAgIGRhdGE9Tm9uZQogICAgaWYgcmVnZXhzIGFuZCAnbGlzdHJlcGVhdCcgaW4gdXJsbGliLnVucXVvdGVfcGx1cyhyZWdleHMpOgogICAgICAgIGxpc3RyZXBlYXQscmV0LG0scmVnZXhzID1nZXRSZWdleFBhcnNlZChyZWdleHMsIHVybCkKIyAgICAgICAgcHJpbnQgbGlzdGxpbmssbGlzdHRpdGxlLGxpc3R0aHVtYm5haWwscmV0CiAgICAgICAgZD0nJwojICAgICAgICBwcmludCAnbSBpcycgLCBtCiMgICAgICAgIHByaW50ICdyZWdleHMnLHJlZ2V4cwogICAgICAgIHJlZ2V4bmFtZT1tWyduYW1lJ10KICAgICAgICBleGlzdGluZ19saXN0PXJlZ2V4cy5wb3AocmVnZXhuYW1lKQogIyAgICAgICBwcmludCAnZmluYWwgcmVnZXhzJyxyZWdleHMscmVnZXhuYW1lCiAgICAgICAgdXJsPScnCiAgICAgICAgaW1wb3J0IGNvcHkKICAgICAgICBsbj0nJwogICAgICAgIGZvciBvYmogaW4gcmV0OgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBuZXdjb3B5PWNvcHkuZGVlcGNvcHkocmVnZXhzKQogICAgIyAgICAgICAgICAgIHByaW50ICduZXdjb3B5JyxuZXdjb3B5LCBsZW4obmV3Y29weSkKICAgICAgICAgICAgICAgIGxpc3RyZXBlYXRUPWxpc3RyZXBlYXQKICAgICAgICAgICAgICAgIGk9MAogICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKG9iaikpOgogICAgIyAgICAgICAgICAgICAgICBwcmludCAnaSBpcyAnLGksIGxlbihvYmopLCBsZW4obmV3Y29weSkKICAgICAgICAgICAgICAgICAgICBpZiBsZW4obmV3Y29weSk+MDoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHRoZV9rZXlPLCB0aGVfdmFsdWVPIGluIG5ld2NvcHkuaXRlcml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0aGVfdmFsdWVPIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciB0aGVfa2V5LCB0aGVfdmFsdWUgaW4gdGhlX3ZhbHVlTy5pdGVyaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGhlX3ZhbHVlIGlzIG5vdCBOb25lOiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgICdrZXkgYW5kIHZhbCcsdGhlX2tleSwgdGhlX3ZhbHVlCiAgICAgICAgIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2FhJwogICAgICAgICMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdbJyArIHJlZ2V4bmFtZSsnLnBhcmFtJytzdHIoaSsxKSArICddJwogICAgICAgICMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50IHJlcHIob2JqW2ldKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdHlwZSh0aGVfdmFsdWUpIGlzIGRpY3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHRoZV9rZXlsLCB0aGVfdmFsdWVsIGluIHRoZV92YWx1ZS5pdGVyaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGhlX3ZhbHVlbCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZV92YWx1ZVt0aGVfa2V5bF09dGhlX3ZhbHVlbC5yZXBsYWNlKCdbJyArIHJlZ2V4bmFtZSsnLnBhcmFtJytzdHIoaSsxKSArICddJywgb2JqW2ldLmRlY29kZSgndXRmLTgnKSApICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlX3ZhbHVlT1t0aGVfa2V5XT10aGVfdmFsdWUucmVwbGFjZSgnWycgKyByZWdleG5hbWUrJy5wYXJhbScrc3RyKGkrMSkgKyAnXScsIG9ialtpXS5kZWNvZGUoJ3V0Zi04JykgKQogICAgICAgICAgICAgICAgICAgIGxpc3RyZXBlYXRUPWxpc3RyZXBlYXRULnJlcGxhY2UoJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ10nLG9ialtpXS5kZWNvZGUoJ3V0Zi04JykpIAogICAgICAgICAgICAgICAgI25ld2NvcHkgPSB1cmxsaWIucXVvdGUocmVwcihuZXdjb3B5KSkKICAgICMgICAgICAgICAgICBwcmludCAnbmV3IHJlZ2V4IGxpc3QnLCByZXByKG5ld2NvcHkpLCByZXByKGxpc3RyZXBlYXRUKQogICAgIyAgICAgICAgICAgIGFkZExpbmsobGlzdGxpbmtULGxpc3R0aXRsZVQuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSxsaXN0dGh1bWJuYWlsVCwnJywnJywnJywnJyxUcnVlLE5vbmUsbmV3Y29weSwgbGVuKHJldCkpCiAgICAgICAgICAgICAgICByZWdleF94bWw9JycKICAgICAgICAgICAgICAgIGlmIGxlbihuZXdjb3B5KT4wOgogICAgICAgICAgICAgICAgICAgIHJlZ2V4X3htbD1kMngobmV3Y29weSwnbHNwcm9yb290JykKICAgICAgICAgICAgICAgICAgICByZWdleF94bWw9cmVnZXhfeG1sLnNwbGl0KCc8bHNwcm9yb290PicpWzFdLnNwbGl0KCc8L2xzcHJvcm9vdCcpWzBdCiAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsbis9J1xuPGl0ZW0+JXNcbiVzPC9pdGVtPiclKGxpc3RyZXBlYXRULHJlZ2V4X3htbCkgICAKICAgICAgICAgICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZG91dCkKIyAgICAgICAgICAgIHByaW50IHJlcHIobG4pCiMgICAgICAgICAgICBwcmludCBuZXdjb3B5CiAgICAgICAgICAgICAgICAKIyAgICAgICAgICAgIGxuKz0nPC9pdGVtPicKICAgICAgICAjY3JlYXRlIHhtbCBoZXJlCiAgICAgICAgZ2V0RGF0YSgnJywnJyxsbikKICAgICAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCiAgICBlbHNlOgogICAgICAgIHVybCxzZXRyZXNvbHZlZCA9IGdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgdXJsKQogICAgICAgIGlmIHVybDoKICAgICAgICAgICAgaWYgJyRQTEFZRVJQUk9YWSQ9JyBpbiB1cmw6CiAgICAgICAgICAgICAgICB1cmwscHJveHk9dXJsLnNwbGl0KCckUExBWUVSUFJPWFkkPScpCiAgICAgICAgICAgICAgICBwcmludCAncHJveHknLHByb3h5CiAgICAgICAgICAgICAgICBwcm94eWlwLHBvcnQ9cHJveHkuc3BsaXQoJzonKQogICAgICAgICAgICAgICAgcGxheW1lZGlhd2l0aHByb3h5KHVybCxuYW1lLGljb25pbWFnZSxwcm94eWlwLHBvcnQgKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcGxheXNldHJlc29sdmVkKHVybCxuYW1lLGljb25pbWFnZSxzZXRyZXNvbHZlZCkKICAgICAgICBlbHNlOgogICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbih0dmRpcmV0byxGYWlsZWQgdG8gZXh0cmFjdCByZWdleC4gLSAiKyJ0aGlzIisiLDQwMDAsIitpY29uKyIpIikKZWxpZiBtb2RlPT0xODoKICAgIGFkZG9uX2xvZygieW91dHViZWRsIikKICAgIHRyeToKICAgICAgICBpbXBvcnQgeW91dHViZWRsCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKHR2ZGlyZXRvLFBsZWFzZSBbQ09MT1IgeWVsbG93XWluc3RhbGwgWW91dHViZS1kbFsvQ09MT1JdIG1vZHVsZSAsMTAwMDAsIiIpIikKICAgIHN0cmVhbV91cmw9eW91dHViZWRsLnNpbmdsZV9ZRCh1cmwpCiAgICBwbGF5c2V0cmVzb2x2ZWQoc3RyZWFtX3VybCxuYW1lLGljb25pbWFnZSkKZWxpZiBtb2RlPT0xOToKICAgIGFkZG9uX2xvZygiR2VuZXNpc2NvbW1vbnJlc29sdmVycyIpCiAgICBwbGF5c2V0cmVzb2x2ZWQgKHVybHNvbHZlcih1cmwpLG5hbWUsaWNvbmltYWdlLFRydWUpCgplbGlmIG1vZGU9PTIxOgogICAgYWRkb25fbG9nKCJkb3dubG9hZCBjdXJyZW50IGZpbGUgdXNpbmcgeW91dHViZS1kbCBzZXJ2aWNlIikKICAgIHl0ZGxfZG93bmxvYWQoJycsbmFtZSwndmlkZW8nKQplbGlmIG1vZGU9PTIzOgogICAgYWRkb25fbG9nKCJnZXQgaW5mbyB0aGVuIGRvd25sb2FkIikKICAgIHl0ZGxfZG93bmxvYWQodXJsLG5hbWUsJ3ZpZGVvJykKZWxpZiBtb2RlPT0yNDoKICAgIGFkZG9uX2xvZygiQXVkaW8gb25seSB5b3V0dWJlIGRvd25sb2FkIikKICAgIHl0ZGxfZG93bmxvYWQodXJsLG5hbWUsJ2F1ZGlvJykKZWxpZiBtb2RlPT0yNToKICAgIGFkZG9uX2xvZygiU2VhcmNoaW4gT3RoZXIgcGx1Z2lucyIpCiAgICBfc2VhcmNoKHVybCxuYW1lKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQplbGlmIG1vZGU9PTU1OgogICAgYWRkb25fbG9nKCJlbmFibGVkIGxvY2siKQogICAgcGFyZW50YWxibG9ja2VkcGluID1hZGRvbi5nZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWRwaW4nKQogICAga2V5Ym9hcmQgPSB4Ym1jLktleWJvYXJkKCcnLCdFbnRlciBQaW4nKQogICAga2V5Ym9hcmQuZG9Nb2RhbCgpCiAgICBpZiBub3QgKGtleWJvYXJkLmlzQ29uZmlybWVkKCkgPT0gRmFsc2UpOgogICAgICAgIG5ld1N0ciA9IGtleWJvYXJkLmdldFRleHQoKQogICAgICAgIGlmIG5ld1N0cj09cGFyZW50YWxibG9ja2VkcGluOgogICAgICAgICAgICBhZGRvbi5zZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWQnLCAiZmFsc2UiKQogICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbih0dmRpcmV0byxQYXJlbnRhbCBCbG9jayBEaXNhYmxlZCw1MDAwLCIraWNvbisiKSIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24odHZkaXJldG8sV3JvbmcgUGluPz8sNTAwMCwiK2ljb24rIikiKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQplbGlmIG1vZGU9PTU2OgogICAgYWRkb25fbG9nKCJkaXNhYmxlIGxvY2siKQogICAgYWRkb24uc2V0U2V0dGluZygncGFyZW50YWxibG9ja2VkJywgInRydWUiKQogICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24odHZkaXJldG8sUGFyZW50YWwgYmxvY2sgZW5hYmxlZCw1MDAwLCIraWNvbisiKSIpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTUzOgogICAgYWRkb25fbG9nKCJSZXF1ZXN0aW5nIEpTT04tUlBDIEl0ZW1zIikKICAgIHBsdWdpbnF1ZXJ5YnlKU09OKHVybCkKICAgICN4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCg==')